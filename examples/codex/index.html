<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>VIB3+ Codex</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:system-ui,-apple-system,sans-serif;background:#0a0a0f;color:#e0e0e0;min-height:100vh;padding:40px 20px}
.container{max-width:980px;margin:0 auto}
h1{font-size:28px;font-weight:300;letter-spacing:.05em;margin-bottom:8px;color:#fff}
.subtitle{font-size:14px;color:rgba(255,255,255,.5);margin-bottom:18px;line-height:1.5}
.toolbar{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:24px}
select,input{background:#11131c;color:#fff;border:1px solid rgba(255,255,255,.14);border-radius:8px;padding:8px 10px}
.entries{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}
.entry{padding:18px;border:1px solid rgba(255,255,255,.08);border-radius:12px;background:rgba(255,255,255,.03);display:flex;flex-direction:column;gap:8px}
.entry[data-status="planned"]{opacity:.55}
.entry-title{font-size:17px;font-weight:600;color:#fff}
.meta{font-size:12px;color:rgba(255,255,255,.45)}
.tags{display:flex;flex-wrap:wrap;gap:6px}
.tag{font-size:11px;padding:2px 6px;border-radius:999px;background:rgba(168,85,247,.14);color:rgba(210,170,255,.9);border:1px solid rgba(168,85,247,.3)}
.actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:4px}
.btn{font-size:12px;padding:6px 9px;border-radius:8px;text-decoration:none;border:1px solid rgba(255,255,255,.15);color:#fff;background:rgba(255,255,255,.04)}
.btn.disabled{pointer-events:none;opacity:.35}
.footer{margin-top:40px;padding-top:16px;border-top:1px solid rgba(255,255,255,.08);font-size:12px;color:rgba(255,255,255,.3);text-align:center}
</style>
</head>
<body>
<div class="container">
  <h1>VIB3+ Codex</h1>
  <p class="subtitle">Metadata-driven catalog of prime examples. Filter by status, input type, and pattern to find implementation references for both humans and agents.</p>

  <div class="toolbar">
    <select id="statusFilter">
      <option value="all">All Statuses</option>
      <option value="active">Active</option>
      <option value="planned">Planned</option>
    </select>
    <select id="inputFilter">
      <option value="all">All Inputs</option>
    </select>
    <input id="patternFilter" type="search" placeholder="Filter pattern (e.g. Portal Open)">
  </div>

  <div id="entries" class="entries"></div>

  <div class="footer">
    <a href="../dogfood/GOLD_STANDARD.md" class="btn">Gold Standard</a>
    <a href="../../DOCS/CODEX_MIGRATION_PLAN.md" class="btn">Codex Migration Plan</a>
  </div>
</div>

<script type="module">
const entriesContainer = document.getElementById('entries');
const statusFilter = document.getElementById('statusFilter');
const inputFilter = document.getElementById('inputFilter');
const patternFilter = document.getElementById('patternFilter');

const catalog = await fetch('./catalog.json').then(r => r.json());
const entries = catalog.entries || [];

const inputs = [...new Set(entries.map(e => e.input_source))].sort();
for (const input of inputs) {
  const opt = document.createElement('option');
  opt.value = input;
  opt.textContent = input;
  inputFilter.appendChild(opt);
}

function action(href, label) {
  if (!href) return `<span class="btn disabled">${label}</span>`;
  return `<a class="btn" href="${href}">${label}</a>`;
}

function render() {
  const s = statusFilter.value;
  const i = inputFilter.value;
  const p = patternFilter.value.trim().toLowerCase();

  const filtered = entries.filter(e => {
    if (s !== 'all' && e.status !== s) return false;
    if (i !== 'all' && e.input_source !== i) return false;
    if (p && !e.patterns_used.some(tag => tag.toLowerCase().includes(p))) return false;
    return true;
  });

  entriesContainer.innerHTML = filtered.map(e => `
    <article class="entry" data-status="${e.status}">
      <div class="entry-title">${e.title}</div>
      <div class="meta">status: ${e.status} · input: ${e.input_source} · difficulty: ${e.difficulty}</div>
      <div>${e.creative_direction}</div>
      <div class="tags">${e.patterns_used.map(t => `<span class="tag">${t}</span>`).join('')}</div>
      <div class="meta">coverage: ${e.gold_standard_coverage}</div>
      <div class="actions">
        ${action(e.run_href, 'Run')}
        ${action(e.read_href, 'Read')}
        ${action(e.coverage_href, 'Patterns')}
        ${action(e.mcp_labs, 'Agent Lab')}
      </div>
    </article>
  `).join('');

  if (!filtered.length) {
    entriesContainer.innerHTML = '<div class="entry">No entries matched the current filters.</div>';
  }
}

statusFilter.addEventListener('change', render);
inputFilter.addEventListener('change', render);
patternFilter.addEventListener('input', render);
render();
</script>
</body>
</html>
