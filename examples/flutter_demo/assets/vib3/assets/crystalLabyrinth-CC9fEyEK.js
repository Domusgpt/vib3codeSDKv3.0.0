import"./FacetedSystem-PaU9wK_B.js";import{V as c}from"./VIB3Universe-CBjOFS4d.js";class l{constructor(t,e,s=1/60){this.updateFn=t,this.renderFn=e,this.step=s,this.dt=0,this.last=0,this.now=0,this.accumulator=0,this.running=!1,this.rafId=null,this.frame=this.frame.bind(this)}start(){this.running||(this.running=!0,this.last=performance.now(),this.accumulator=0,this.rafId=requestAnimationFrame(this.frame),console.log("GameLoop: Started."))}stop(){this.running=!1,this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),console.log("GameLoop: Stopped.")}frame(t){if(this.running){for(this.now=t,this.dt=Math.min(1,(this.now-this.last)/1e3),this.last=this.now,this.accumulator+=this.dt;this.accumulator>=this.step;)this.updateFn(this.step),this.accumulator-=this.step;this.renderFn(this.accumulator/this.step),this.rafId=requestAnimationFrame(this.frame)}}}class d{constructor(){this.gravity=9.8,this.friction=.95,this.densityThreshold=.8}update(t,e){t.forEach(s=>{s.physics&&s.active&&this.updateEntity(s,e)})}updateEntity(t,e){const{pos:s,vel:i,acc:n}=t.physics;n.y-=this.gravity*e,i.x+=n.x*e,i.y+=n.y*e,i.z+=n.z*e,n.x=0,n.y=0,n.z=0;const o=s.x+i.x*e,h=s.y+i.y*e,r=s.z+i.z*e;this.getDensityAt(o,h,r)>this.densityThreshold?(i.x*=-.5,i.y*=-.5,i.z*=-.5):(s.x=o,s.y=h,s.z=r),i.x*=this.friction,i.y*=this.friction,i.z*=this.friction}getDensityAt(t,e,s){if(e<-2)return 1;const i=(Math.sin(t*.5)+Math.cos(s*.5))*.5+.5;return e>0&&e<1&&i>.8?1:0}}class u{constructor(t,e){this.domElement=t,this.engine=e,this.keys={w:!1,a:!1,s:!1,d:!1,q:!1,e:!1,space:!1,shift:!1},this.mouse={dx:0,dy:0,down:!1},this.velocity={x:0,y:0,z:0,w:0},this.rotation={x:0,y:0},this.portalRot=0,this.speed=5,this.sensitivity=.002,this.damping=.9,this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.setupListeners()}setupListeners(){window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.domElement.addEventListener("mousemove",this.onMouseMove),this.domElement.addEventListener("mousedown",this.onMouseDown),this.domElement.addEventListener("mouseup",this.onMouseUp)}onKeyDown(t){const e=t.key.toLowerCase();this.keys.hasOwnProperty(e)&&(this.keys[e]=!0)}onKeyUp(t){const e=t.key.toLowerCase();this.keys.hasOwnProperty(e)&&(this.keys[e]=!1)}onMouseDown(){this.mouse.down=!0}onMouseUp(){this.mouse.down=!1}onMouseMove(t){this.mouse.down&&(this.mouse.dx+=t.movementX,this.mouse.dy+=t.movementY)}update(t){this.rotation.y-=this.mouse.dx*this.sensitivity,this.rotation.x-=this.mouse.dy*this.sensitivity,this.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,this.rotation.x)),this.mouse.dx=0,this.mouse.dy=0;const e=Math.sin(this.rotation.y),s=Math.cos(this.rotation.y),i=Math.cos(this.rotation.y),n=-Math.sin(this.rotation.y),o=this.speed*t;this.keys.w&&(this.velocity.x+=e*o,this.velocity.z-=s*o),this.keys.s&&(this.velocity.x-=e*o,this.velocity.z+=s*o),this.keys.a&&(this.velocity.x-=i*o,this.velocity.z+=n*o),this.keys.d&&(this.velocity.x+=i*o,this.velocity.z-=n*o),this.keys.space&&(this.velocity.y+=o),this.keys.shift&&(this.velocity.y-=o),this.keys.q&&(this.portalRot-=o),this.keys.e&&(this.portalRot+=o),this.velocity.x*=this.damping,this.velocity.y*=this.damping,this.velocity.z*=this.damping,this.engine.setParameter("rot4dXY",this.rotation.y+this.velocity.x*.1),this.engine.setParameter("rot4dYZ",this.rotation.x+this.velocity.y*.1),this.engine.setParameter("rot4dXW",this.portalRot)}destroy(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp),this.domElement.removeEventListener("mousemove",this.onMouseMove),this.domElement.removeEventListener("mousedown",this.onMouseDown),this.domElement.removeEventListener("mouseup",this.onMouseUp)}}class y{constructor(t){this.universe=t,this.active=!1,this.audience={energy:.5,attention:.8,sentiment:0},this.pacing="build",this.lastActionTime=0,this.decisionInterval=2e3,this.update=this.update.bind(this)}start(){this.active||(this.active=!0,this.lastActionTime=performance.now(),requestAnimationFrame(this.update),console.log("LiveDirector: Started directing."))}stop(){this.active=!1,console.log("LiveDirector: Stopped directing.")}feedInput(t,e){t==="audio"?this.audience.energy=Math.min(1,this.audience.energy+e.volume*.1):t==="input"&&(this.audience.attention=Math.min(1,this.audience.attention+.05))}update(t){if(!this.active)return;const e=t-this.lastActionTime;this.audience.energy=Math.max(0,this.audience.energy-.001),this.audience.attention=Math.max(0,this.audience.attention-5e-4),e>this.decisionInterval&&(this.makeDecision(),this.lastActionTime=t),requestAnimationFrame(this.update)}makeDecision(){const{energy:t,attention:e}=this.audience;console.log(`LiveDirector: Audience state - Energy: ${t.toFixed(2)}, Attention: ${e.toFixed(2)}`),e<.3?this.triggerEvent("focus_snap"):t<.2?this.adjustGlobalParams({speed:1.5,chaos:.4}):t>.8&&this.adjustGlobalParams({speed:.5,chaos:.1})}adjustGlobalParams(t){console.log("LiveDirector: Adjusting global parameters",t),this.universe.actors.forEach(e=>{e.animator&&e.animator.transition(t,2e3,"easeInOut")})}triggerEvent(t){console.log(`LiveDirector: Triggering event '${t}'`),t==="focus_snap"&&(this.adjustGlobalParams({intensity:1,speed:0}),setTimeout(()=>{this.adjustGlobalParams({intensity:.5,speed:1})},200))}}class m{constructor(){this.universe=new c("vib3-universe"),this.physics=new d,this.director=new y(this.universe),this.score=0,this.health=100,this.isPlaying=!1,this.player=null,this.crystals=[],this.shadows=[],this.ui={score:document.getElementById("score"),health:document.getElementById("health"),overlay:document.getElementById("overlay"),startBtn:document.getElementById("start-btn")},this.controller=new u(document.body,{setParameter:(t,e)=>this.updatePlayerView(t,e)}),this.loop=new l(t=>this.update(t),t=>this.render(t)),this.init()}async init(){await this.universe.spawnActor({personality:"neutral",system:"holographic",geometry:11,layer:{zIndex:0,opacity:.4}}),this.ui.startBtn.addEventListener("click",()=>this.start())}start(){this.isPlaying=!0,this.ui.overlay.classList.add("hidden"),this.universe.start(),this.loop.start(),this.director.start(),this.spawnLevel()}async spawnLevel(){for(let t=0;t<5;t++){const e=await this.universe.spawnActor({personality:"heroic",system:"faceted",geometry:7,layer:{zIndex:10,blendMode:"screen",opacity:.9}});e.physics={pos:{x:(Math.random()-.5)*20,y:(Math.random()-.5)*5,z:(Math.random()-.5)*20},vel:{x:0,y:0,z:0},acc:{x:0,y:0,z:0}},this.crystals.push(e)}for(let t=0;t<3;t++){const e=await this.universe.spawnActor({personality:"glitch",system:"quantum",geometry:16,layer:{zIndex:5,blendMode:"multiply",opacity:.7}});e.physics={pos:{x:0,y:0,z:-30},vel:{x:0,y:0,z:0},acc:{x:0,y:0,z:0}},this.shadows.push(e)}}update(t){this.isPlaying&&(this.controller.update(t),this.shadows.forEach(e=>{e.emote("panic",.5)}),Math.random()<.005&&this.crystals.length>0&&this.collectCrystal(this.crystals.pop()))}render(t){}updatePlayerView(t,e){const s=this.universe.actors.get(this.universe.orchestrator.entities.keys().next().value);s&&s.engine&&s.engine.setParameter(t,e)}collectCrystal(t){this.score++,this.ui.score.innerText=this.score,t.emote("joy",1,500),setTimeout(()=>{this.universe.despawnActor(t.id)},500),this.score>=5&&this.win()}win(){this.isPlaying=!1,this.ui.overlay.innerHTML=`
            <h1 style="color: #0f0; text-shadow: 0 0 20px #0f0;">SECTOR STABILIZED</h1>
            <p>The lattice is secure.</p>
            <button onclick="location.reload()">Re-enter</button>
        `,this.ui.overlay.classList.remove("hidden"),this.loop.stop()}}new m;
//# sourceMappingURL=crystalLabyrinth-CC9fEyEK.js.map
