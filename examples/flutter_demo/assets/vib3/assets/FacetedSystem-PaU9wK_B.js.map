{"version":3,"file":"FacetedSystem-PaU9wK_B.js","sources":["../../src/quantum/QuantumVisualizer.js","../../src/core/Parameters.js","../../src/render/RenderResourceRegistry.js","../../src/render/backends/WebGPUBackend.js","../../src/render/UnifiedRenderBridge.js","../../src/render/LayerRelationshipGraph.js","../../src/render/MultiCanvasBridge.js","../../src/render/ShaderLoader.js","../../src/quantum/QuantumEngine.js","../../src/holograms/HolographicVisualizer.js","../../src/holograms/RealHolographicSystem.js","../../src/faceted/FacetedSystem.js"],"sourcesContent":["/**\n * VIB34D Quantum Holographic Visualizer\n * Enhanced WebGL renderer with complex 3D lattice functions and holographic effects\n * This is the superior system with volumetric lighting, particles, and RGB glitch effects\n */\n\nimport { GeometryLibrary } from '../geometry/GeometryLibrary.js';\n\n// Role-specific intensity values for 5-layer canvas architecture.\n// IMPORTANT: Must stay in sync with shader epsilon comparisons in the fragment shader\n// at the \"LAYER-BY-LAYER COLOR SYSTEM\" section (search for layerIndex).\nconst ROLE_INTENSITIES = {\n    'background': 0.4,\n    'shadow': 0.6,\n    'content': 1.0,\n    'highlight': 1.3,\n    'accent': 1.6\n};\n\nexport class QuantumHolographicVisualizer {\n    constructor(canvasIdOrElement, role, reactivity, variant) {\n        this.canvas = (canvasIdOrElement instanceof HTMLCanvasElement)\n            ? canvasIdOrElement\n            : document.getElementById(canvasIdOrElement);\n        this.role = role;\n        this.reactivity = reactivity;\n        this.variant = variant;\n        this._canvasLabel = typeof canvasIdOrElement === 'string' ? canvasIdOrElement : canvasIdOrElement?.id || 'unknown';\n        \n        // CRITICAL FIX: Define contextOptions as instance property to match SmartCanvasPool\n        this.contextOptions = {\n            alpha: true,\n            depth: true,\n            stencil: false,\n            antialias: false,  // Disable antialiasing on mobile for performance\n            premultipliedAlpha: true,\n            preserveDrawingBuffer: false,\n            powerPreference: 'high-performance',\n            failIfMajorPerformanceCaveat: false  // Don't fail on mobile\n        };\n        \n        // CRITICAL FIX: Don't create context here - let SmartCanvasPool handle it\n        // Try WebGL2 first (better mobile support), then WebGL1\n        this.gl = this.canvas.getContext('webgl2', this.contextOptions) || \n                  this.canvas.getContext('webgl', this.contextOptions) ||\n                  this.canvas.getContext('experimental-webgl', this.contextOptions);\n        \n        if (!this.gl) {\n            console.error(`WebGL not supported for ${this._canvasLabel}`);\n            if (window.mobileDebug) {\n                window.mobileDebug.log(`‚ùå ${this._canvasLabel}: WebGL context creation failed`);\n            }\n            // Show user-friendly error instead of white screen\n            this.showWebGLError();\n            return;\n        } else {\n            if (window.mobileDebug) {\n                const version = this.gl.getParameter(this.gl.VERSION);\n                window.mobileDebug.log(`‚úÖ ${this._canvasLabel}: WebGL context created - ${version}`);\n            }\n        }\n        \n        this.mouseX = 0.5;\n        this.mouseY = 0.5;\n        this.mouseIntensity = 0.0;\n        this.clickIntensity = 0.0;\n        this.startTime = Date.now();\n        this._contextLost = false;\n\n        // WebGL context loss/restore handlers\n        this._onContextLost = (e) => {\n            e.preventDefault();\n            this._contextLost = true;\n            console.warn(`WebGL context lost for ${this._canvasLabel}`);\n        };\n        this._onContextRestored = () => {\n            console.log(`WebGL context restored for ${this._canvasLabel}`);\n            this._contextLost = false;\n            try {\n                this.init();\n            } catch (err) {\n                console.error(`Failed to reinit after context restore for ${this._canvasLabel}:`, err);\n            }\n        };\n        this.canvas.addEventListener('webglcontextlost', this._onContextLost);\n        this.canvas.addEventListener('webglcontextrestored', this._onContextRestored);\n\n        // Default parameters\n        this.params = {\n            geometry: 0,\n            gridDensity: 15,\n            morphFactor: 1.0,\n            chaos: 0.2,\n            speed: 1.0,\n            hue: 200,\n            intensity: 0.5,\n            saturation: 0.8,\n            dimension: 3.5,\n            rot4dXY: 0.0,\n            rot4dXZ: 0.0,\n            rot4dYZ: 0.0,\n            rot4dXW: 0.0,\n            rot4dYW: 0.0,\n            rot4dZW: 0.0\n        };\n        \n        this.init();\n    }\n    \n    /**\n     * CRITICAL FIX: Ensure canvas is properly sized before creating WebGL context\n     */\n    async ensureCanvasSizedThenInitWebGL() {\n        // Set proper canvas dimensions for mobile - with fallbacks\n        let rect = this.canvas.getBoundingClientRect();\n        const devicePixelRatio = Math.min(window.devicePixelRatio || 1, 2); // Cap at 2x for performance\n        \n        // If canvas has no dimensions, wait for layout or use viewport\n        if (rect.width === 0 || rect.height === 0) {\n            // Wait for layout with promise\n            await new Promise(resolve => {\n                setTimeout(() => {\n                    rect = this.canvas.getBoundingClientRect();\n                    if (rect.width === 0 || rect.height === 0) {\n                        // Use viewport dimensions as fallback\n                        const viewWidth = window.innerWidth;\n                        const viewHeight = window.innerHeight;\n                        this.canvas.width = viewWidth * devicePixelRatio;\n                        this.canvas.height = viewHeight * devicePixelRatio;\n                        \n                        if (window.mobileDebug) {\n                            window.mobileDebug.log(`üìê Quantum Canvas ${this.canvas.id}: Using viewport fallback ${this.canvas.width}x${this.canvas.height}`);\n                        }\n                    } else {\n                        this.canvas.width = rect.width * devicePixelRatio;\n                        this.canvas.height = rect.height * devicePixelRatio;\n                        \n                        if (window.mobileDebug) {\n                            window.mobileDebug.log(`üìê Quantum Canvas ${this.canvas.id}: Layout ready ${this.canvas.width}x${this.canvas.height}`);\n                        }\n                    }\n                    resolve();\n                }, 100);\n            });\n        } else {\n            this.canvas.width = rect.width * devicePixelRatio;\n            this.canvas.height = rect.height * devicePixelRatio;\n            \n            if (window.mobileDebug) {\n                window.mobileDebug.log(`üìê Quantum Canvas ${this.canvas.id}: ${this.canvas.width}x${this.canvas.height} (DPR: ${devicePixelRatio})`);\n            }\n        }\n        \n        // NOW create WebGL context with properly sized canvas\n        this.createWebGLContext();\n        \n        // Initialize rendering pipeline\n        if (this.gl) {\n            this.init();\n        }\n    }\n    \n    /**\n     * Create WebGL context after canvas is properly sized\n     */\n    createWebGLContext() {\n        // CRITICAL FIX: Check if context already exists from SmartCanvasPool\n        let existingContext = this.canvas.getContext('webgl2') || \n                             this.canvas.getContext('webgl') || \n                             this.canvas.getContext('experimental-webgl');\n        \n        if (existingContext && !existingContext.isContextLost()) {\n            console.log(`üîÑ Reusing existing WebGL context for ${this.canvas.id}`);\n            this.gl = existingContext;\n            return;\n        }\n        \n        // Try WebGL2 first (better mobile support), then WebGL1\n        this.gl = this.canvas.getContext('webgl2', this.contextOptions) || \n                  this.canvas.getContext('webgl', this.contextOptions) ||\n                  this.canvas.getContext('experimental-webgl', this.contextOptions);\n        \n        if (!this.gl) {\n            console.error(`WebGL not supported for ${this.canvas.id}`);\n            if (window.mobileDebug) {\n                window.mobileDebug.log(`‚ùå Quantum ${this.canvas.id}: WebGL context creation failed (size: ${this.canvas.width}x${this.canvas.height})`);\n            }\n            // Show user-friendly error instead of white screen\n            this.showWebGLError();\n            return;\n        } else {\n            if (window.mobileDebug) {\n                const version = this.gl.getParameter(this.gl.VERSION);\n                window.mobileDebug.log(`‚úÖ Quantum ${this.canvas.id}: WebGL context created - ${version} (size: ${this.canvas.width}x${this.canvas.height})`);\n            }\n        }\n    }\n\n    /**\n     * Initialize WebGL rendering pipeline\n     */\n    init() {\n        this.initShaders();\n        this.initBuffers();\n        this.resize();\n    }\n    \n    /**\n     * Reinitialize WebGL context and resources after SmartCanvasPool context recreation\n     */\n    reinitializeContext() {\n        console.log(`üîÑ Reinitializing WebGL context for ${this.canvas.id}`);\n        \n        // CRITICAL FIX: Clear old WebGL references first\n        this.program = null;\n        this.buffer = null;\n        this.uniforms = null;\n        this.gl = null;\n        \n        // CRITICAL FIX: Don't create new context - SmartCanvasPool already did this\n        // Just get the existing context that SmartCanvasPool created\n        this.gl = this.canvas.getContext('webgl2') || \n                  this.canvas.getContext('webgl') ||\n                  this.canvas.getContext('experimental-webgl');\n        \n        if (!this.gl) {\n            console.error(`‚ùå No WebGL context available for ${this.canvas.id} - SmartCanvasPool should have created one`);\n            return false;\n        }\n        \n        if (this.gl.isContextLost()) {\n            console.error(`‚ùå WebGL context is lost for ${this.canvas.id}`);\n            return false;\n        }\n        \n        // Reinitialize all WebGL resources with the existing context\n        try {\n            this.initShaders();\n            this.initBuffers();\n            this.resize();\n            \n            console.log(`‚úÖ WebGL context reinitialized for ${this.canvas.id}`);\n            return true;\n        } catch (error) {\n            console.error(`‚ùå Failed to reinitialize WebGL resources for ${this.canvas.id}:`, error);\n            return false;\n        }\n    }\n    \n    /**\n     * Initialize shaders with complex 3D lattice functions and holographic effects\n     */\n    initShaders() {\n        const vertexShaderSource = `attribute vec2 a_position;\nvoid main() {\n    gl_Position = vec4(a_position, 0.0, 1.0);\n}`;\n        \n        // Mobile-friendly precision - try highp, fallback to mediump\n        const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n        const precision = isMobile ? 'mediump' : 'highp';\n        \n        const fragmentShaderSource = `\n#ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n#else\n    precision mediump float;\n#endif\n\nuniform vec2 u_resolution;\nuniform float u_time;\nuniform vec2 u_mouse;\nuniform float u_geometry;\nuniform float u_gridDensity;\nuniform float u_morphFactor;\nuniform float u_chaos;\nuniform float u_speed;\nuniform float u_hue;\nuniform float u_intensity;\nuniform float u_saturation;\nuniform float u_dimension;\nuniform float u_rot4dXY;\nuniform float u_rot4dXZ;\nuniform float u_rot4dYZ;\nuniform float u_rot4dXW;\nuniform float u_rot4dYW;\nuniform float u_rot4dZW;\nuniform float u_mouseIntensity;\nuniform float u_clickIntensity;\nuniform float u_roleIntensity;\nuniform float u_breath;\n\n// 6D rotation matrices - 3D space rotations (XY, XZ, YZ)\nmat4 rotateXY(float theta) {\n    float c = cos(theta);\n    float s = sin(theta);\n    return mat4(c, -s, 0.0, 0.0, s, c, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0);\n}\n\nmat4 rotateXZ(float theta) {\n    float c = cos(theta);\n    float s = sin(theta);\n    return mat4(c, 0.0, s, 0.0, 0.0, 1.0, 0.0, 0.0, -s, 0.0, c, 0.0, 0.0, 0.0, 0.0, 1.0);\n}\n\nmat4 rotateYZ(float theta) {\n    float c = cos(theta);\n    float s = sin(theta);\n    return mat4(1.0, 0.0, 0.0, 0.0, 0.0, c, -s, 0.0, 0.0, s, c, 0.0, 0.0, 0.0, 0.0, 1.0);\n}\n\n// 4D hyperspace rotations (XW, YW, ZW)\nmat4 rotateXW(float theta) {\n    float c = cos(theta);\n    float s = sin(theta);\n    return mat4(c, 0.0, 0.0, -s, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, s, 0.0, 0.0, c);\n}\n\nmat4 rotateYW(float theta) {\n    float c = cos(theta);\n    float s = sin(theta);\n    return mat4(1.0, 0.0, 0.0, 0.0, 0.0, c, 0.0, -s, 0.0, 0.0, 1.0, 0.0, 0.0, s, 0.0, c);\n}\n\nmat4 rotateZW(float theta) {\n    float c = cos(theta);\n    float s = sin(theta);\n    return mat4(1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, c, -s, 0.0, 0.0, s, c);\n}\n\nvec3 project4Dto3D(vec4 p) {\n    float w = 2.5 / (2.5 + p.w);\n    return vec3(p.x * w, p.y * w, p.z * w);\n}\n\n// ========================================\n// POLYTOPE CORE WARP FUNCTIONS (24 Geometries)\n// ========================================\nvec3 warpHypersphereCore(vec3 p, int geometryIndex, vec2 mouseDelta) {\n    float radius = length(p);\n    float morphBlend = clamp(u_morphFactor * 0.6 + (u_dimension - 3.0) * 0.25, 0.0, 2.0);\n    float w = sin(radius * (1.3 + float(geometryIndex) * 0.12) + u_time * 0.0008 * u_speed);\n    w *= (0.4 + morphBlend * 0.45);\n\n    vec4 p4d = vec4(p * (1.0 + morphBlend * 0.2), w);\n    p4d = rotateXY(u_rot4dXY) * p4d;\n    p4d = rotateXZ(u_rot4dXZ) * p4d;\n    p4d = rotateYZ(u_rot4dYZ) * p4d;\n    p4d = rotateXW(u_rot4dXW) * p4d;\n    p4d = rotateYW(u_rot4dYW) * p4d;\n    p4d = rotateZW(u_rot4dZW) * p4d;\n\n    vec3 projected = project4Dto3D(p4d);\n    return mix(p, projected, clamp(0.45 + morphBlend * 0.35, 0.0, 1.0));\n}\n\nvec3 warpHypertetraCore(vec3 p, int geometryIndex, vec2 mouseDelta) {\n    vec3 c1 = normalize(vec3(1.0, 1.0, 1.0));\n    vec3 c2 = normalize(vec3(-1.0, -1.0, 1.0));\n    vec3 c3 = normalize(vec3(-1.0, 1.0, -1.0));\n    vec3 c4 = normalize(vec3(1.0, -1.0, -1.0));\n\n    float morphBlend = clamp(u_morphFactor * 0.8 + (u_dimension - 3.0) * 0.2, 0.0, 2.0);\n    float basisMix = dot(p, c1) * 0.14 + dot(p, c2) * 0.1 + dot(p, c3) * 0.08;\n    float w = sin(basisMix * 5.5 + u_time * 0.0009 * u_speed);\n    w *= cos(dot(p, c4) * 4.2 - u_time * 0.0007 * u_speed);\n    w *= (0.5 + morphBlend * 0.4);\n\n    vec3 offset = vec3(dot(p, c1), dot(p, c2), dot(p, c3)) * 0.1 * morphBlend;\n    vec4 p4d = vec4(p + offset, w);\n    p4d = rotateXY(u_rot4dXY) * p4d;\n    p4d = rotateXZ(u_rot4dXZ) * p4d;\n    p4d = rotateYZ(u_rot4dYZ) * p4d;\n    p4d = rotateXW(u_rot4dXW) * p4d;\n    p4d = rotateYW(u_rot4dYW) * p4d;\n    p4d = rotateZW(u_rot4dZW) * p4d;\n\n    vec3 projected = project4Dto3D(p4d);\n\n    float planeInfluence = min(min(abs(dot(p, c1)), abs(dot(p, c2))), min(abs(dot(p, c3)), abs(dot(p, c4))));\n    vec3 blended = mix(p, projected, clamp(0.45 + morphBlend * 0.35, 0.0, 1.0));\n    return mix(blended, blended * (1.0 - planeInfluence * 0.55), 0.2 + morphBlend * 0.2);\n}\n\nvec3 applyCoreWarp(vec3 p, float geometryType, vec2 mouseDelta) {\n    float totalBase = 8.0;\n    float coreFloat = floor(geometryType / totalBase);\n    int coreIndex = int(clamp(coreFloat, 0.0, 2.0));\n    float baseGeomFloat = mod(geometryType, totalBase);\n    int geometryIndex = int(clamp(floor(baseGeomFloat + 0.5), 0.0, totalBase - 1.0));\n\n    if (coreIndex == 1) {\n        return warpHypersphereCore(p, geometryIndex, mouseDelta);\n    }\n    if (coreIndex == 2) {\n        return warpHypertetraCore(p, geometryIndex, mouseDelta);\n    }\n    return p;\n}\n// ========================================\n\n// Complex 3D Lattice Functions - Superior Quantum Shaders\nfloat tetrahedronLattice(vec3 p, float gridSize) {\n    vec3 q = fract(p * gridSize) - 0.5;\n    float d1 = length(q);\n    float d2 = length(q - vec3(0.4, 0.0, 0.0));\n    float d3 = length(q - vec3(0.0, 0.4, 0.0));\n    float d4 = length(q - vec3(0.0, 0.0, 0.4));\n    float vertices = 1.0 - smoothstep(0.0, 0.04, min(min(d1, d2), min(d3, d4)));\n    float edges = 0.0;\n    edges = max(edges, 1.0 - smoothstep(0.0, 0.02, abs(length(q.xy) - 0.2)));\n    edges = max(edges, 1.0 - smoothstep(0.0, 0.02, abs(length(q.yz) - 0.2)));\n    edges = max(edges, 1.0 - smoothstep(0.0, 0.02, abs(length(q.xz) - 0.2)));\n    return max(vertices, edges * 0.5);\n}\n\nfloat hypercubeLattice(vec3 p, float gridSize) {\n    vec3 grid = fract(p * gridSize);\n    vec3 edges = min(grid, 1.0 - grid);\n    float minEdge = min(min(edges.x, edges.y), edges.z);\n    float lattice = 1.0 - smoothstep(0.0, 0.03, minEdge);\n    \n    vec3 centers = abs(grid - 0.5);\n    float maxCenter = max(max(centers.x, centers.y), centers.z);\n    float vertices = 1.0 - smoothstep(0.45, 0.5, maxCenter);\n    \n    return max(lattice * 0.7, vertices);\n}\n\nfloat sphereLattice(vec3 p, float gridSize) {\n    vec3 cell = fract(p * gridSize) - 0.5;\n    float sphere = 1.0 - smoothstep(0.15, 0.25, length(cell));\n    \n    float rings = 0.0;\n    float ringRadius = length(cell.xy);\n    rings = max(rings, 1.0 - smoothstep(0.0, 0.02, abs(ringRadius - 0.3)));\n    rings = max(rings, 1.0 - smoothstep(0.0, 0.02, abs(ringRadius - 0.2)));\n    \n    return max(sphere, rings * 0.6);\n}\n\nfloat torusLattice(vec3 p, float gridSize) {\n    vec3 cell = fract(p * gridSize) - 0.5;\n    float majorRadius = 0.3;\n    float minorRadius = 0.1;\n    \n    float toroidalDist = length(vec2(length(cell.xy) - majorRadius, cell.z));\n    float torus = 1.0 - smoothstep(minorRadius - 0.02, minorRadius + 0.02, toroidalDist);\n    \n    float rings = 0.0;\n    float angle = atan(cell.y, cell.x);\n    rings = sin(angle * 8.0) * 0.02;\n    \n    return max(torus, 0.0) + rings;\n}\n\nfloat kleinLattice(vec3 p, float gridSize) {\n    vec3 cell = fract(p * gridSize) - 0.5;\n    float u = atan(cell.y, cell.x) / 3.14159 + 1.0;\n    float v = cell.z + 0.5;\n    \n    float x = (2.0 + cos(u * 0.5)) * cos(u);\n    float y = (2.0 + cos(u * 0.5)) * sin(u);\n    float z = sin(u * 0.5) + v;\n    \n    vec3 kleinPoint = vec3(x, y, z) * 0.1;\n    float dist = length(cell - kleinPoint);\n    \n    return 1.0 - smoothstep(0.1, 0.15, dist);\n}\n\nfloat fractalLattice(vec3 p, float gridSize) {\n    vec3 cell = fract(p * gridSize);\n    cell = abs(cell * 2.0 - 1.0);\n    \n    float dist = length(max(abs(cell) - 0.3, 0.0));\n    \n    // Recursive subdivision\n    for(int i = 0; i < 3; i++) {\n        cell = abs(cell * 2.0 - 1.0);\n        float subdist = length(max(abs(cell) - 0.3, 0.0)) / pow(2.0, float(i + 1));\n        dist = min(dist, subdist);\n    }\n    \n    return 1.0 - smoothstep(0.0, 0.05, dist);\n}\n\nfloat waveLattice(vec3 p, float gridSize) {\n    float time = u_time * 0.001 * u_speed;\n    vec3 cell = fract(p * gridSize) - 0.5;\n    \n    float wave1 = sin(p.x * gridSize * 2.0 + time * 2.0);\n    float wave2 = sin(p.y * gridSize * 1.8 + time * 1.5);\n    float wave3 = sin(p.z * gridSize * 2.2 + time * 1.8);\n    \n    float interference = (wave1 + wave2 + wave3) / 3.0;\n    float amplitude = 1.0 - length(cell) * 2.0;\n    \n    return max(0.0, interference * amplitude);\n}\n\nfloat crystalLattice(vec3 p, float gridSize) {\n    vec3 cell = fract(p * gridSize) - 0.5;\n    \n    // Octahedral crystal structure\n    float crystal = max(max(abs(cell.x) + abs(cell.y), abs(cell.y) + abs(cell.z)), abs(cell.x) + abs(cell.z));\n    crystal = 1.0 - smoothstep(0.3, 0.4, crystal);\n    \n    // Add crystalline faces\n    float faces = 0.0;\n    faces = max(faces, 1.0 - smoothstep(0.0, 0.02, abs(abs(cell.x) - 0.35)));\n    faces = max(faces, 1.0 - smoothstep(0.0, 0.02, abs(abs(cell.y) - 0.35)));\n    faces = max(faces, 1.0 - smoothstep(0.0, 0.02, abs(abs(cell.z) - 0.35)));\n    \n    return max(crystal, faces * 0.5);\n}\n\n// Enhanced geometry function with holographic effects (24 GEOMETRIES)\nfloat geometryFunction(vec4 p) {\n    // Decode geometry: base = geometry % 8 (supports 24 geometries)\n    float totalBase = 8.0;\n    float baseGeomFloat = mod(u_geometry, totalBase);\n    int geomType = int(clamp(floor(baseGeomFloat + 0.5), 0.0, totalBase - 1.0));\n\n    // Project to 3D and apply polytope warp\n    vec3 p3d = project4Dto3D(p);\n    vec3 warped = applyCoreWarp(p3d, u_geometry, vec2(0.0, 0.0));\n    float gridSize = u_gridDensity * 0.08;\n    \n    if (geomType == 0) {\n        return tetrahedronLattice(warped, gridSize) * u_morphFactor;\n    }\n    else if (geomType == 1) {\n        return hypercubeLattice(warped, gridSize) * u_morphFactor;\n    }\n    else if (geomType == 2) {\n        return sphereLattice(warped, gridSize) * u_morphFactor;\n    }\n    else if (geomType == 3) {\n        return torusLattice(warped, gridSize) * u_morphFactor;\n    }\n    else if (geomType == 4) {\n        return kleinLattice(warped, gridSize) * u_morphFactor;\n    }\n    else if (geomType == 5) {\n        return fractalLattice(warped, gridSize) * u_morphFactor;\n    }\n    else if (geomType == 6) {\n        return waveLattice(warped, gridSize) * u_morphFactor;\n    }\n    else if (geomType == 7) {\n        return crystalLattice(warped, gridSize) * u_morphFactor;\n    }\n    else {\n        return hypercubeLattice(warped, gridSize) * u_morphFactor;\n    }\n}\n\n// HSL to RGB conversion for proper color control\nvec3 hsl2rgb(float h, float s, float l) {\n    float c = (1.0 - abs(2.0 * l - 1.0)) * s;\n    float hp = h * 6.0; // h is 0-1\n    float x = c * (1.0 - abs(mod(hp, 2.0) - 1.0));\n    float m = l - c * 0.5;\n    vec3 rgb;\n    if (hp < 1.0)      rgb = vec3(c, x, 0.0);\n    else if (hp < 2.0) rgb = vec3(x, c, 0.0);\n    else if (hp < 3.0) rgb = vec3(0.0, c, x);\n    else if (hp < 4.0) rgb = vec3(0.0, x, c);\n    else if (hp < 5.0) rgb = vec3(x, 0.0, c);\n    else               rgb = vec3(c, 0.0, x);\n    return rgb + m;\n}\n\n// LAYER-BY-LAYER COLOR SYSTEM with user hue/saturation control\n// Each layer gets a hue offset from the user-controlled base hue\nvec3 getLayerColorPalette(int layerIndex, float t) {\n    float baseHue = u_hue; // 0-1 from JavaScript (user hue / 360)\n    float sat = u_saturation;\n\n    // Per-layer hue offsets for visual variety\n    float hueOffset = 0.0;\n    float lightness = 0.5;\n\n    if (layerIndex == 0) {\n        // BACKGROUND: Darkened, shifted hue\n        hueOffset = 0.0;\n        lightness = 0.15;\n        sat *= 0.7;\n    }\n    else if (layerIndex == 1) {\n        // SHADOW: Complementary offset, medium-dark\n        hueOffset = 0.33;\n        lightness = 0.3;\n        sat *= 0.9;\n    }\n    else if (layerIndex == 2) {\n        // CONTENT: Primary hue, bright\n        hueOffset = 0.0;\n        lightness = 0.55;\n    }\n    else if (layerIndex == 3) {\n        // HIGHLIGHT: Analogous offset, bright\n        hueOffset = 0.15;\n        lightness = 0.6;\n    }\n    else {\n        // ACCENT: Triadic offset, vivid\n        hueOffset = 0.67;\n        lightness = 0.5;\n    }\n\n    // Animate hue gently over time and geometry value\n    float animatedHue = fract(baseHue + hueOffset + sin(t * 3.0) * 0.05);\n    return hsl2rgb(animatedHue, sat, lightness);\n}\n\n// Extreme RGB separation and distortion for each layer\nvec3 extremeRGBSeparation(vec3 baseColor, vec2 uv, float intensity, int layerIndex) {\n    vec2 offset = vec2(0.01, 0.005) * intensity;\n    \n    // Different separation patterns per layer\n    if (layerIndex == 0) {\n        // Background: Minimal separation, smooth\n        return baseColor + vec3(\n            sin(uv.x * 10.0 + u_time * 0.001) * 0.02,\n            cos(uv.y * 8.0 + u_time * 0.0015) * 0.02,\n            sin(uv.x * uv.y * 6.0 + u_time * 0.0008) * 0.02\n        ) * intensity;\n    }\n    else if (layerIndex == 1) {\n        // Shadow: Heavy vertical separation\n        float r = baseColor.r + sin(uv.y * 50.0 + u_time * 0.003) * intensity * 0.15;\n        float g = baseColor.g + sin((uv.y + 0.1) * 45.0 + u_time * 0.0025) * intensity * 0.12;\n        float b = baseColor.b + sin((uv.y - 0.1) * 55.0 + u_time * 0.0035) * intensity * 0.18;\n        return vec3(r, g, b);\n    }\n    else if (layerIndex == 2) {\n        // Content: Explosive radial separation\n        float dist = length(uv);\n        float angle = atan(uv.y, uv.x);\n        float r = baseColor.r + sin(dist * 30.0 + angle * 10.0 + u_time * 0.004) * intensity * 0.2;\n        float g = baseColor.g + cos(dist * 25.0 + angle * 8.0 + u_time * 0.0035) * intensity * 0.18;\n        float b = baseColor.b + sin(dist * 35.0 + angle * 12.0 + u_time * 0.0045) * intensity * 0.22;\n        return vec3(r, g, b);\n    }\n    else if (layerIndex == 3) {\n        // Highlight: Lightning-like separation\n        float lightning = sin(uv.x * 80.0 + u_time * 0.008) * cos(uv.y * 60.0 + u_time * 0.006);\n        float r = baseColor.r + lightning * intensity * 0.25;\n        float g = baseColor.g + sin(lightning * 40.0 + u_time * 0.005) * intensity * 0.2;\n        float b = baseColor.b + cos(lightning * 30.0 + u_time * 0.007) * intensity * 0.3;\n        return vec3(r, g, b);\n    }\n    else {\n        // Accent: Chaotic multi-directional separation\n        float chaos1 = sin(uv.x * 100.0 + uv.y * 80.0 + u_time * 0.01);\n        float chaos2 = cos(uv.x * 70.0 - uv.y * 90.0 + u_time * 0.008);\n        float chaos3 = sin(uv.x * uv.y * 150.0 + u_time * 0.012);\n        return baseColor + vec3(chaos1, chaos2, chaos3) * intensity * 0.3;\n    }\n}\n\nvoid main() {\n    vec2 uv = (gl_FragCoord.xy - u_resolution.xy * 0.5) / min(u_resolution.x, u_resolution.y);\n    \n    // Enhanced 4D position with holographic depth\n    float timeSpeed = u_time * 0.0001 * u_speed;\n    vec4 pos = vec4(uv * 3.0, sin(timeSpeed * 3.0), cos(timeSpeed * 2.0));\n    pos.xy += (u_mouse - 0.5) * u_mouseIntensity * 2.0;\n\n    // Apply 6D rotations - 3D space rotations first, then 4D hyperspace\n    pos = rotateXY(u_rot4dXY) * pos;\n    pos = rotateXZ(u_rot4dXZ) * pos;\n    pos = rotateYZ(u_rot4dYZ) * pos;\n    pos = rotateXW(u_rot4dXW) * pos;\n    pos = rotateYW(u_rot4dYW) * pos;\n    pos = rotateZW(u_rot4dZW) * pos;\n    \n    // Calculate enhanced geometry value\n    float value = geometryFunction(pos);\n    \n    // Enhanced chaos with holographic effects\n    float noise = sin(pos.x * 7.0) * cos(pos.y * 11.0) * sin(pos.z * 13.0);\n    value += noise * u_chaos;\n    \n    // Enhanced intensity calculation with holographic glow\n    float geometryIntensity = 1.0 - clamp(abs(value * 0.8), 0.0, 1.0);\n    geometryIntensity = pow(geometryIntensity, 1.5); // More dramatic falloff\n    geometryIntensity += u_clickIntensity * 0.3;\n    \n    // Holographic shimmer effect\n    float shimmer = sin(uv.x * 20.0 + timeSpeed * 5.0) * cos(uv.y * 15.0 + timeSpeed * 3.0) * 0.1;\n    geometryIntensity += shimmer * geometryIntensity;\n    \n    // Apply user intensity control\n    // Breath modulation (Exhale system)\n    float breathMod = 1.0 + (u_breath * 0.4);\n    float finalIntensity = geometryIntensity * u_intensity * breathMod;\n    \n    // LAYER-BY-LAYER COLOR SYSTEM with user hue/saturation/intensity controls\n    // Determine canvas layer from role/variant (0=background, 1=shadow, 2=content, 3=highlight, 4=accent)\n    // Values must match ROLE_INTENSITIES in JS: bg=0.4, shadow=0.6, content=1.0, highlight=1.3, accent=1.6\n    int layerIndex = 0;\n    if (abs(u_roleIntensity - 0.6) < 0.05) layerIndex = 1;       // shadow layer\n    else if (abs(u_roleIntensity - 1.0) < 0.05) layerIndex = 2;  // content layer\n    else if (abs(u_roleIntensity - 1.3) < 0.05) layerIndex = 3;  // highlight layer\n    else if (abs(u_roleIntensity - 1.6) < 0.05) layerIndex = 4;  // accent layer\n    \n    // Get layer-specific base color using user hue/saturation controls\n    float colorTime = timeSpeed * 2.0 + value * 3.0;\n    vec3 layerColor = getLayerColorPalette(layerIndex, colorTime);\n    \n    // Apply geometry-based intensity modulation per layer\n    vec3 extremeBaseColor;\n    if (layerIndex == 0) {\n        // Background: Subtle, fills empty space\n        extremeBaseColor = layerColor * (0.3 + geometryIntensity * 0.4);\n    }\n    else if (layerIndex == 1) {\n        // Shadow: Aggressive, high contrast where geometry is weak\n        float shadowIntensity = pow(1.0 - geometryIntensity, 2.0); // Inverted for shadows\n        extremeBaseColor = layerColor * (shadowIntensity * 0.8 + 0.1);\n    }\n    else if (layerIndex == 2) {\n        // Content: Dominant, follows geometry strongly\n        extremeBaseColor = layerColor * (geometryIntensity * 1.2 + 0.2);\n    }\n    else if (layerIndex == 3) {\n        // Highlight: Electric, peaks only\n        float peakIntensity = pow(geometryIntensity, 3.0); // Cubic for sharp peaks\n        extremeBaseColor = layerColor * (peakIntensity * 1.5 + 0.1);\n    }\n    else {\n        // Accent: Chaotic, random bursts\n        float randomBurst = sin(value * 50.0 + timeSpeed * 10.0) * 0.5 + 0.5;\n        extremeBaseColor = layerColor * (randomBurst * geometryIntensity * 2.0 + 0.05);\n    }\n    \n    // Apply extreme RGB separation per layer\n    vec3 extremeColor = extremeRGBSeparation(extremeBaseColor, uv, finalIntensity, layerIndex);\n    \n    // Layer-specific particle systems with extreme colors\n    float extremeParticles = 0.0;\n    if (layerIndex == 2 || layerIndex == 3) {\n        // Only content and highlight layers get particles\n        vec2 particleUV = uv * (layerIndex == 2 ? 12.0 : 20.0);\n        vec2 particleID = floor(particleUV);\n        vec2 particlePos = fract(particleUV) - 0.5;\n        float particleDist = length(particlePos);\n        \n        float particleTime = timeSpeed * (layerIndex == 2 ? 3.0 : 8.0) + dot(particleID, vec2(127.1, 311.7));\n        float particleAlpha = sin(particleTime) * 0.5 + 0.5;\n        float particleSize = layerIndex == 2 ? 0.2 : 0.1;\n        extremeParticles = (1.0 - smoothstep(0.05, particleSize, particleDist)) * particleAlpha * 0.4;\n    }\n    \n    // Combine color with particles based on layer\n    // Particle color derives from user hue for consistency\n    vec3 particleColor = hsl2rgb(fract(u_hue + 0.15), u_saturation * 0.5, 0.85);\n    vec3 finalColor;\n    if (layerIndex == 0) {\n        finalColor = extremeColor;\n    }\n    else if (layerIndex == 1) {\n        finalColor = extremeColor * 0.8;\n    }\n    else if (layerIndex == 2) {\n        finalColor = extremeColor + extremeParticles * particleColor;\n    }\n    else if (layerIndex == 3) {\n        finalColor = extremeColor + extremeParticles * particleColor;\n    }\n    else {\n        finalColor = extremeColor * (1.0 + sin(timeSpeed * 20.0) * 0.3);\n    }\n    \n    // Layer-specific alpha intensity with extreme contrast\n    float layerAlpha;\n    if (layerIndex == 0) layerAlpha = 0.6;        // Background: Medium\n    else if (layerIndex == 1) layerAlpha = 0.4;   // Shadow: Lower\n    else if (layerIndex == 2) layerAlpha = 1.0;   // Content: Full intensity\n    else if (layerIndex == 3) layerAlpha = 0.8;   // Highlight: High\n    else layerAlpha = 0.3;                        // Accent: Subtle bursts\n    \n    gl_FragColor = vec4(finalColor, finalIntensity * layerAlpha);\n}`;\n        \n        this.program = this.createProgram(vertexShaderSource, fragmentShaderSource);\n        this.uniforms = {\n            resolution: this.gl.getUniformLocation(this.program, 'u_resolution'),\n            time: this.gl.getUniformLocation(this.program, 'u_time'),\n            mouse: this.gl.getUniformLocation(this.program, 'u_mouse'),\n            geometry: this.gl.getUniformLocation(this.program, 'u_geometry'),\n            gridDensity: this.gl.getUniformLocation(this.program, 'u_gridDensity'),\n            morphFactor: this.gl.getUniformLocation(this.program, 'u_morphFactor'),\n            chaos: this.gl.getUniformLocation(this.program, 'u_chaos'),\n            speed: this.gl.getUniformLocation(this.program, 'u_speed'),\n            hue: this.gl.getUniformLocation(this.program, 'u_hue'),\n            intensity: this.gl.getUniformLocation(this.program, 'u_intensity'),\n            saturation: this.gl.getUniformLocation(this.program, 'u_saturation'),\n            dimension: this.gl.getUniformLocation(this.program, 'u_dimension'),\n            rot4dXY: this.gl.getUniformLocation(this.program, 'u_rot4dXY'),\n            rot4dXZ: this.gl.getUniformLocation(this.program, 'u_rot4dXZ'),\n            rot4dYZ: this.gl.getUniformLocation(this.program, 'u_rot4dYZ'),\n            rot4dXW: this.gl.getUniformLocation(this.program, 'u_rot4dXW'),\n            rot4dYW: this.gl.getUniformLocation(this.program, 'u_rot4dYW'),\n            rot4dZW: this.gl.getUniformLocation(this.program, 'u_rot4dZW'),\n            mouseIntensity: this.gl.getUniformLocation(this.program, 'u_mouseIntensity'),\n            clickIntensity: this.gl.getUniformLocation(this.program, 'u_clickIntensity'),\n            roleIntensity: this.gl.getUniformLocation(this.program, 'u_roleIntensity'),\n            breath: this.gl.getUniformLocation(this.program, 'u_breath')\n        };\n    }\n    \n    /**\n     * Create WebGL program from shaders\n     */\n    createProgram(vertexSource, fragmentSource) {\n        const vertexShader = this.createShader(this.gl.VERTEX_SHADER, vertexSource);\n        const fragmentShader = this.createShader(this.gl.FRAGMENT_SHADER, fragmentSource);\n        \n        if (!vertexShader || !fragmentShader) {\n            return null;\n        }\n        \n        const program = this.gl.createProgram();\n        this.gl.attachShader(program, vertexShader);\n        this.gl.attachShader(program, fragmentShader);\n        this.gl.linkProgram(program);\n        \n        if (!this.gl.getProgramParameter(program, this.gl.LINK_STATUS)) {\n            const error = this.gl.getProgramInfoLog(program);\n            console.error('Program linking failed:', error);\n            if (window.mobileDebug) {\n                window.mobileDebug.log(`‚ùå ${this.canvas?.id}: Shader program link failed - ${error}`);\n            }\n            return null;\n        } else {\n            if (window.mobileDebug) {\n                window.mobileDebug.log(`‚úÖ ${this.canvas?.id}: Shader program linked successfully`);\n            }\n        }\n        \n        return program;\n    }\n    \n    /**\n     * Create individual shader\n     */\n    createShader(type, source) {\n        // CRITICAL FIX: Check WebGL context state before shader operations\n        if (!this.gl) {\n            console.error('‚ùå Cannot create shader: WebGL context is null');\n            if (window.mobileDebug) {\n                window.mobileDebug.log(`‚ùå ${this.canvas?.id}: Cannot create shader - WebGL context is null`);\n            }\n            return null;\n        }\n        \n        if (this.gl.isContextLost()) {\n            console.error('‚ùå Cannot create shader: WebGL context is lost');\n            if (window.mobileDebug) {\n                window.mobileDebug.log(`‚ùå ${this.canvas?.id}: Cannot create shader - WebGL context is lost`);\n            }\n            return null;\n        }\n        \n        try {\n            const shader = this.gl.createShader(type);\n            \n            if (!shader) {\n                console.error('‚ùå Failed to create shader object - WebGL context may be invalid');\n                if (window.mobileDebug) {\n                    window.mobileDebug.log(`‚ùå ${this.canvas?.id}: Failed to create shader object`);\n                }\n                return null;\n            }\n            \n            this.gl.shaderSource(shader, source);\n            this.gl.compileShader(shader);\n            \n            if (!this.gl.getShaderParameter(shader, this.gl.COMPILE_STATUS)) {\n                const error = this.gl.getShaderInfoLog(shader);\n                const shaderType = type === this.gl.VERTEX_SHADER ? 'vertex' : 'fragment';\n                \n                // CRITICAL FIX: Show actual error instead of null\n                if (error) {\n                    console.error(`‚ùå ${shaderType} shader compilation failed:`, error);\n                } else {\n                    console.error(`‚ùå ${shaderType} shader compilation failed: WebGL returned no error info (context may be invalid)`);\n                }\n                \n                console.error('Shader source:', source);\n                \n                if (window.mobileDebug) {\n                    const errorMsg = error || 'No error info (context may be invalid)';\n                    window.mobileDebug.log(`‚ùå ${this.canvas?.id}: ${shaderType} shader compile failed - ${errorMsg}`);\n                    // Log first few lines of problematic shader for mobile debugging\n                    const sourceLines = source.split('\\n').slice(0, 5).join('\\\\n');\n                    window.mobileDebug.log(`üîç ${shaderType} shader source start: ${sourceLines}...`);\n                }\n                \n                this.gl.deleteShader(shader);\n                return null;\n            } else {\n                if (window.mobileDebug) {\n                    const shaderType = type === this.gl.VERTEX_SHADER ? 'vertex' : 'fragment';\n                    window.mobileDebug.log(`‚úÖ ${this.canvas?.id}: ${shaderType} shader compiled successfully`);\n                }\n            }\n            \n            return shader;\n        } catch (error) {\n            console.error('‚ùå Exception during shader creation:', error);\n            if (window.mobileDebug) {\n                window.mobileDebug.log(`‚ùå ${this.canvas?.id}: Exception during shader creation - ${error.message}`);\n            }\n            return null;\n        }\n    }\n    \n    /**\n     * Initialize vertex buffers\n     */\n    initBuffers() {\n        const positions = new Float32Array([-1, -1, 1, -1, -1, 1, 1, 1]);\n        \n        this.buffer = this.gl.createBuffer();\n        this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.buffer);\n        this.gl.bufferData(this.gl.ARRAY_BUFFER, positions, this.gl.STATIC_DRAW);\n        \n        const positionLocation = this.gl.getAttribLocation(this.program, 'a_position');\n        this.gl.enableVertexAttribArray(positionLocation);\n        this.gl.vertexAttribPointer(positionLocation, 2, this.gl.FLOAT, false, 0, 0);\n    }\n    \n    /**\n     * Resize canvas and viewport\n     */\n    resize() {\n        // Mobile-optimized canvas sizing\n        const dpr = Math.min(window.devicePixelRatio || 1, 2); // Cap at 2x for mobile performance\n        const width = this.canvas.clientWidth;\n        const height = this.canvas.clientHeight;\n        \n        // Mobile debug: Check for zero dimensions that would cause invisible rendering\n        if (window.mobileDebug && (width === 0 || height === 0) && !this._zeroDimWarned) {\n            window.mobileDebug.log(`‚ö†Ô∏è ${this.canvas?.id}: Canvas clientWidth=${width}, clientHeight=${height} - will be invisible`);\n            this._zeroDimWarned = true;\n        }\n        \n        // Only resize if dimensions actually changed (mobile optimization)\n        if (this.canvas.width !== width * dpr || this.canvas.height !== height * dpr) {\n            this.canvas.width = width * dpr;\n            this.canvas.height = height * dpr;\n            this.gl.viewport(0, 0, this.canvas.width, this.canvas.height);\n            \n            // Mobile debug: Log final canvas dimensions\n            if (window.mobileDebug && !this._finalSizeLogged) {\n                window.mobileDebug.log(`üìê ${this.canvas?.id}: Final canvas buffer ${this.canvas.width}x${this.canvas.height} (DPR=${dpr})`);\n                this._finalSizeLogged = true;\n            }\n        }\n    }\n    \n    /**\n     * Show user-friendly WebGL error message\n     */\n    showWebGLError() {\n        if (!this.canvas) return;\n        const ctx = this.canvas.getContext('2d');\n        if (ctx) {\n            ctx.fillStyle = '#000';\n            ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n            ctx.fillStyle = '#64ff96';\n            ctx.font = '16px Orbitron, monospace';\n            ctx.textAlign = 'center';\n            ctx.fillText('WebGL Required', this.canvas.width / 2, this.canvas.height / 2);\n            ctx.fillStyle = '#888';\n            ctx.font = '12px Orbitron, monospace';\n            ctx.fillText('Please enable WebGL in your browser', this.canvas.width / 2, this.canvas.height / 2 + 25);\n        }\n    }\n    \n    /**\n     * Update visualization parameters with immediate GPU sync\n     */\n    updateParameters(params) {\n        if (!params || typeof params !== 'object') return;\n        // Filter to only finite numbers to prevent NaN/Infinity reaching GPU uniforms\n        for (const [key, value] of Object.entries(params)) {\n            if (typeof value === 'number' && Number.isFinite(value)) {\n                this.params[key] = value;\n            }\n        }\n        // Don't call render() here - engine will call it to prevent infinite loop\n    }\n    \n    /**\n     * Update mouse interaction state\n     */\n    updateInteraction(x, y, intensity) {\n        this.mouseX = x;\n        this.mouseY = y;\n        this.mouseIntensity = intensity;\n    }\n    \n    /**\n     * Render frame\n     */\n    render() {\n        if (!this.program || this._contextLost) return;\n        if (!this.gl || this.gl.isContextLost()) {\n            this._contextLost = true;\n            return;\n        }\n\n        this.resize();\n        this.gl.useProgram(this.program);\n        \n        // CRITICAL FIX: Clear framebuffer before rendering\n        this.gl.clearColor(0.0, 0.0, 0.0, 0.0);\n        this.gl.clear(this.gl.COLOR_BUFFER_BIT);\n        \n        // Mobile optimization: Log render parameters once per canvas (console only)\n        if (!this._renderParamsLogged) {\n            console.log(`[Mobile] ${this.canvas?.id}: Render params - geometry=${this.params.geometry}, gridDensity=${this.params.gridDensity}, intensity=${this.params.intensity}`);\n            this._renderParamsLogged = true;\n        }\n        \n        const time = Date.now() - this.startTime;\n        \n        // Set uniforms\n        this.gl.uniform2f(this.uniforms.resolution, this.canvas.width, this.canvas.height);\n        this.gl.uniform1f(this.uniforms.time, time);\n        this.gl.uniform2f(this.uniforms.mouse, this.mouseX, this.mouseY);\n        this.gl.uniform1f(this.uniforms.geometry, this.params.geometry);\n        // üéµ QUANTUM AUDIO REACTIVITY - Direct and effective\n        let gridDensity = this.params.gridDensity;\n        let morphFactor = this.params.morphFactor;\n        let hue = this.params.hue;\n        let chaos = this.params.chaos;\n        \n        if (window.audioEnabled && window.audioReactive) {\n            // Quantum audio mapping: Enhanced complex lattice response\n            gridDensity += window.audioReactive.bass * 40;      // Bass creates dense lattice structures\n            morphFactor += window.audioReactive.mid * 1.2;      // Mid frequencies morph the geometry\n            hue += window.audioReactive.high * 120;             // High frequencies shift colors dramatically\n            chaos += window.audioReactive.energy * 0.6;         // Overall energy adds chaos/complexity\n            \n            // Debug logging every 10 seconds to verify audio reactivity is working\n            if (Date.now() % 10000 < 16) {\n                console.log(`üåå Quantum audio reactivity: Density+${(window.audioReactive.bass * 40).toFixed(1)} Morph+${(window.audioReactive.mid * 1.2).toFixed(2)} Hue+${(window.audioReactive.high * 120).toFixed(1)} Chaos+${(window.audioReactive.energy * 0.6).toFixed(2)}`);\n            }\n        }\n        \n        this.gl.uniform1f(this.uniforms.gridDensity, Math.min(100, gridDensity));\n        this.gl.uniform1f(this.uniforms.morphFactor, Math.min(2, morphFactor));\n        this.gl.uniform1f(this.uniforms.chaos, Math.min(1, chaos));\n        this.gl.uniform1f(this.uniforms.speed, this.params.speed);\n        // Hue passed as normalized 0-1 for HSL color control\n        this.gl.uniform1f(this.uniforms.hue, (hue % 360) / 360.0);\n        this.gl.uniform1f(this.uniforms.intensity, this.params.intensity);\n        this.gl.uniform1f(this.uniforms.saturation, this.params.saturation);\n        this.gl.uniform1f(this.uniforms.dimension, this.params.dimension);\n        this.gl.uniform1f(this.uniforms.rot4dXY, this.params.rot4dXY || 0.0);\n        this.gl.uniform1f(this.uniforms.rot4dXZ, this.params.rot4dXZ || 0.0);\n        this.gl.uniform1f(this.uniforms.rot4dYZ, this.params.rot4dYZ || 0.0);\n        this.gl.uniform1f(this.uniforms.rot4dXW, this.params.rot4dXW || 0.0);\n        this.gl.uniform1f(this.uniforms.rot4dYW, this.params.rot4dYW || 0.0);\n        this.gl.uniform1f(this.uniforms.rot4dZW, this.params.rot4dZW || 0.0);\n        this.gl.uniform1f(this.uniforms.mouseIntensity, this.mouseIntensity);\n        this.gl.uniform1f(this.uniforms.clickIntensity, this.clickIntensity);\n        this.gl.uniform1f(this.uniforms.roleIntensity, ROLE_INTENSITIES[this.role] || 1.0);\n        this.gl.uniform1f(this.uniforms.breath, this.params.breath || 0.0);\n        \n        this.gl.drawArrays(this.gl.TRIANGLE_STRIP, 0, 4);\n    }\n    \n    // Audio reactivity now handled directly in render() loop - no complex methods needed\n    \n    /**\n     * Clean up WebGL resources\n     */\n    destroy() {\n        // Remove context loss listeners\n        if (this.canvas) {\n            if (this._onContextLost) {\n                this.canvas.removeEventListener('webglcontextlost', this._onContextLost);\n            }\n            if (this._onContextRestored) {\n                this.canvas.removeEventListener('webglcontextrestored', this._onContextRestored);\n            }\n        }\n\n        // Clean up WebGL resources (guard against lost context)\n        if (this.gl && !this.gl.isContextLost()) {\n            if (this.program) {\n                this.gl.deleteProgram(this.program);\n            }\n            if (this.buffer) {\n                this.gl.deleteBuffer(this.buffer);\n            }\n        }\n\n        this.program = null;\n        this.buffer = null;\n        this.gl = null;\n        this._contextLost = true;\n    }\n}","/**\n * VIB34D Parameter Management System\n * Unified parameter control for both holographic and polytopal systems\n */\n\nexport class ParameterManager {\n    constructor() {\n        // Default parameter set combining both systems\n        this.params = {\n            // Current variation\n            variation: 0,\n            \n            // 6D Rotation - 3D space rotations\n            rot4dXY: 0.0,      // X-Y plane rotation (-6.28 to 6.28)\n            rot4dXZ: 0.0,      // X-Z plane rotation (-6.28 to 6.28)\n            rot4dYZ: 0.0,      // Y-Z plane rotation (-6.28 to 6.28)\n            // 4D hyperspace rotations\n            rot4dXW: 0.0,      // X-W plane rotation (-6.28 to 6.28)\n            rot4dYW: 0.0,      // Y-W plane rotation (-6.28 to 6.28)\n            rot4dZW: 0.0,      // Z-W plane rotation (-6.28 to 6.28)\n            dimension: 3.5,    // Dimensional level (3.0 to 4.5)\n            \n            // Holographic Visualization\n            gridDensity: 15,   // Geometric detail (4 to 30)\n            morphFactor: 1.0,  // Shape transformation (0 to 2)\n            chaos: 0.2,        // Randomization level (0 to 1)\n            speed: 1.0,        // Animation speed (0.1 to 3)\n            hue: 200,          // Color rotation (0 to 360)\n            intensity: 0.5,    // Visual intensity (0 to 1)\n            saturation: 0.8,   // Color saturation (0 to 1)\n            \n            // Geometry selection\n            geometry: 0        // Current geometry type (0-7)\n        };\n        \n        // Parameter definitions for validation and UI\n        this.parameterDefs = {\n            variation: { min: 0, max: 99, step: 1, type: 'int' },\n            // 3D Space Rotations\n            rot4dXY: { min: -6.28, max: 6.28, step: 0.01, type: 'float' },\n            rot4dXZ: { min: -6.28, max: 6.28, step: 0.01, type: 'float' },\n            rot4dYZ: { min: -6.28, max: 6.28, step: 0.01, type: 'float' },\n            // 4D Hyperspace Rotations\n            rot4dXW: { min: -2, max: 2, step: 0.01, type: 'float' },\n            rot4dYW: { min: -2, max: 2, step: 0.01, type: 'float' },\n            rot4dZW: { min: -2, max: 2, step: 0.01, type: 'float' },\n            dimension: { min: 3.0, max: 4.5, step: 0.01, type: 'float' },\n            gridDensity: { min: 4, max: 100, step: 0.1, type: 'float' },\n            morphFactor: { min: 0, max: 2, step: 0.01, type: 'float' },\n            chaos: { min: 0, max: 1, step: 0.01, type: 'float' },\n            speed: { min: 0.1, max: 3, step: 0.01, type: 'float' },\n            hue: { min: 0, max: 360, step: 1, type: 'int' },\n            intensity: { min: 0, max: 1, step: 0.01, type: 'float' },\n            saturation: { min: 0, max: 1, step: 0.01, type: 'float' },\n            geometry: { min: 0, max: 23, step: 1, type: 'int' }\n        };\n        \n        // Default parameter backup for reset\n        this.defaults = { ...this.params };\n    }\n    \n    /**\n     * Get all current parameters\n     */\n    getAllParameters() {\n        return { ...this.params };\n    }\n    \n    /**\n     * Set a specific parameter with validation\n     */\n    setParameter(name, value) {\n        if (this.parameterDefs[name]) {\n            const def = this.parameterDefs[name];\n\n            // Coerce to number and reject NaN/Infinity\n            value = Number(value);\n            if (!Number.isFinite(value)) {\n                console.warn(`Parameter \"${name}\" received non-finite value, ignoring`);\n                return false;\n            }\n\n            // Clamp value to valid range\n            value = Math.max(def.min, Math.min(def.max, value));\n\n            // Apply type conversion\n            if (def.type === 'int') {\n                value = Math.round(value);\n            }\n\n            this.params[name] = value;\n            return true;\n        }\n\n        console.warn(`Unknown parameter: ${name}`);\n        return false;\n    }\n    \n    /**\n     * Set multiple parameters at once\n     */\n    setParameters(paramObj) {\n        for (const [name, value] of Object.entries(paramObj)) {\n            this.setParameter(name, value);\n        }\n    }\n    \n    /**\n     * Get a specific parameter value\n     */\n    getParameter(name) {\n        return this.params[name];\n    }\n    \n    /**\n     * Set geometry type with validation\n     */\n    setGeometry(geometryType) {\n        this.setParameter('geometry', geometryType);\n    }\n    \n    /**\n     * Update parameters from UI controls\n     */\n    updateFromControls() {\n        const controlIds = [\n            'variationSlider', 'rot4dXW', 'rot4dYW', 'rot4dZW', 'dimension',\n            'gridDensity', 'morphFactor', 'chaos', 'speed', 'hue'\n        ];\n        \n        controlIds.forEach(id => {\n            const element = document.getElementById(id);\n            if (element) {\n                const value = parseFloat(element.value);\n                if (!Number.isFinite(value)) return;\n\n                // Map slider IDs to parameter names\n                let paramName = id;\n                if (id === 'variationSlider') {\n                    paramName = 'variation';\n                }\n\n                this.setParameter(paramName, value);\n            }\n        });\n    }\n    \n    /**\n     * Update UI display values from current parameters\n     */\n    updateDisplayValues() {\n        // Update slider values\n        this.updateSliderValue('variationSlider', this.params.variation);\n        this.updateSliderValue('rot4dXW', this.params.rot4dXW);\n        this.updateSliderValue('rot4dYW', this.params.rot4dYW);\n        this.updateSliderValue('rot4dZW', this.params.rot4dZW);\n        this.updateSliderValue('dimension', this.params.dimension);\n        this.updateSliderValue('gridDensity', this.params.gridDensity);\n        this.updateSliderValue('morphFactor', this.params.morphFactor);\n        this.updateSliderValue('chaos', this.params.chaos);\n        this.updateSliderValue('speed', this.params.speed);\n        this.updateSliderValue('hue', this.params.hue);\n        \n        // Update display texts\n        this.updateDisplayText('rot4dXWDisplay', this.params.rot4dXW.toFixed(2));\n        this.updateDisplayText('rot4dYWDisplay', this.params.rot4dYW.toFixed(2));\n        this.updateDisplayText('rot4dZWDisplay', this.params.rot4dZW.toFixed(2));\n        this.updateDisplayText('dimensionDisplay', this.params.dimension.toFixed(2));\n        this.updateDisplayText('gridDensityDisplay', this.params.gridDensity.toFixed(1));\n        this.updateDisplayText('morphFactorDisplay', this.params.morphFactor.toFixed(2));\n        this.updateDisplayText('chaosDisplay', this.params.chaos.toFixed(2));\n        this.updateDisplayText('speedDisplay', this.params.speed.toFixed(2));\n        this.updateDisplayText('hueDisplay', this.params.hue + '¬∞');\n        \n        // Update variation info\n        this.updateVariationInfo();\n        \n        // Update geometry preset buttons\n        this.updateGeometryButtons();\n    }\n    \n    updateSliderValue(id, value) {\n        const element = document.getElementById(id);\n        if (element) {\n            element.value = value;\n        }\n    }\n    \n    updateDisplayText(id, text) {\n        const element = document.getElementById(id);\n        if (element) {\n            element.textContent = text;\n        }\n    }\n    \n    updateVariationInfo() {\n        const variationDisplay = document.getElementById('currentVariationDisplay');\n        if (variationDisplay) {\n            const geometryNames = [\n                'TETRAHEDRON LATTICE', 'HYPERCUBE LATTICE', 'SPHERE LATTICE', 'TORUS LATTICE',\n                'KLEIN BOTTLE LATTICE', 'FRACTAL LATTICE', 'WAVE LATTICE', 'CRYSTAL LATTICE'\n            ];\n            \n            const geometryType = Math.floor(this.params.variation / 4);\n            const geometryLevel = (this.params.variation % 4) + 1;\n            const geometryName = geometryNames[geometryType] || 'CUSTOM VARIATION';\n            \n            variationDisplay.textContent = `${this.params.variation + 1} - ${geometryName}`;\n            \n            if (this.params.variation < 30) {\n                variationDisplay.textContent += ` ${geometryLevel}`;\n            }\n        }\n    }\n    \n    updateGeometryButtons() {\n        document.querySelectorAll('[data-geometry]').forEach(btn => {\n            btn.classList.toggle('active', parseInt(btn.dataset.geometry) === this.params.geometry);\n        });\n    }\n    \n    /**\n     * Randomize all parameters\n     */\n    randomizeAll() {\n        // 3D Space Rotations\n        this.params.rot4dXY = Math.random() * 12.56 - 6.28;\n        this.params.rot4dXZ = Math.random() * 12.56 - 6.28;\n        this.params.rot4dYZ = Math.random() * 12.56 - 6.28;\n        // 4D Hyperspace Rotations\n        this.params.rot4dXW = Math.random() * 4 - 2;\n        this.params.rot4dYW = Math.random() * 4 - 2;\n        this.params.rot4dZW = Math.random() * 4 - 2;\n        // Visual Parameters\n        this.params.dimension = 3.0 + Math.random() * 1.5;\n        this.params.gridDensity = 4 + Math.random() * 26;\n        this.params.morphFactor = Math.random() * 2;\n        this.params.chaos = Math.random();\n        this.params.speed = 0.1 + Math.random() * 2.9;\n        this.params.hue = Math.random() * 360;\n        this.params.geometry = Math.floor(Math.random() * 24);\n    }\n    \n    /**\n     * Reset to default parameters\n     */\n    resetToDefaults() {\n        this.params = { ...this.defaults };\n    }\n    \n    /**\n     * Load parameter configuration\n     */\n    loadConfiguration(config) {\n        if (!config || typeof config !== 'object') return false;\n\n        // If it has a parameters sub-object, use that (export format)\n        const params = config.parameters || config;\n        if (typeof params !== 'object') return false;\n\n        for (const [key, value] of Object.entries(params)) {\n            if (this.parameterDefs[key]) {\n                this.setParameter(key, value);\n            }\n        }\n        return true;\n    }\n    \n    /**\n     * Export current configuration\n     */\n    exportConfiguration() {\n        return {\n            type: 'vib34d-integrated-config',\n            version: '2.0.3',\n            timestamp: new Date().toISOString(),\n            name: `VIB34D Config ${new Date().toLocaleDateString()}`,\n            parameters: { ...this.params }\n        };\n    }\n    \n    /**\n     * Generate variation-specific parameters\n     */\n    generateVariationParameters(variationIndex) {\n        if (variationIndex < 30) {\n            // Default variations with consistent patterns\n            const geometryType = Math.floor(variationIndex / 4);\n            const level = variationIndex % 4;\n            \n            return {\n                geometry: geometryType,\n                gridDensity: 8 + (level * 4),\n                morphFactor: 0.5 + (level * 0.3),\n                chaos: level * 0.15,\n                speed: 0.8 + (level * 0.2),\n                hue: (geometryType * 45 + level * 15) % 360,\n                rot4dXW: (level - 1.5) * 0.5,\n                rot4dYW: (geometryType % 2) * 0.3,\n                rot4dZW: ((geometryType + level) % 3) * 0.2,\n                dimension: 3.2 + (level * 0.2)\n            };\n        } else {\n            // Custom variations - return current parameters\n            return { ...this.params };\n        }\n    }\n    \n    /**\n     * Apply variation to current parameters\n     */\n    applyVariation(variationIndex) {\n        const variationParams = this.generateVariationParameters(variationIndex);\n        this.setParameters(variationParams);\n        this.params.variation = variationIndex;\n    }\n    \n    /**\n     * Get HSV color values for current hue\n     */\n    getColorHSV() {\n        return {\n            h: this.params.hue,\n            s: 0.8, // Fixed saturation\n            v: 0.9  // Fixed value\n        };\n    }\n    \n    /**\n     * Get RGB color values for current hue\n     */\n    getColorRGB() {\n        const hsv = this.getColorHSV();\n        return this.hsvToRgb(hsv.h, hsv.s, hsv.v);\n    }\n    \n    /**\n     * Convert HSV to RGB\n     */\n    hsvToRgb(h, s, v) {\n        h = h / 60;\n        const c = v * s;\n        const x = c * (1 - Math.abs((h % 2) - 1));\n        const m = v - c;\n        \n        let r, g, b;\n        if (h < 1) {\n            [r, g, b] = [c, x, 0];\n        } else if (h < 2) {\n            [r, g, b] = [x, c, 0];\n        } else if (h < 3) {\n            [r, g, b] = [0, c, x];\n        } else if (h < 4) {\n            [r, g, b] = [0, x, c];\n        } else if (h < 5) {\n            [r, g, b] = [x, 0, c];\n        } else {\n            [r, g, b] = [c, 0, x];\n        }\n        \n        return {\n            r: Math.round((r + m) * 255),\n            g: Math.round((g + m) * 255),\n            b: Math.round((b + m) * 255)\n        };\n    }\n    \n    /**\n     * Validate parameter configuration\n     */\n    validateConfiguration(config) {\n        if (!config || typeof config !== 'object') {\n            return { valid: false, error: 'Configuration must be an object' };\n        }\n        \n        if (config.type !== 'vib34d-integrated-config') {\n            return { valid: false, error: 'Invalid configuration type' };\n        }\n        \n        if (!config.parameters) {\n            return { valid: false, error: 'Missing parameters object' };\n        }\n        \n        // Validate individual parameters\n        for (const [key, value] of Object.entries(config.parameters)) {\n            if (this.parameterDefs[key]) {\n                const def = this.parameterDefs[key];\n                if (typeof value !== 'number' || value < def.min || value > def.max) {\n                    return { valid: false, error: `Invalid value for parameter ${key}: ${value}` };\n                }\n            }\n        }\n        \n        return { valid: true };\n    }\n}","/**\n * RenderResourceRegistry - Centralized GPU resource lifecycle tracking.\n *\n * Tracks WebGL/WebGPU resources by type with optional byte sizing to help\n * manage disposal and provide lifecycle visibility to renderer contracts.\n *\n * Features:\n * - Resource registration with type, handle, disposer, and metadata\n * - Peak usage tracking (high watermark)\n * - Per-frame delta statistics\n * - Allocation/deallocation history for debugging\n * - Resource leak detection\n * - Timeline recording for performance analysis\n */\n\n/**\n * Resource allocation event\n */\nclass ResourceEvent {\n    constructor(type, action, bytes, label = null) {\n        this.timestamp = performance.now();\n        this.type = type;\n        this.action = action; // 'alloc' | 'free'\n        this.bytes = bytes;\n        this.label = label;\n    }\n}\n\nexport class RenderResourceRegistry {\n    /**\n     * @param {object} [options]\n     * @param {boolean} [options.trackHistory] - Enable allocation history\n     * @param {number} [options.historyLimit] - Max history entries (default 1000)\n     * @param {boolean} [options.detectLeaks] - Enable leak detection warnings\n     */\n    constructor(options = {}) {\n        this._resources = new Map();\n\n        // Diagnostics options\n        this._trackHistory = options.trackHistory || false;\n        this._historyLimit = options.historyLimit || 1000;\n        this._detectLeaks = options.detectLeaks || false;\n\n        // Peak usage tracking\n        this._peakResources = 0;\n        this._peakBytes = 0;\n        this._peakByType = new Map();\n\n        // Per-frame delta tracking\n        this._frameStartResources = 0;\n        this._frameStartBytes = 0;\n        this._frameDelta = { resources: 0, bytes: 0 };\n\n        // Allocation history\n        /** @type {ResourceEvent[]} */\n        this._history = [];\n\n        // Leak detection\n        this._disposedTypes = new Set();\n\n        // Statistics\n        this._stats = {\n            totalAllocations: 0,\n            totalDeallocations: 0,\n            currentResources: 0,\n            currentBytes: 0\n        };\n    }\n\n    /**\n     * Enable or disable history tracking\n     * @param {boolean} enabled\n     */\n    setHistoryTracking(enabled) {\n        this._trackHistory = enabled;\n        if (!enabled) {\n            this._history = [];\n        }\n    }\n\n    /**\n     * Mark the start of a frame for delta tracking\n     */\n    beginFrame() {\n        this._frameStartResources = this._stats.currentResources;\n        this._frameStartBytes = this._stats.currentBytes;\n    }\n\n    /**\n     * Mark the end of a frame and calculate deltas\n     * @returns {object} Frame delta statistics\n     */\n    endFrame() {\n        this._frameDelta = {\n            resources: this._stats.currentResources - this._frameStartResources,\n            bytes: this._stats.currentBytes - this._frameStartBytes\n        };\n        return this._frameDelta;\n    }\n\n    /**\n     * Register a resource\n     * @param {string} type - Resource type (buffer, texture, shader, etc.)\n     * @param {any} handle - GPU resource handle\n     * @param {function} [disposer] - Cleanup function\n     * @param {object} [options]\n     * @param {number} [options.bytes] - Resource size in bytes\n     * @param {string} [options.label] - Debug label\n     * @returns {object|null} Resource entry\n     */\n    register(type, handle, disposer, options = {}) {\n        if (!handle) {\n            return null;\n        }\n\n        const bytes = options.bytes ?? 0;\n        const label = options.label ?? null;\n\n        const entry = {\n            handle,\n            disposer,\n            bytes,\n            label,\n            createdAt: performance.now(),\n            id: ++this._stats.totalAllocations\n        };\n\n        const bucket = this._resources.get(type) ?? new Set();\n        bucket.add(entry);\n        this._resources.set(type, bucket);\n\n        // Update statistics\n        this._stats.currentResources++;\n        this._stats.currentBytes += bytes;\n\n        // Update peak tracking\n        this._updatePeakStats(type);\n\n        // Record history\n        if (this._trackHistory) {\n            this._recordEvent(type, 'alloc', bytes, label);\n        }\n\n        return entry;\n    }\n\n    /**\n     * Release a resource without disposing\n     * @param {string} type\n     * @param {any} handle\n     * @returns {boolean}\n     */\n    release(type, handle) {\n        const bucket = this._resources.get(type);\n        if (!bucket) return false;\n\n        for (const entry of bucket) {\n            if (entry.handle === handle) {\n                bucket.delete(entry);\n\n                // Update statistics\n                this._stats.currentResources--;\n                this._stats.currentBytes -= entry.bytes;\n                this._stats.totalDeallocations++;\n\n                // Record history\n                if (this._trackHistory) {\n                    this._recordEvent(type, 'free', entry.bytes, entry.label);\n                }\n\n                if (bucket.size === 0) {\n                    this._resources.delete(type);\n                }\n                return true;\n            }\n        }\n        return false;\n    }\n\n    /**\n     * Dispose a resource (call disposer and release)\n     * @param {string} type\n     * @param {any} handle\n     * @returns {boolean}\n     */\n    dispose(type, handle) {\n        const bucket = this._resources.get(type);\n        if (!bucket) return false;\n\n        for (const entry of bucket) {\n            if (entry.handle === handle) {\n                if (entry.disposer) {\n                    try {\n                        entry.disposer();\n                    } catch (e) {\n                        console.warn(`RenderResourceRegistry: dispose error for ${type}:`, e);\n                    }\n                }\n\n                bucket.delete(entry);\n\n                // Update statistics\n                this._stats.currentResources--;\n                this._stats.currentBytes -= entry.bytes;\n                this._stats.totalDeallocations++;\n\n                // Record history\n                if (this._trackHistory) {\n                    this._recordEvent(type, 'free', entry.bytes, entry.label);\n                }\n\n                if (bucket.size === 0) {\n                    this._resources.delete(type);\n                }\n                return true;\n            }\n        }\n        return false;\n    }\n\n    /**\n     * Dispose all resources of a type\n     * @param {string} type\n     * @returns {number} Number of resources disposed\n     */\n    disposeType(type) {\n        const bucket = this._resources.get(type);\n        if (!bucket) return 0;\n\n        let count = 0;\n        for (const entry of bucket) {\n            if (entry.disposer) {\n                try {\n                    entry.disposer();\n                } catch (e) {\n                    console.warn(`RenderResourceRegistry: dispose error for ${type}:`, e);\n                }\n            }\n\n            this._stats.currentResources--;\n            this._stats.currentBytes -= entry.bytes;\n            this._stats.totalDeallocations++;\n\n            if (this._trackHistory) {\n                this._recordEvent(type, 'free', entry.bytes, entry.label);\n            }\n\n            count++;\n        }\n\n        this._resources.delete(type);\n        this._disposedTypes.add(type);\n\n        return count;\n    }\n\n    /**\n     * Dispose all resources\n     */\n    disposeAll() {\n        for (const [type, bucket] of this._resources.entries()) {\n            for (const entry of bucket) {\n                if (entry.disposer) {\n                    try {\n                        entry.disposer();\n                    } catch (e) {\n                        console.warn(`RenderResourceRegistry: dispose error for ${type}:`, e);\n                    }\n                }\n\n                this._stats.totalDeallocations++;\n\n                if (this._trackHistory) {\n                    this._recordEvent(type, 'free', entry.bytes, entry.label);\n                }\n            }\n            this._disposedTypes.add(type);\n        }\n\n        this._stats.currentResources = 0;\n        this._stats.currentBytes = 0;\n        this._resources.clear();\n    }\n\n    /**\n     * Update peak statistics\n     * @private\n     */\n    _updatePeakStats(type) {\n        // Global peaks\n        if (this._stats.currentResources > this._peakResources) {\n            this._peakResources = this._stats.currentResources;\n        }\n        if (this._stats.currentBytes > this._peakBytes) {\n            this._peakBytes = this._stats.currentBytes;\n        }\n\n        // Per-type peaks\n        const bucket = this._resources.get(type);\n        if (bucket) {\n            const current = bucket.size;\n            const peak = this._peakByType.get(type) || 0;\n            if (current > peak) {\n                this._peakByType.set(type, current);\n            }\n        }\n    }\n\n    /**\n     * Record history event\n     * @private\n     */\n    _recordEvent(type, action, bytes, label) {\n        this._history.push(new ResourceEvent(type, action, bytes, label));\n\n        // Trim history if over limit\n        if (this._history.length > this._historyLimit) {\n            this._history = this._history.slice(-this._historyLimit);\n        }\n    }\n\n    /**\n     * Get basic statistics\n     * @returns {object}\n     */\n    getStats() {\n        const stats = {\n            totalResources: this._stats.currentResources,\n            totalBytes: this._stats.currentBytes,\n            byType: {}\n        };\n\n        for (const [type, bucket] of this._resources.entries()) {\n            let bytes = 0;\n            for (const entry of bucket) {\n                bytes += entry.bytes;\n            }\n            stats.byType[type] = {\n                count: bucket.size,\n                bytes\n            };\n        }\n\n        return stats;\n    }\n\n    /**\n     * Get detailed diagnostics\n     * @returns {object}\n     */\n    getDiagnostics() {\n        const basicStats = this.getStats();\n\n        return {\n            ...basicStats,\n\n            // Peak usage\n            peak: {\n                resources: this._peakResources,\n                bytes: this._peakBytes,\n                byType: Object.fromEntries(this._peakByType)\n            },\n\n            // Frame delta\n            frameDelta: { ...this._frameDelta },\n\n            // Lifetime statistics\n            lifetime: {\n                totalAllocations: this._stats.totalAllocations,\n                totalDeallocations: this._stats.totalDeallocations,\n                netAllocations: this._stats.totalAllocations - this._stats.totalDeallocations\n            },\n\n            // Memory efficiency\n            efficiency: {\n                utilizationPercent: this._peakBytes > 0\n                    ? (this._stats.currentBytes / this._peakBytes * 100).toFixed(1)\n                    : 100,\n                averageBytesPerResource: this._stats.currentResources > 0\n                    ? Math.round(this._stats.currentBytes / this._stats.currentResources)\n                    : 0\n            }\n        };\n    }\n\n    /**\n     * Get allocation history\n     * @param {object} [options]\n     * @param {string} [options.type] - Filter by resource type\n     * @param {string} [options.action] - Filter by action ('alloc' or 'free')\n     * @param {number} [options.limit] - Max entries to return\n     * @returns {ResourceEvent[]}\n     */\n    getHistory(options = {}) {\n        let history = this._history;\n\n        if (options.type) {\n            history = history.filter(e => e.type === options.type);\n        }\n        if (options.action) {\n            history = history.filter(e => e.action === options.action);\n        }\n        if (options.limit) {\n            history = history.slice(-options.limit);\n        }\n\n        return history;\n    }\n\n    /**\n     * Get resources by type\n     * @param {string} type\n     * @returns {Array<object>}\n     */\n    getResourcesByType(type) {\n        const bucket = this._resources.get(type);\n        if (!bucket) return [];\n\n        return Array.from(bucket).map(entry => ({\n            label: entry.label,\n            bytes: entry.bytes,\n            createdAt: entry.createdAt,\n            age: performance.now() - entry.createdAt,\n            id: entry.id\n        }));\n    }\n\n    /**\n     * Check for potential leaks (resources held too long)\n     * @param {number} [ageThreshold] - Age in ms to consider as potential leak (default 60000)\n     * @returns {Array<object>}\n     */\n    detectLeaks(ageThreshold = 60000) {\n        const now = performance.now();\n        const potentialLeaks = [];\n\n        for (const [type, bucket] of this._resources.entries()) {\n            for (const entry of bucket) {\n                const age = now - entry.createdAt;\n                if (age > ageThreshold) {\n                    potentialLeaks.push({\n                        type,\n                        label: entry.label,\n                        bytes: entry.bytes,\n                        age: Math.round(age),\n                        id: entry.id\n                    });\n                }\n            }\n        }\n\n        return potentialLeaks;\n    }\n\n    /**\n     * Reset peak statistics\n     */\n    resetPeakStats() {\n        this._peakResources = this._stats.currentResources;\n        this._peakBytes = this._stats.currentBytes;\n        this._peakByType.clear();\n\n        for (const [type, bucket] of this._resources.entries()) {\n            this._peakByType.set(type, bucket.size);\n        }\n    }\n\n    /**\n     * Clear allocation history\n     */\n    clearHistory() {\n        this._history = [];\n    }\n\n    /**\n     * Export diagnostics as JSON\n     * @returns {string}\n     */\n    exportDiagnosticsJSON() {\n        return JSON.stringify({\n            diagnostics: this.getDiagnostics(),\n            history: this._history.map(e => ({\n                timestamp: e.timestamp,\n                type: e.type,\n                action: e.action,\n                bytes: e.bytes,\n                label: e.label\n            }))\n        }, null, 2);\n    }\n\n    /**\n     * Get summary string for debug overlay\n     * @returns {string}\n     */\n    getSummaryString() {\n        const d = this.getDiagnostics();\n        const lines = [\n            `Resources: ${d.totalResources} (peak: ${d.peak.resources})`,\n            `Memory: ${this._formatBytes(d.totalBytes)} (peak: ${this._formatBytes(d.peak.bytes)})`,\n            `Frame Œî: ${d.frameDelta.resources >= 0 ? '+' : ''}${d.frameDelta.resources} resources`\n        ];\n\n        // Add per-type breakdown\n        for (const [type, data] of Object.entries(d.byType)) {\n            lines.push(`  ${type}: ${data.count} (${this._formatBytes(data.bytes)})`);\n        }\n\n        return lines.join('\\n');\n    }\n\n    /**\n     * Format bytes for display\n     * @private\n     */\n    _formatBytes(bytes) {\n        if (bytes < 1024) return `${bytes}B`;\n        if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)}KB`;\n        return `${(bytes / (1024 * 1024)).toFixed(2)}MB`;\n    }\n}\n\nexport default RenderResourceRegistry;\n","/**\n * WebGPUBackend - WebGPU rendering backend for VIB3+ engine\n *\n * Features:\n * - Device/context initialization with feature detection\n * - Canvas configuration + resize handling\n * - Shader pipeline management (custom WGSL compilation)\n * - Uniform buffer handling (custom layouts)\n * - Fullscreen quad procedural rendering (core VIB3+ pattern)\n * - Multi-pipeline support with named pipelines\n * - Texture creation and binding\n * - Render state management\n */\n\nimport { RenderResourceRegistry } from '../RenderResourceRegistry.js';\n\n/**\n * Default vertex shader for geometry rendering\n */\nconst DEFAULT_VERTEX_SHADER = /* wgsl */`\nstruct Uniforms {\n    modelMatrix: mat4x4<f32>,\n    viewMatrix: mat4x4<f32>,\n    projectionMatrix: mat4x4<f32>,\n    time: f32,\n    dimension: f32,\n    _padding: vec2<f32>,\n};\n\n@group(0) @binding(0) var<uniform> uniforms: Uniforms;\n\nstruct VertexInput {\n    @location(0) position: vec4<f32>,\n    @location(1) color: vec4<f32>,\n};\n\nstruct VertexOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) color: vec4<f32>,\n    @location(1) worldPos: vec3<f32>,\n};\n\n@vertex\nfn main(input: VertexInput) -> VertexOutput {\n    var output: VertexOutput;\n\n    // Apply 4D to 3D projection based on dimension parameter\n    let w = input.position.w;\n    let projectionFactor = 1.0 / (uniforms.dimension - w);\n    let projected = vec4<f32>(\n        input.position.x * projectionFactor,\n        input.position.y * projectionFactor,\n        input.position.z * projectionFactor,\n        1.0\n    );\n\n    // Apply model-view-projection\n    let worldPos = uniforms.modelMatrix * projected;\n    let viewPos = uniforms.viewMatrix * worldPos;\n    output.position = uniforms.projectionMatrix * viewPos;\n    output.worldPos = worldPos.xyz;\n    output.color = input.color;\n\n    return output;\n}\n`;\n\n/**\n * Default fragment shader for geometry rendering\n */\nconst DEFAULT_FRAGMENT_SHADER = /* wgsl */`\nstruct FragmentInput {\n    @location(0) color: vec4<f32>,\n    @location(1) worldPos: vec3<f32>,\n};\n\n@fragment\nfn main(input: FragmentInput) -> @location(0) vec4<f32> {\n    // Add subtle depth-based shading\n    let depth = clamp(length(input.worldPos) * 0.2, 0.0, 1.0);\n    let shaded = input.color.rgb * (1.0 - depth * 0.3);\n\n    return vec4<f32>(shaded, input.color.a);\n}\n`;\n\n/**\n * Fullscreen quad vertex shader for procedural rendering.\n * Generates a fullscreen triangle (3 vertices, no vertex buffer needed).\n */\nconst FULLSCREEN_VERTEX_SHADER = /* wgsl */`\nstruct VertexOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv: vec2<f32>,\n};\n\n@vertex\nfn main(@builtin(vertex_index) vertexIndex: u32) -> VertexOutput {\n    var output: VertexOutput;\n\n    // Generate fullscreen triangle (covers entire screen with 3 vertices)\n    // Uses the oversized triangle technique - no vertex buffer needed\n    let x = f32(i32(vertexIndex & 1u) * 4 - 1);\n    let y = f32(i32(vertexIndex >> 1u) * 4 - 1);\n    output.position = vec4<f32>(x, y, 0.0, 1.0);\n    output.uv = vec2<f32>((x + 1.0) * 0.5, (1.0 - y) * 0.5);\n\n    return output;\n}\n`;\n\n/**\n * VIB3+ standard uniform struct for procedural shaders (WGSL).\n * Matches the GLSL uniforms used in Quantum/Faceted/Holographic systems.\n */\nconst VIB3_UNIFORM_STRUCT = /* wgsl */`\nstruct VIB3Uniforms {\n    // Time and resolution\n    time: f32,\n    _pad0: f32,\n    resolution: vec2<f32>,\n\n    // Geometry selection (0-23)\n    geometry: f32,\n\n    // 6D Rotation (radians)\n    rot4dXY: f32,\n    rot4dXZ: f32,\n    rot4dYZ: f32,\n    rot4dXW: f32,\n    rot4dYW: f32,\n    rot4dZW: f32,\n\n    // Visual parameters\n    dimension: f32,\n    gridDensity: f32,\n    morphFactor: f32,\n    chaos: f32,\n    speed: f32,\n    hue: f32,\n    intensity: f32,\n    saturation: f32,\n\n    // Reactivity\n    mouseIntensity: f32,\n    clickIntensity: f32,\n    bass: f32,\n    mid: f32,\n    high: f32,\n\n    // Layer parameters (for holographic multi-layer)\n    layerScale: f32,\n    layerOpacity: f32,\n    _pad1: f32,\n    layerColorR: f32,\n    layerColorG: f32,\n    layerColorB: f32,\n    densityMult: f32,\n    speedMult: f32,\n\n    // Vitality\n    breath: f32,\n};\n`;\n\n/**\n * VIB3+ 4D rotation functions in WGSL\n */\nconst VIB3_ROTATION_WGSL = /* wgsl */`\nfn rotateXY(angle: f32) -> mat4x4<f32> {\n    let c = cos(angle);\n    let s = sin(angle);\n    return mat4x4<f32>(\n        vec4<f32>(c, -s, 0.0, 0.0),\n        vec4<f32>(s, c, 0.0, 0.0),\n        vec4<f32>(0.0, 0.0, 1.0, 0.0),\n        vec4<f32>(0.0, 0.0, 0.0, 1.0)\n    );\n}\n\nfn rotateXZ(angle: f32) -> mat4x4<f32> {\n    let c = cos(angle);\n    let s = sin(angle);\n    return mat4x4<f32>(\n        vec4<f32>( c, 0.0, s, 0.0),\n        vec4<f32>(0.0, 1.0, 0.0, 0.0),\n        vec4<f32>(-s, 0.0, c, 0.0),\n        vec4<f32>(0.0, 0.0, 0.0, 1.0)\n    );\n}\n\nfn rotateYZ(angle: f32) -> mat4x4<f32> {\n    let c = cos(angle);\n    let s = sin(angle);\n    return mat4x4<f32>(\n        vec4<f32>(1.0, 0.0, 0.0, 0.0),\n        vec4<f32>(0.0, c, -s, 0.0),\n        vec4<f32>(0.0, s, c, 0.0),\n        vec4<f32>(0.0, 0.0, 0.0, 1.0)\n    );\n}\n\nfn rotateXW(angle: f32) -> mat4x4<f32> {\n    let c = cos(angle);\n    let s = sin(angle);\n    return mat4x4<f32>(\n        vec4<f32>(c, 0.0, 0.0, -s),\n        vec4<f32>(0.0, 1.0, 0.0, 0.0),\n        vec4<f32>(0.0, 0.0, 1.0, 0.0),\n        vec4<f32>(s, 0.0, 0.0, c)\n    );\n}\n\nfn rotateYW(angle: f32) -> mat4x4<f32> {\n    let c = cos(angle);\n    let s = sin(angle);\n    return mat4x4<f32>(\n        vec4<f32>(1.0, 0.0, 0.0, 0.0),\n        vec4<f32>(0.0, c, 0.0, -s),\n        vec4<f32>(0.0, 0.0, 1.0, 0.0),\n        vec4<f32>(0.0, s, 0.0, c)\n    );\n}\n\nfn rotateZW(angle: f32) -> mat4x4<f32> {\n    let c = cos(angle);\n    let s = sin(angle);\n    return mat4x4<f32>(\n        vec4<f32>(1.0, 0.0, 0.0, 0.0),\n        vec4<f32>(0.0, 1.0, 0.0, 0.0),\n        vec4<f32>(0.0, 0.0, c, -s),\n        vec4<f32>(0.0, 0.0, s, c)\n    );\n}\n\nfn apply6DRotation(pos: vec4<f32>, u: VIB3Uniforms) -> vec4<f32> {\n    var p = pos;\n    p = rotateXY(u.rot4dXY) * p;\n    p = rotateXZ(u.rot4dXZ) * p;\n    p = rotateYZ(u.rot4dYZ) * p;\n    p = rotateXW(u.rot4dXW) * p;\n    p = rotateYW(u.rot4dYW) * p;\n    p = rotateZW(u.rot4dZW) * p;\n    return p;\n}\n`;\n\n/**\n * WebGPU feature flags\n */\nexport const WebGPUFeatures = {\n    TIMESTAMP_QUERY: 'timestamp-query',\n    INDIRECT_FIRST_INSTANCE: 'indirect-first-instance',\n    SHADER_F16: 'shader-f16',\n    DEPTH_CLIP_CONTROL: 'depth-clip-control',\n    DEPTH32_STENCIL8: 'depth32float-stencil8',\n    TEXTURE_COMPRESSION_BC: 'texture-compression-bc',\n    RG11B10_UFLOAT_RENDERABLE: 'rg11b10ufloat-renderable',\n    BGRA8_UNORM_STORAGE: 'bgra8unorm-storage'\n};\n\n/**\n * WGSL shader library for VIB3+ systems\n */\nexport const WGSLShaderLib = {\n    uniformStruct: VIB3_UNIFORM_STRUCT,\n    rotation4D: VIB3_ROTATION_WGSL,\n    fullscreenVertex: FULLSCREEN_VERTEX_SHADER\n};\n\nexport class WebGPUBackend {\n    /**\n     * @param {object} params\n     * @param {HTMLCanvasElement} params.canvas\n     * @param {GPUDevice} params.device\n     * @param {GPUCanvasContext} params.context\n     * @param {GPUTextureFormat} params.format\n     * @param {GPUAdapter} [params.adapter]\n     * @param {object} [options]\n     */\n    constructor({ canvas, device, context, format, adapter }, options = {}) {\n        this.canvas = canvas;\n        this.device = device;\n        this.context = context;\n        this.format = format;\n        this.adapter = adapter || null;\n\n        this.debug = options.debug || false;\n        this.depthEnabled = options.depth !== false;\n        this._resources = options.resourceRegistry || new RenderResourceRegistry();\n\n        /** @type {GPUTexture|null} */\n        this._depthTexture = null;\n\n        /** @type {Map<string, GPURenderPipeline>} */\n        this._pipelines = new Map();\n\n        /** @type {Map<string, GPUShaderModule>} */\n        this._shaderModules = new Map();\n\n        /** @type {GPUBuffer|null} - Default geometry uniform buffer */\n        this._uniformBuffer = null;\n\n        /** @type {GPUBindGroup|null} */\n        this._uniformBindGroup = null;\n\n        /** @type {GPUBindGroupLayout|null} */\n        this._uniformBindGroupLayout = null;\n\n        /** @type {Map<string, {buffer: GPUBuffer, bindGroup: GPUBindGroup, layout: GPUBindGroupLayout}>} */\n        this._customUniformBuffers = new Map();\n\n        /** @type {Map<string, GPUTexture>} */\n        this._textures = new Map();\n\n        /** @type {Map<string, GPUSampler>} */\n        this._samplers = new Map();\n\n        /** @type {Set<string>} */\n        this._enabledFeatures = new Set(options.features || []);\n\n        this._stats = {\n            frames: 0,\n            commandEncoders: 0,\n            drawCalls: 0,\n            triangles: 0,\n            pipelineChanges: 0\n        };\n\n        // Initialize uniform buffer\n        this._initUniformBuffer();\n\n        // Create default pipeline\n        this._createDefaultPipeline();\n\n        this.resize(canvas.clientWidth || canvas.width, canvas.clientHeight || canvas.height);\n    }\n\n    // ========================================================================\n    // Feature Detection\n    // ========================================================================\n\n    /**\n     * Check if a feature is supported\n     * @param {string} feature\n     * @returns {boolean}\n     */\n    hasFeature(feature) {\n        return this._enabledFeatures.has(feature);\n    }\n\n    /**\n     * Get GPU info\n     * @returns {object}\n     */\n    getGPUInfo() {\n        if (!this.adapter) return { vendor: 'unknown', architecture: 'unknown' };\n\n        return {\n            vendor: this.adapter.info?.vendor || 'unknown',\n            architecture: this.adapter.info?.architecture || 'unknown',\n            device: this.adapter.info?.device || 'unknown',\n            description: this.adapter.info?.description || 'unknown',\n            features: Array.from(this._enabledFeatures)\n        };\n    }\n\n    // ========================================================================\n    // Uniform Buffer Management\n    // ========================================================================\n\n    /**\n     * Initialize default uniform buffer (geometry rendering)\n     * @private\n     */\n    _initUniformBuffer() {\n        const uniformBufferSize = 256;\n\n        this._uniformBuffer = this.device.createBuffer({\n            size: uniformBufferSize,\n            usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\n        });\n        this._resources.register('buffer', this._uniformBuffer);\n\n        this._uniformBindGroupLayout = this.device.createBindGroupLayout({\n            entries: [{\n                binding: 0,\n                visibility: GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT,\n                buffer: { type: 'uniform' }\n            }]\n        });\n\n        this._uniformBindGroup = this.device.createBindGroup({\n            layout: this._uniformBindGroupLayout,\n            entries: [{\n                binding: 0,\n                resource: { buffer: this._uniformBuffer }\n            }]\n        });\n    }\n\n    /**\n     * Create a custom uniform buffer with its own bind group.\n     * Used for VIB3+ procedural shader uniforms.\n     * @param {string} name - Unique name for the buffer\n     * @param {number} size - Buffer size in bytes (will be aligned to 256)\n     * @param {number} [visibility] - Shader stage visibility\n     * @returns {{buffer: GPUBuffer, bindGroup: GPUBindGroup, layout: GPUBindGroupLayout}}\n     */\n    createCustomUniformBuffer(name, size, visibility) {\n        const vis = visibility ??\n            (GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT);\n\n        // Align to 256 bytes for WebGPU requirements\n        const alignedSize = Math.ceil(size / 256) * 256;\n\n        const buffer = this.device.createBuffer({\n            size: alignedSize,\n            usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\n        });\n        this._resources.register('buffer', buffer);\n\n        const layout = this.device.createBindGroupLayout({\n            entries: [{\n                binding: 0,\n                visibility: vis,\n                buffer: { type: 'uniform' }\n            }]\n        });\n\n        const bindGroup = this.device.createBindGroup({\n            layout,\n            entries: [{\n                binding: 0,\n                resource: { buffer }\n            }]\n        });\n\n        const entry = { buffer, bindGroup, layout };\n        this._customUniformBuffers.set(name, entry);\n        return entry;\n    }\n\n    /**\n     * Update a custom uniform buffer with Float32Array data\n     * @param {string} name - Buffer name\n     * @param {Float32Array} data - Data to write\n     */\n    updateCustomUniforms(name, data) {\n        const entry = this._customUniformBuffers.get(name);\n        if (!entry) {\n            if (this.debug) {\n                console.warn(`Custom uniform buffer \"${name}\" not found`);\n            }\n            return;\n        }\n        this.device.queue.writeBuffer(entry.buffer, 0, data);\n    }\n\n    /**\n     * Get a custom uniform buffer entry\n     * @param {string} name\n     * @returns {{buffer: GPUBuffer, bindGroup: GPUBindGroup, layout: GPUBindGroupLayout}|undefined}\n     */\n    getCustomUniformBuffer(name) {\n        return this._customUniformBuffers.get(name);\n    }\n\n    /**\n     * Update default uniform buffer with current state\n     * @param {object} uniforms\n     */\n    updateUniforms(uniforms) {\n        const data = new Float32Array(64); // 256 bytes / 4\n\n        const model = uniforms.modelMatrix || [1,0,0,0, 0,1,0,0, 0,0,1,0, 0,0,0,1];\n        data.set(model, 0);\n\n        const view = uniforms.viewMatrix || [1,0,0,0, 0,1,0,0, 0,0,1,0, 0,0,-3,1];\n        data.set(view, 16);\n\n        const proj = uniforms.projectionMatrix || this._createProjectionMatrix();\n        data.set(proj, 32);\n\n        data[48] = uniforms.time || 0;\n        data[49] = uniforms.dimension || 3.5;\n\n        this.device.queue.writeBuffer(this._uniformBuffer, 0, data);\n    }\n\n    /**\n     * Create perspective projection matrix\n     * @private\n     */\n    _createProjectionMatrix() {\n        const fov = Math.PI / 4;\n        const aspect = this.canvas.width / this.canvas.height;\n        const near = 0.1;\n        const far = 100;\n\n        const f = 1.0 / Math.tan(fov / 2);\n        const rangeInv = 1 / (near - far);\n\n        return [\n            f / aspect, 0, 0, 0,\n            0, f, 0, 0,\n            0, 0, (near + far) * rangeInv, -1,\n            0, 0, near * far * rangeInv * 2, 0\n        ];\n    }\n\n    // ========================================================================\n    // Shader & Pipeline Management\n    // ========================================================================\n\n    /**\n     * Compile a WGSL shader module from source code\n     * @param {string} name - Unique shader name\n     * @param {string} code - WGSL source code\n     * @returns {GPUShaderModule}\n     */\n    compileShader(name, code) {\n        const module = this.device.createShaderModule({\n            code,\n            label: name\n        });\n        this._shaderModules.set(name, module);\n        return module;\n    }\n\n    /**\n     * Get or create shader module\n     * @param {string} name\n     * @param {string} code\n     * @returns {GPUShaderModule}\n     */\n    _getOrCreateShaderModule(name, code) {\n        if (this._shaderModules.has(name)) {\n            return this._shaderModules.get(name);\n        }\n        return this.compileShader(name, code);\n    }\n\n    /**\n     * Create a fullscreen quad pipeline for procedural fragment rendering.\n     * This is the core rendering pattern for all VIB3+ visualization systems.\n     *\n     * @param {string} name - Pipeline name\n     * @param {string} fragmentCode - WGSL fragment shader code\n     * @param {object} [options]\n     * @param {string} [options.vertexCode] - Custom vertex shader (defaults to fullscreen quad)\n     * @param {GPUBindGroupLayout[]} [options.bindGroupLayouts] - Custom bind group layouts\n     * @param {object} [options.blend] - Custom blend state\n     * @param {boolean} [options.depth] - Enable depth testing\n     * @returns {GPURenderPipeline}\n     */\n    createFullscreenPipeline(name, fragmentCode, options = {}) {\n        const vertexCode = options.vertexCode || FULLSCREEN_VERTEX_SHADER;\n        const vertexModule = this._getOrCreateShaderModule(\n            `${name}-vertex`, vertexCode\n        );\n        const fragmentModule = this._getOrCreateShaderModule(\n            `${name}-fragment`, fragmentCode\n        );\n\n        // Use provided layouts or default to the standard uniform layout\n        const bindGroupLayouts = options.bindGroupLayouts ||\n            [this._uniformBindGroupLayout];\n\n        const pipelineLayout = this.device.createPipelineLayout({\n            bindGroupLayouts\n        });\n\n        const blend = options.blend || {\n            color: {\n                srcFactor: 'src-alpha',\n                dstFactor: 'one-minus-src-alpha',\n                operation: 'add'\n            },\n            alpha: {\n                srcFactor: 'one',\n                dstFactor: 'one-minus-src-alpha',\n                operation: 'add'\n            }\n        };\n\n        const useDepth = options.depth !== undefined ? options.depth : false;\n\n        const pipeline = this.device.createRenderPipeline({\n            layout: pipelineLayout,\n            vertex: {\n                module: vertexModule,\n                entryPoint: 'main',\n                // No vertex buffers - fullscreen triangle uses vertex_index\n            },\n            fragment: {\n                module: fragmentModule,\n                entryPoint: 'main',\n                targets: [{\n                    format: this.format,\n                    blend\n                }]\n            },\n            primitive: {\n                topology: 'triangle-list'\n            },\n            depthStencil: useDepth ? {\n                depthWriteEnabled: true,\n                depthCompare: 'less',\n                format: 'depth24plus'\n            } : undefined\n        });\n\n        this._pipelines.set(name, pipeline);\n        return pipeline;\n    }\n\n    /**\n     * Create a custom render pipeline with vertex buffers (for geometry rendering)\n     * @param {string} name - Pipeline name\n     * @param {object} desc - Pipeline descriptor\n     * @param {string} desc.vertexCode - WGSL vertex shader\n     * @param {string} desc.fragmentCode - WGSL fragment shader\n     * @param {GPUVertexBufferLayout[]} [desc.vertexBuffers] - Vertex buffer layouts\n     * @param {GPUBindGroupLayout[]} [desc.bindGroupLayouts]\n     * @param {object} [desc.blend]\n     * @param {string} [desc.topology]\n     * @param {boolean} [desc.depth]\n     * @returns {GPURenderPipeline}\n     */\n    createPipeline(name, desc) {\n        const vertexModule = this._getOrCreateShaderModule(\n            `${name}-vertex`, desc.vertexCode\n        );\n        const fragmentModule = this._getOrCreateShaderModule(\n            `${name}-fragment`, desc.fragmentCode\n        );\n\n        const bindGroupLayouts = desc.bindGroupLayouts ||\n            [this._uniformBindGroupLayout];\n\n        const pipelineLayout = this.device.createPipelineLayout({\n            bindGroupLayouts\n        });\n\n        const blend = desc.blend || {\n            color: {\n                srcFactor: 'src-alpha',\n                dstFactor: 'one-minus-src-alpha',\n                operation: 'add'\n            },\n            alpha: {\n                srcFactor: 'one',\n                dstFactor: 'one-minus-src-alpha',\n                operation: 'add'\n            }\n        };\n\n        const pipeline = this.device.createRenderPipeline({\n            layout: pipelineLayout,\n            vertex: {\n                module: vertexModule,\n                entryPoint: 'main',\n                buffers: desc.vertexBuffers || [{\n                    arrayStride: 32,\n                    attributes: [\n                        { shaderLocation: 0, offset: 0, format: 'float32x4' },\n                        { shaderLocation: 1, offset: 16, format: 'float32x4' }\n                    ]\n                }]\n            },\n            fragment: {\n                module: fragmentModule,\n                entryPoint: 'main',\n                targets: [{\n                    format: this.format,\n                    blend\n                }]\n            },\n            primitive: {\n                topology: desc.topology || 'triangle-list',\n                cullMode: desc.cullMode || 'none',\n                frontFace: 'ccw'\n            },\n            depthStencil: (desc.depth !== false && this.depthEnabled) ? {\n                depthWriteEnabled: true,\n                depthCompare: 'less',\n                format: 'depth24plus'\n            } : undefined\n        });\n\n        this._pipelines.set(name, pipeline);\n        return pipeline;\n    }\n\n    /**\n     * Get a named pipeline\n     * @param {string} name\n     * @returns {GPURenderPipeline|undefined}\n     */\n    getPipeline(name) {\n        return this._pipelines.get(name);\n    }\n\n    /**\n     * Create default rendering pipeline\n     * @private\n     */\n    _createDefaultPipeline() {\n        const vertexModule = this._getOrCreateShaderModule('default-vertex', DEFAULT_VERTEX_SHADER);\n        const fragmentModule = this._getOrCreateShaderModule('default-fragment', DEFAULT_FRAGMENT_SHADER);\n\n        const pipelineLayout = this.device.createPipelineLayout({\n            bindGroupLayouts: [this._uniformBindGroupLayout]\n        });\n\n        const pipeline = this.device.createRenderPipeline({\n            layout: pipelineLayout,\n            vertex: {\n                module: vertexModule,\n                entryPoint: 'main',\n                buffers: [{\n                    arrayStride: 32,\n                    attributes: [\n                        { shaderLocation: 0, offset: 0, format: 'float32x4' },\n                        { shaderLocation: 1, offset: 16, format: 'float32x4' }\n                    ]\n                }]\n            },\n            fragment: {\n                module: fragmentModule,\n                entryPoint: 'main',\n                targets: [{\n                    format: this.format,\n                    blend: {\n                        color: {\n                            srcFactor: 'src-alpha',\n                            dstFactor: 'one-minus-src-alpha',\n                            operation: 'add'\n                        },\n                        alpha: {\n                            srcFactor: 'one',\n                            dstFactor: 'one-minus-src-alpha',\n                            operation: 'add'\n                        }\n                    }\n                }]\n            },\n            primitive: {\n                topology: 'triangle-list',\n                cullMode: 'back',\n                frontFace: 'ccw'\n            },\n            depthStencil: this.depthEnabled ? {\n                depthWriteEnabled: true,\n                depthCompare: 'less',\n                format: 'depth24plus'\n            } : undefined\n        });\n\n        this._pipelines.set('default', pipeline);\n    }\n\n    // ========================================================================\n    // Texture Management\n    // ========================================================================\n\n    /**\n     * Create a 2D texture\n     * @param {string} name\n     * @param {object} desc\n     * @param {number} desc.width\n     * @param {number} desc.height\n     * @param {string} [desc.format]\n     * @param {number} [desc.usage]\n     * @returns {GPUTexture}\n     */\n    createTexture(name, desc) {\n        const texture = this.device.createTexture({\n            size: { width: desc.width, height: desc.height },\n            format: desc.format || 'rgba8unorm',\n            usage: desc.usage || (\n                GPUTextureUsage.TEXTURE_BINDING |\n                GPUTextureUsage.COPY_DST |\n                GPUTextureUsage.RENDER_ATTACHMENT\n            )\n        });\n\n        this._resources.register('texture', texture);\n        this._textures.set(name, texture);\n        return texture;\n    }\n\n    /**\n     * Create a sampler\n     * @param {string} name\n     * @param {object} [desc]\n     * @returns {GPUSampler}\n     */\n    createSampler(name, desc = {}) {\n        const sampler = this.device.createSampler({\n            magFilter: desc.magFilter || 'linear',\n            minFilter: desc.minFilter || 'linear',\n            mipmapFilter: desc.mipmapFilter || 'linear',\n            addressModeU: desc.addressModeU || 'clamp-to-edge',\n            addressModeV: desc.addressModeV || 'clamp-to-edge'\n        });\n\n        this._samplers.set(name, sampler);\n        return sampler;\n    }\n\n    /**\n     * Get a texture by name\n     * @param {string} name\n     * @returns {GPUTexture|undefined}\n     */\n    getTexture(name) {\n        return this._textures.get(name);\n    }\n\n    /**\n     * Get a sampler by name\n     * @param {string} name\n     * @returns {GPUSampler|undefined}\n     */\n    getSampler(name) {\n        return this._samplers.get(name);\n    }\n\n    // ========================================================================\n    // Canvas / Resize\n    // ========================================================================\n\n    /**\n     * Resize the canvas and recreate depth resources if enabled.\n     * @param {number} width\n     * @param {number} height\n     */\n    resize(width, height) {\n        const clampedWidth = Math.max(1, Math.floor(width));\n        const clampedHeight = Math.max(1, Math.floor(height));\n\n        this.canvas.width = clampedWidth;\n        this.canvas.height = clampedHeight;\n\n        this.context.configure({\n            device: this.device,\n            format: this.format,\n            alphaMode: 'premultiplied'\n        });\n\n        if (this.depthEnabled) {\n            this._destroyDepthTexture();\n            this._depthTexture = this.device.createTexture({\n                size: { width: clampedWidth, height: clampedHeight, depthOrArrayLayers: 1 },\n                format: 'depth24plus',\n                usage: GPUTextureUsage.RENDER_ATTACHMENT\n            });\n            this._resources.register('texture', this._depthTexture);\n        }\n    }\n\n    // ========================================================================\n    // Buffer Creation\n    // ========================================================================\n\n    /**\n     * Create a vertex buffer from geometry data\n     * @param {Float32Array} data - Interleaved vertex data\n     * @returns {GPUBuffer}\n     */\n    createVertexBuffer(data) {\n        const buffer = this.device.createBuffer({\n            size: data.byteLength,\n            usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST,\n            mappedAtCreation: true\n        });\n\n        new Float32Array(buffer.getMappedRange()).set(data);\n        buffer.unmap();\n\n        this._resources.register('buffer', buffer);\n        return buffer;\n    }\n\n    /**\n     * Create an index buffer\n     * @param {Uint16Array|Uint32Array} data\n     * @returns {GPUBuffer}\n     */\n    createIndexBuffer(data) {\n        const buffer = this.device.createBuffer({\n            size: data.byteLength,\n            usage: GPUBufferUsage.INDEX | GPUBufferUsage.COPY_DST,\n            mappedAtCreation: true\n        });\n\n        if (data instanceof Uint16Array) {\n            new Uint16Array(buffer.getMappedRange()).set(data);\n        } else {\n            new Uint32Array(buffer.getMappedRange()).set(data);\n        }\n        buffer.unmap();\n\n        this._resources.register('buffer', buffer);\n        return buffer;\n    }\n\n    // ========================================================================\n    // Rendering - Fullscreen Quad (VIB3+ Procedural)\n    // ========================================================================\n\n    /**\n     * Render a fullscreen quad using a named pipeline.\n     * This is the primary rendering method for VIB3+ procedural visualization.\n     *\n     * @param {object} options\n     * @param {string} options.pipeline - Pipeline name (created via createFullscreenPipeline)\n     * @param {GPUBindGroup[]} [options.bindGroups] - Bind groups to set\n     * @param {number[]} [options.clearColor] - RGBA clear color (0-1)\n     * @param {boolean} [options.clear] - Whether to clear (default true)\n     */\n    renderFullscreenQuad(options) {\n        const {\n            pipeline: pipelineName,\n            bindGroups = [],\n            clearColor = [0, 0, 0, 1],\n            clear = true\n        } = options;\n\n        const pipeline = this._pipelines.get(pipelineName);\n        if (!pipeline) {\n            if (this.debug) {\n                console.warn(`Pipeline \"${pipelineName}\" not found`);\n            }\n            return;\n        }\n\n        const encoder = this.device.createCommandEncoder();\n        this._stats.commandEncoders += 1;\n\n        const colorView = this.context.getCurrentTexture().createView();\n\n        const pass = encoder.beginRenderPass({\n            colorAttachments: [{\n                view: colorView,\n                clearValue: {\n                    r: clearColor[0],\n                    g: clearColor[1],\n                    b: clearColor[2],\n                    a: clearColor[3]\n                },\n                loadOp: clear ? 'clear' : 'load',\n                storeOp: 'store'\n            }]\n        });\n\n        pass.setPipeline(pipeline);\n        this._stats.pipelineChanges += 1;\n\n        // Set bind groups\n        for (let i = 0; i < bindGroups.length; i++) {\n            pass.setBindGroup(i, bindGroups[i]);\n        }\n\n        // Draw fullscreen triangle (3 vertices, no vertex buffer)\n        pass.draw(3);\n        this._stats.drawCalls += 1;\n\n        pass.end();\n        this.device.queue.submit([encoder.finish()]);\n        this._stats.frames += 1;\n    }\n\n    // ========================================================================\n    // Rendering - Geometry\n    // ========================================================================\n\n    /**\n     * Render a single frame (clear-only pass by default).\n     * @param {object} [options]\n     * @param {number[]} [options.clearColor] - RGBA in 0-1\n     */\n    renderFrame(options = {}) {\n        const clearColor = options.clearColor || [0, 0, 0, 1];\n        const encoder = this.device.createCommandEncoder();\n        this._stats.commandEncoders += 1;\n\n        const colorView = this.context.getCurrentTexture().createView();\n        const depthAttachment = this.depthEnabled && this._depthTexture\n            ? {\n                view: this._depthTexture.createView(),\n                depthClearValue: 1.0,\n                depthLoadOp: 'clear',\n                depthStoreOp: 'store'\n            }\n            : undefined;\n\n        const pass = encoder.beginRenderPass({\n            colorAttachments: [{\n                view: colorView,\n                clearValue: { r: clearColor[0], g: clearColor[1], b: clearColor[2], a: clearColor[3] },\n                loadOp: 'clear',\n                storeOp: 'store'\n            }],\n            depthStencilAttachment: depthAttachment\n        });\n        pass.end();\n\n        this.device.queue.submit([encoder.finish()]);\n        this._stats.frames += 1;\n    }\n\n    /**\n     * Render geometry with the default pipeline\n     * @param {object} options\n     * @param {GPUBuffer} options.vertexBuffer\n     * @param {GPUBuffer} [options.indexBuffer]\n     * @param {number} options.vertexCount\n     * @param {number} [options.indexCount]\n     * @param {object} [options.uniforms]\n     * @param {number[]} [options.clearColor]\n     */\n    renderGeometry(options) {\n        const {\n            vertexBuffer,\n            indexBuffer,\n            vertexCount,\n            indexCount,\n            uniforms = {},\n            clearColor = [0, 0, 0, 1]\n        } = options;\n\n        this.updateUniforms(uniforms);\n\n        const encoder = this.device.createCommandEncoder();\n        this._stats.commandEncoders += 1;\n\n        const colorView = this.context.getCurrentTexture().createView();\n        const depthAttachment = this.depthEnabled && this._depthTexture\n            ? {\n                view: this._depthTexture.createView(),\n                depthClearValue: 1.0,\n                depthLoadOp: 'clear',\n                depthStoreOp: 'store'\n            }\n            : undefined;\n\n        const pass = encoder.beginRenderPass({\n            colorAttachments: [{\n                view: colorView,\n                clearValue: { r: clearColor[0], g: clearColor[1], b: clearColor[2], a: clearColor[3] },\n                loadOp: 'clear',\n                storeOp: 'store'\n            }],\n            depthStencilAttachment: depthAttachment\n        });\n\n        const pipeline = this._pipelines.get('default');\n        pass.setPipeline(pipeline);\n        this._stats.pipelineChanges += 1;\n\n        pass.setBindGroup(0, this._uniformBindGroup);\n        pass.setVertexBuffer(0, vertexBuffer);\n\n        if (indexBuffer && indexCount) {\n            pass.setIndexBuffer(indexBuffer, 'uint16');\n            pass.drawIndexed(indexCount);\n            this._stats.triangles += indexCount / 3;\n        } else {\n            pass.draw(vertexCount);\n            this._stats.triangles += vertexCount / 3;\n        }\n\n        this._stats.drawCalls += 1;\n\n        pass.end();\n        this.device.queue.submit([encoder.finish()]);\n        this._stats.frames += 1;\n    }\n\n    /**\n     * Render using a named pipeline with arbitrary vertex/index buffers\n     * @param {object} options\n     * @param {string} options.pipeline - Pipeline name\n     * @param {GPUBuffer} options.vertexBuffer\n     * @param {GPUBuffer} [options.indexBuffer]\n     * @param {number} options.vertexCount\n     * @param {number} [options.indexCount]\n     * @param {GPUBindGroup[]} [options.bindGroups]\n     * @param {number[]} [options.clearColor]\n     * @param {boolean} [options.clear]\n     */\n    renderWithPipeline(options) {\n        const {\n            pipeline: pipelineName,\n            vertexBuffer,\n            indexBuffer,\n            vertexCount,\n            indexCount,\n            bindGroups = [],\n            clearColor = [0, 0, 0, 1],\n            clear = true\n        } = options;\n\n        const pipeline = this._pipelines.get(pipelineName);\n        if (!pipeline) {\n            if (this.debug) {\n                console.warn(`Pipeline \"${pipelineName}\" not found`);\n            }\n            return;\n        }\n\n        const encoder = this.device.createCommandEncoder();\n        this._stats.commandEncoders += 1;\n\n        const colorView = this.context.getCurrentTexture().createView();\n        const depthAttachment = this.depthEnabled && this._depthTexture\n            ? {\n                view: this._depthTexture.createView(),\n                depthClearValue: 1.0,\n                depthLoadOp: clear ? 'clear' : 'load',\n                depthStoreOp: 'store'\n            }\n            : undefined;\n\n        const pass = encoder.beginRenderPass({\n            colorAttachments: [{\n                view: colorView,\n                clearValue: { r: clearColor[0], g: clearColor[1], b: clearColor[2], a: clearColor[3] },\n                loadOp: clear ? 'clear' : 'load',\n                storeOp: 'store'\n            }],\n            depthStencilAttachment: depthAttachment\n        });\n\n        pass.setPipeline(pipeline);\n        this._stats.pipelineChanges += 1;\n\n        for (let i = 0; i < bindGroups.length; i++) {\n            pass.setBindGroup(i, bindGroups[i]);\n        }\n\n        pass.setVertexBuffer(0, vertexBuffer);\n\n        if (indexBuffer && indexCount) {\n            pass.setIndexBuffer(indexBuffer, 'uint16');\n            pass.drawIndexed(indexCount);\n            this._stats.triangles += indexCount / 3;\n        } else {\n            pass.draw(vertexCount);\n            this._stats.triangles += vertexCount / 3;\n        }\n\n        this._stats.drawCalls += 1;\n\n        pass.end();\n        this.device.queue.submit([encoder.finish()]);\n        this._stats.frames += 1;\n    }\n\n    // ========================================================================\n    // Manual Render Pass Control\n    // ========================================================================\n\n    /**\n     * Begin a new render pass (for manual control)\n     * @param {object} [options]\n     * @returns {{encoder: GPUCommandEncoder, pass: GPURenderPassEncoder}}\n     */\n    beginRenderPass(options = {}) {\n        const clearColor = options.clearColor || [0, 0, 0, 1];\n        const encoder = this.device.createCommandEncoder();\n\n        const colorView = this.context.getCurrentTexture().createView();\n        const depthAttachment = this.depthEnabled && this._depthTexture\n            ? {\n                view: this._depthTexture.createView(),\n                depthClearValue: 1.0,\n                depthLoadOp: options.loadDepth ? 'load' : 'clear',\n                depthStoreOp: 'store'\n            }\n            : undefined;\n\n        const pass = encoder.beginRenderPass({\n            colorAttachments: [{\n                view: colorView,\n                clearValue: { r: clearColor[0], g: clearColor[1], b: clearColor[2], a: clearColor[3] },\n                loadOp: options.loadColor ? 'load' : 'clear',\n                storeOp: 'store'\n            }],\n            depthStencilAttachment: depthAttachment\n        });\n\n        return { encoder, pass };\n    }\n\n    /**\n     * End a render pass and submit\n     * @param {GPUCommandEncoder} encoder\n     * @param {GPURenderPassEncoder} pass\n     */\n    endRenderPass(encoder, pass) {\n        pass.end();\n        this.device.queue.submit([encoder.finish()]);\n        this._stats.frames += 1;\n    }\n\n    // ========================================================================\n    // Statistics & Cleanup\n    // ========================================================================\n\n    /**\n     * Return backend statistics.\n     */\n    getStats() {\n        return {\n            ...this._stats,\n            resources: this._resources.getStats()\n        };\n    }\n\n    /**\n     * Reset per-frame statistics\n     */\n    resetFrameStats() {\n        this._stats.drawCalls = 0;\n        this._stats.triangles = 0;\n        this._stats.pipelineChanges = 0;\n    }\n\n    /**\n     * Dispose of GPU resources.\n     */\n    dispose() {\n        this._destroyDepthTexture();\n\n        // Destroy uniform buffers\n        if (this._uniformBuffer) {\n            this._uniformBuffer.destroy();\n            this._uniformBuffer = null;\n        }\n\n        // Destroy custom uniform buffers\n        for (const [, entry] of this._customUniformBuffers) {\n            entry.buffer.destroy();\n        }\n        this._customUniformBuffers.clear();\n\n        // Destroy textures\n        for (const [, texture] of this._textures) {\n            texture.destroy();\n        }\n        this._textures.clear();\n        this._samplers.clear();\n\n        // Clear pipelines and shaders\n        this._pipelines.clear();\n        this._shaderModules.clear();\n\n        this._resources.disposeAll();\n    }\n\n    _destroyDepthTexture() {\n        if (this._depthTexture) {\n            this._resources.release('texture', this._depthTexture);\n            this._depthTexture.destroy();\n            this._depthTexture = null;\n        }\n    }\n}\n\n/**\n * Check if WebGPU is available\n * @returns {boolean}\n */\nexport function isWebGPUSupported() {\n    return typeof navigator !== 'undefined' && !!navigator.gpu;\n}\n\n/**\n * Get available WebGPU features\n * @returns {Promise<Set<string>|null>}\n */\nexport async function getWebGPUFeatures() {\n    if (!isWebGPUSupported()) return null;\n\n    try {\n        const adapter = await navigator.gpu.requestAdapter();\n        if (!adapter) return null;\n\n        return new Set(adapter.features);\n    } catch {\n        return null;\n    }\n}\n\n/**\n * Create a WebGPU backend (async).\n * @param {HTMLCanvasElement} canvas\n * @param {object} [options]\n * @param {string} [options.powerPreference] - 'high-performance' or 'low-power'\n * @param {string[]} [options.requiredFeatures] - Features to request\n * @param {boolean} [options.debug] - Enable debug mode\n * @param {boolean} [options.depth] - Enable depth buffer\n * @returns {Promise<WebGPUBackend|null>}\n */\nexport async function createWebGPUBackend(canvas, options = {}) {\n    if (!canvas || !isWebGPUSupported()) {\n        if (options.debug) {\n            console.warn('WebGPU not supported');\n        }\n        return null;\n    }\n\n    const context = canvas.getContext('webgpu');\n    if (!context) {\n        if (options.debug) {\n            console.warn('Could not get WebGPU context');\n        }\n        return null;\n    }\n\n    try {\n        const adapter = await navigator.gpu.requestAdapter({\n            powerPreference: options.powerPreference || 'high-performance'\n        });\n\n        if (!adapter) {\n            if (options.debug) {\n                console.warn('Could not get WebGPU adapter');\n            }\n            return null;\n        }\n\n        // Determine which features to request\n        const availableFeatures = new Set(adapter.features);\n        const requestedFeatures = [];\n\n        const requiredFeatures = options.requiredFeatures || [];\n        for (const feature of requiredFeatures) {\n            if (availableFeatures.has(feature)) {\n                requestedFeatures.push(feature);\n            } else if (options.debug) {\n                console.warn(`WebGPU feature not available: ${feature}`);\n            }\n        }\n\n        const optionalFeatures = [\n            WebGPUFeatures.TIMESTAMP_QUERY,\n            WebGPUFeatures.INDIRECT_FIRST_INSTANCE\n        ];\n\n        for (const feature of optionalFeatures) {\n            if (availableFeatures.has(feature) && !requestedFeatures.includes(feature)) {\n                requestedFeatures.push(feature);\n            }\n        }\n\n        const device = await adapter.requestDevice({\n            requiredFeatures: requestedFeatures.length > 0 ? requestedFeatures : undefined\n        });\n\n        device.lost.then((info) => {\n            console.error('WebGPU device lost:', info.reason, info.message);\n        });\n\n        if (options.debug) {\n            device.onuncapturederror = (event) => {\n                console.error('WebGPU error:', event.error.message);\n            };\n        }\n\n        const format = navigator.gpu.getPreferredCanvasFormat();\n\n        if (options.debug) {\n            console.log('WebGPU initialized:', {\n                vendor: adapter.info?.vendor,\n                architecture: adapter.info?.architecture,\n                format,\n                features: requestedFeatures\n            });\n        }\n\n        return new WebGPUBackend(\n            { canvas, device, context, format, adapter },\n            { ...options, features: requestedFeatures }\n        );\n    } catch (error) {\n        if (options.debug) {\n            console.error('WebGPU initialization failed:', error);\n        }\n        return null;\n    }\n}\n\n/**\n * Create WebGPU backend with fallback to WebGL\n * @param {HTMLCanvasElement} canvas\n * @param {object} [options]\n * @returns {Promise<{backend: WebGPUBackend|null, type: 'webgpu'|'webgl'|null}>}\n */\nexport async function createWebGPUWithFallback(canvas, options = {}) {\n    const webgpuBackend = await createWebGPUBackend(canvas, options);\n    if (webgpuBackend) {\n        return { backend: webgpuBackend, type: 'webgpu' };\n    }\n\n    return { backend: null, type: null };\n}\n\nexport default WebGPUBackend;\n","/**\n * UnifiedRenderBridge - Connects VIB3+ visualization systems to WebGL/WebGPU backends.\n *\n * All three VIB3+ visualization systems (Quantum, Faceted, Holographic) use the same\n * rendering pattern: procedural fragment shaders on a fullscreen quad. This bridge\n * abstracts that pattern so systems can render identically on either backend.\n *\n * Usage:\n *   const bridge = await UnifiedRenderBridge.create(canvas, { preferWebGPU: true });\n *   bridge.compileShader('faceted', vertexSrc, fragmentSrc);\n *   bridge.setUniforms({ u_time: 1.5, u_resolution: [800, 600], ... });\n *   bridge.render('faceted');\n *   bridge.dispose();\n */\n\nimport { createWebGPUBackend, isWebGPUSupported, WGSLShaderLib } from './backends/WebGPUBackend.js';\n\n/** @typedef {'webgl'|'webgpu'} BackendType */\n\n/**\n * Packs VIB3+ parameters into a Float32Array for WebGPU uniform buffer.\n * Layout must match VIB3Uniforms struct in WGSL.\n *\n * @param {object} uniforms - Uniform name‚Üívalue map\n * @returns {Float32Array}\n */\nfunction packVIB3Uniforms(uniforms) {\n    // Total: 33 floats (indices 0-32) = 132 bytes ‚Üí padded to 256 bytes in buffer\n    const data = new Float32Array(64); // 256 bytes\n\n    data[0] = uniforms.u_time || 0;\n    data[1] = 0; // _pad0\n    data[2] = uniforms.u_resolution?.[0] || 800;\n    data[3] = uniforms.u_resolution?.[1] || 600;\n\n    data[4] = uniforms.u_geometry || 0;\n    data[5] = uniforms.u_rot4dXY || 0;\n    data[6] = uniforms.u_rot4dXZ || 0;\n    data[7] = uniforms.u_rot4dYZ || 0;\n    data[8] = uniforms.u_rot4dXW || 0;\n    data[9] = uniforms.u_rot4dYW || 0;\n    data[10] = uniforms.u_rot4dZW || 0;\n\n    data[11] = uniforms.u_dimension || 3.5;\n    data[12] = uniforms.u_gridDensity || 1.5;\n    data[13] = uniforms.u_morphFactor || 1.0;\n    data[14] = uniforms.u_chaos || 0.2;\n    data[15] = uniforms.u_speed || 1.0;\n    data[16] = uniforms.u_hue || 200;\n    data[17] = uniforms.u_intensity || 0.7;\n    data[18] = uniforms.u_saturation || 0.8;\n\n    data[19] = uniforms.u_mouseIntensity || 0;\n    data[20] = uniforms.u_clickIntensity || 0;\n    data[21] = uniforms.u_bass || 0;\n    data[22] = uniforms.u_mid || 0;\n    data[23] = uniforms.u_high || 0;\n\n    // Breath/Vitality parameter\n    data[32] = uniforms.u_breath || 0;\n\n    data[24] = uniforms.u_layerScale || 1.0;\n    data[25] = uniforms.u_layerOpacity || 1.0;\n    data[26] = 0; // _pad1\n    data[27] = uniforms.u_layerColor?.[0] || 1.0;\n    data[28] = uniforms.u_layerColor?.[1] || 1.0;\n    data[29] = uniforms.u_layerColor?.[2] || 1.0;\n    data[30] = uniforms.u_densityMult || 1.0;\n    data[31] = uniforms.u_speedMult || 1.0;\n    // [32..63] padding to 256\n\n    return data;\n}\n\nexport class UnifiedRenderBridge {\n    /**\n     * @param {HTMLCanvasElement} canvas\n     * @param {BackendType} backendType\n     * @param {object} backend - WebGLBackend-like or WebGPUBackend instance\n     */\n    constructor(canvas, backendType, backend) {\n        /** @type {HTMLCanvasElement} */\n        this.canvas = canvas;\n\n        /** @type {BackendType} */\n        this.backendType = backendType;\n\n        /** @type {object} */\n        this.backend = backend;\n\n        // ---- WebGL state ----\n        /** @type {Map<string, {program: WebGLProgram, uniformLocations: Map<string, WebGLUniformLocation>}>} */\n        this._glPrograms = new Map();\n\n        /** @type {WebGLBuffer|null} */\n        this._glQuadBuffer = null;\n\n        // ---- WebGPU state ----\n        /** @type {Map<string, string>} pipeline name ‚Üí buffer name */\n        this._gpuPipelineBuffers = new Map();\n\n        // ---- Shared state ----\n        /** @type {Map<string, object>} */\n        this._currentUniforms = new Map();\n\n        this._initialized = false;\n    }\n\n    /**\n     * Create a UnifiedRenderBridge with automatic backend selection.\n     *\n     * @param {HTMLCanvasElement} canvas - Target canvas element\n     * @param {object} [options]\n     * @param {boolean} [options.preferWebGPU=true] - Try WebGPU first\n     * @param {boolean} [options.debug=false] - Enable debug logging\n     * @returns {Promise<UnifiedRenderBridge>}\n     */\n    static async create(canvas, options = {}) {\n        const preferWebGPU = options.preferWebGPU !== false;\n        const debug = options.debug || false;\n\n        // Try WebGPU first if preferred\n        if (preferWebGPU && isWebGPUSupported()) {\n            try {\n                const gpuBackend = await createWebGPUBackend(canvas, {\n                    debug,\n                    depth: false // Procedural shaders don't need depth\n                });\n\n                if (gpuBackend) {\n                    const bridge = new UnifiedRenderBridge(canvas, 'webgpu', gpuBackend);\n                    bridge._initialized = true;\n                    if (debug) console.log('UnifiedRenderBridge: using WebGPU backend');\n                    return bridge;\n                }\n            } catch (e) {\n                if (debug) console.warn('WebGPU init failed, falling back to WebGL:', e);\n            }\n        }\n\n        // Fall back to WebGL\n        const gl = canvas.getContext('webgl2') || canvas.getContext('webgl');\n        if (!gl) {\n            throw new Error('Neither WebGPU nor WebGL is available');\n        }\n\n        const bridge = new UnifiedRenderBridge(canvas, 'webgl', gl);\n        bridge._initWebGLQuadBuffer();\n        bridge._initialized = true;\n        if (debug) console.log('UnifiedRenderBridge: using WebGL backend');\n        return bridge;\n    }\n\n    /**\n     * Get the active backend type\n     * @returns {BackendType}\n     */\n    getBackendType() {\n        return this.backendType;\n    }\n\n    /**\n     * Check if the bridge is initialized\n     * @returns {boolean}\n     */\n    get initialized() {\n        return this._initialized;\n    }\n\n    // ========================================================================\n    // Shader Compilation\n    // ========================================================================\n\n    /**\n     * Compile a shader program for a named visualization.\n     *\n     * For WebGL: compiles GLSL vertex + fragment shaders.\n     * For WebGPU: compiles WGSL fragment shader with fullscreen pipeline.\n     *\n     * @param {string} name - Shader name (e.g., 'faceted', 'quantum')\n     * @param {object} sources\n     * @param {string} sources.glslVertex - GLSL vertex shader source\n     * @param {string} sources.glslFragment - GLSL fragment shader source\n     * @param {string} [sources.wgslFragment] - WGSL fragment shader source (optional, for WebGPU)\n     * @returns {boolean} Success\n     */\n    compileShader(name, sources) {\n        if (this.backendType === 'webgl') {\n            return this._compileWebGLShader(name, sources.glslVertex, sources.glslFragment);\n        } else {\n            if (!sources.wgslFragment) {\n                // If no WGSL provided, we can't render on WebGPU with this shader.\n                // Systems that want WebGPU support must provide WGSL sources.\n                console.warn(`No WGSL fragment shader for \"${name}\", WebGPU rendering unavailable`);\n                return false;\n            }\n            return this._compileWebGPUShader(name, sources.wgslFragment);\n        }\n    }\n\n    /**\n     * @private\n     */\n    _compileWebGLShader(name, vertexSrc, fragmentSrc) {\n        const gl = this.backend;\n\n        const vertexShader = this._compileGLShader(gl, gl.VERTEX_SHADER, vertexSrc);\n        const fragmentShader = this._compileGLShader(gl, gl.FRAGMENT_SHADER, fragmentSrc);\n\n        if (!vertexShader || !fragmentShader) return false;\n\n        const program = gl.createProgram();\n        gl.attachShader(program, vertexShader);\n        gl.attachShader(program, fragmentShader);\n        gl.linkProgram(program);\n\n        if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n            console.error(`Shader link error [${name}]:`, gl.getProgramInfoLog(program));\n            return false;\n        }\n\n        // Cache uniform locations\n        const uniformLocations = new Map();\n        const numUniforms = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);\n        for (let i = 0; i < numUniforms; i++) {\n            const info = gl.getActiveUniform(program, i);\n            if (info) {\n                uniformLocations.set(info.name, gl.getUniformLocation(program, info.name));\n            }\n        }\n\n        // Clean up old program if replacing\n        const old = this._glPrograms.get(name);\n        if (old) {\n            gl.deleteProgram(old.program);\n        }\n\n        this._glPrograms.set(name, { program, uniformLocations });\n\n        // Clean up shader objects (they're linked into the program now)\n        gl.deleteShader(vertexShader);\n        gl.deleteShader(fragmentShader);\n\n        return true;\n    }\n\n    /**\n     * @private\n     */\n    _compileGLShader(gl, type, source) {\n        const shader = gl.createShader(type);\n        gl.shaderSource(shader, source);\n        gl.compileShader(shader);\n\n        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n            console.error('Shader compile error:', gl.getShaderInfoLog(shader));\n            gl.deleteShader(shader);\n            return null;\n        }\n\n        return shader;\n    }\n\n    /**\n     * @private\n     */\n    _compileWebGPUShader(name, wgslFragmentSrc) {\n        const gpu = this.backend;\n\n        // Create custom uniform buffer for VIB3+ uniforms\n        const bufferName = `${name}-uniforms`;\n        const existing = gpu.getCustomUniformBuffer(bufferName);\n        if (!existing) {\n            gpu.createCustomUniformBuffer(bufferName, 256);\n        }\n\n        const uniformEntry = gpu.getCustomUniformBuffer(bufferName);\n\n        // Create fullscreen pipeline with the custom bind group layout\n        try {\n            gpu.createFullscreenPipeline(name, wgslFragmentSrc, {\n                bindGroupLayouts: [uniformEntry.layout]\n            });\n\n            this._gpuPipelineBuffers.set(name, bufferName);\n            return true;\n        } catch (e) {\n            console.error(`WebGPU pipeline creation failed [${name}]:`, e);\n            return false;\n        }\n    }\n\n    // ========================================================================\n    // Uniform Updates\n    // ========================================================================\n\n    /**\n     * Set uniforms for the next render call.\n     * Accepts a flat object with uniform names as keys.\n     *\n     * @param {object} uniforms - e.g., { u_time: 1.5, u_resolution: [800, 600] }\n     */\n    setUniforms(uniforms) {\n        // Store for render-time application\n        this._pendingUniforms = uniforms;\n    }\n\n    // ========================================================================\n    // Rendering\n    // ========================================================================\n\n    /**\n     * Render a fullscreen quad using the named shader program.\n     *\n     * @param {string} name - Shader name to use\n     * @param {object} [options]\n     * @param {number[]} [options.clearColor] - RGBA 0-1\n     * @param {boolean} [options.clear] - Whether to clear before drawing\n     */\n    render(name, options = {}) {\n        if (this.backendType === 'webgl') {\n            this._renderWebGL(name, options);\n        } else {\n            this._renderWebGPU(name, options);\n        }\n    }\n\n    /**\n     * @private\n     */\n    _renderWebGL(name, options) {\n        const gl = this.backend;\n        const entry = this._glPrograms.get(name);\n        if (!entry) return;\n\n        const { program, uniformLocations } = entry;\n\n        gl.useProgram(program);\n        gl.enable(gl.BLEND);\n        gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n\n        if (options.clear !== false) {\n            const cc = options.clearColor || [0, 0, 0, 1];\n            gl.clearColor(cc[0], cc[1], cc[2], cc[3]);\n            gl.clear(gl.COLOR_BUFFER_BIT);\n        }\n\n        // Apply uniforms\n        const uniforms = this._pendingUniforms || {};\n        for (const [uName, value] of Object.entries(uniforms)) {\n            const loc = uniformLocations.get(uName);\n            if (loc === null || loc === undefined) continue;\n\n            if (Array.isArray(value)) {\n                switch (value.length) {\n                    case 2: gl.uniform2fv(loc, value); break;\n                    case 3: gl.uniform3fv(loc, value); break;\n                    case 4: gl.uniform4fv(loc, value); break;\n                    default: gl.uniform1fv(loc, value); break;\n                }\n            } else if (typeof value === 'number') {\n                gl.uniform1f(loc, value);\n            } else if (typeof value === 'boolean') {\n                gl.uniform1i(loc, value ? 1 : 0);\n            }\n        }\n\n        // Draw fullscreen quad\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._glQuadBuffer);\n        const posLoc = gl.getAttribLocation(program, 'a_position');\n        if (posLoc >= 0) {\n            gl.enableVertexAttribArray(posLoc);\n            gl.vertexAttribPointer(posLoc, 2, gl.FLOAT, false, 0, 0);\n        }\n        gl.drawArrays(gl.TRIANGLES, 0, 6);\n    }\n\n    /**\n     * @private\n     */\n    _renderWebGPU(name, options) {\n        const gpu = this.backend;\n        const bufferName = this._gpuPipelineBuffers.get(name);\n        if (!bufferName) return;\n\n        const uniformEntry = gpu.getCustomUniformBuffer(bufferName);\n        if (!uniformEntry) return;\n\n        // Pack and upload uniforms\n        const packed = packVIB3Uniforms(this._pendingUniforms || {});\n        gpu.updateCustomUniforms(bufferName, packed);\n\n        // Render fullscreen quad\n        gpu.renderFullscreenQuad({\n            pipeline: name,\n            bindGroups: [uniformEntry.bindGroup],\n            clearColor: options.clearColor || [0, 0, 0, 1],\n            clear: options.clear !== false\n        });\n    }\n\n    // ========================================================================\n    // Canvas Management\n    // ========================================================================\n\n    /**\n     * Resize the rendering surface\n     * @param {number} width\n     * @param {number} height\n     * @param {number} [pixelRatio=1]\n     */\n    resize(width, height, pixelRatio = 1) {\n        const w = Math.floor(width * pixelRatio);\n        const h = Math.floor(height * pixelRatio);\n\n        this.canvas.width = w;\n        this.canvas.height = h;\n\n        if (this.backendType === 'webgl') {\n            this.backend.viewport(0, 0, w, h);\n        } else {\n            this.backend.resize(w, h);\n        }\n    }\n\n    /**\n     * Get the raw WebGL context or WebGPU backend for advanced usage\n     * @returns {WebGLRenderingContext|WebGL2RenderingContext|import('./backends/WebGPUBackend.js').WebGPUBackend}\n     */\n    getRawBackend() {\n        return this.backend;\n    }\n\n    // ========================================================================\n    // Cleanup\n    // ========================================================================\n\n    /**\n     * Dispose of all resources\n     */\n    dispose() {\n        if (this.backendType === 'webgl') {\n            const gl = this.backend;\n            for (const [, entry] of this._glPrograms) {\n                gl.deleteProgram(entry.program);\n            }\n            this._glPrograms.clear();\n\n            if (this._glQuadBuffer) {\n                gl.deleteBuffer(this._glQuadBuffer);\n                this._glQuadBuffer = null;\n            }\n\n            // Lose context to free GPU memory\n            const loseContext = gl.getExtension('WEBGL_lose_context');\n            if (loseContext) {\n                loseContext.loseContext();\n            }\n        } else {\n            this.backend.dispose();\n        }\n\n        this._gpuPipelineBuffers.clear();\n        this._currentUniforms.clear();\n        this._pendingUniforms = null;\n        this._initialized = false;\n    }\n\n    // ========================================================================\n    // Internal Helpers\n    // ========================================================================\n\n    /**\n     * Create the fullscreen quad vertex buffer for WebGL\n     * @private\n     */\n    _initWebGLQuadBuffer() {\n        const gl = this.backend;\n        const vertices = new Float32Array([\n            -1, -1,   1, -1,  -1, 1,\n            -1,  1,   1, -1,   1, 1\n        ]);\n        this._glQuadBuffer = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._glQuadBuffer);\n        gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\n    }\n}\n\n/**\n * Check if WebGPU is available in the current environment\n * @returns {boolean}\n */\nexport function canUseWebGPU() {\n    return isWebGPUSupported();\n}\n\nexport { WGSLShaderLib };\n\nexport default UnifiedRenderBridge;\n","/**\n * LayerRelationshipGraph ‚Äî Keystone-driven inter-layer parameter system for VIB3+\n *\n * Instead of blasting identical parameters to all 5 layers with static multipliers,\n * this system designates one layer as the **keystone** (the driver) and derives\n * every other layer's parameters through configurable **relationship functions**.\n *\n * Each relationship function receives the keystone's resolved parameters and returns\n * the dependent layer's parameters. This allows layers to mirror, complement, chase,\n * harmonize with, or react to the keystone ‚Äî producing actual inter-layer dynamics\n * instead of \"same shader, different opacity.\"\n *\n * Supports per-layer shader assignment so layers aren't forced to run the same program.\n *\n * Usage:\n *   const graph = new LayerRelationshipGraph({ keystone: 'content' });\n *   graph.setRelationship('background', 'echo');      // attenuated follower\n *   graph.setRelationship('shadow', 'complement');     // color complement, density inverse\n *   graph.setRelationship('highlight', 'harmonic');    // 2x density, shifted hue\n *   graph.setRelationship('accent', 'reactive');       // amplifies delta from keystone\n *\n *   // Custom relationship\n *   graph.setRelationship('accent', (keystoneParams, time) => ({\n *       ...keystoneParams,\n *       hue: (keystoneParams.hue + 180) % 360,\n *       density: keystoneParams.density * 2.5,\n *       speed: keystoneParams.speed * 0.4,\n *   }));\n *\n *   // Per-layer shader\n *   graph.setLayerShader('accent', 'holographic-glitch');\n *\n *   // Resolve all layers for a frame\n *   const resolved = graph.resolveAll(keystoneParams, time);\n *   // => { background: {...}, shadow: {...}, content: keystoneParams, highlight: {...}, accent: {...} }\n */\n\n/** @type {string[]} Standard layer order (back to front) */\nconst LAYER_ORDER = ['background', 'shadow', 'content', 'highlight', 'accent'];\n\n// ============================================================================\n// Preset Relationship Functions\n// ============================================================================\n\n/**\n * @typedef {function(Object, number): Object} RelationshipFn\n * Takes (keystoneParams, time) and returns derived layer params.\n */\n\n/**\n * Echo ‚Äî attenuated follower.\n * Same parameters as keystone but scaled down. The most basic relationship.\n * Background/shadow layers typically use this.\n *\n * @param {Object} config - Attenuation config\n * @param {number} [config.opacity=0.3] - Opacity multiplier\n * @param {number} [config.densityScale=0.5] - Density multiplier\n * @param {number} [config.speedScale=0.3] - Speed multiplier\n * @param {number} [config.intensityScale=0.4] - Intensity multiplier\n * @returns {RelationshipFn}\n */\nfunction echo(config = {}) {\n    const {\n        opacity = 0.3,\n        densityScale = 0.5,\n        speedScale = 0.3,\n        intensityScale = 0.4\n    } = config;\n\n    return (kp, _time) => ({\n        ...kp,\n        layerOpacity: (kp.layerOpacity || 1.0) * opacity,\n        density: (kp.density || 1.0) * densityScale,\n        speed: (kp.speed || 1.0) * speedScale,\n        intensity: (kp.intensity || 0.5) * intensityScale\n    });\n}\n\n/**\n * Mirror ‚Äî inverts spatial parameters relative to keystone.\n * Rotation planes get negated, hue shifts 180¬∞. Creates visual counterpoint.\n *\n * @param {Object} config\n * @param {number} [config.opacity=0.5]\n * @param {boolean} [config.invertRotation=true] - Negate 4D rotation angles\n * @param {number} [config.hueShift=180] - Degrees to shift hue\n * @returns {RelationshipFn}\n */\nfunction mirror(config = {}) {\n    const {\n        opacity = 0.5,\n        invertRotation = true,\n        hueShift = 180\n    } = config;\n\n    return (kp, _time) => {\n        const result = { ...kp, layerOpacity: (kp.layerOpacity || 1.0) * opacity };\n\n        if (kp.hue !== undefined) {\n            result.hue = (kp.hue + hueShift) % 360;\n        }\n\n        if (invertRotation) {\n            if (kp.rot4dXW !== undefined) result.rot4dXW = -kp.rot4dXW;\n            if (kp.rot4dYW !== undefined) result.rot4dYW = -kp.rot4dYW;\n            if (kp.rot4dZW !== undefined) result.rot4dZW = -kp.rot4dZW;\n        }\n\n        return result;\n    };\n}\n\n/**\n * Complement ‚Äî color complement with inverted density curve.\n * Hue opposite, density inverts around midpoint, chaos complementary.\n * Good for shadow/background to create depth contrast.\n *\n * @param {Object} config\n * @param {number} [config.opacity=0.4]\n * @param {number} [config.densityPivot=1.0] - Density value to invert around\n * @param {number} [config.chaosInvert=true] - Invert chaos (high ‚Üí low, low ‚Üí high)\n * @returns {RelationshipFn}\n */\nfunction complement(config = {}) {\n    const {\n        opacity = 0.4,\n        densityPivot = 1.0,\n        chaosInvert = true\n    } = config;\n\n    return (kp, _time) => {\n        const result = { ...kp, layerOpacity: (kp.layerOpacity || 1.0) * opacity };\n\n        if (kp.hue !== undefined) {\n            result.hue = (kp.hue + 180) % 360;\n        }\n\n        if (kp.density !== undefined) {\n            // Invert around pivot: if keystone density is 0.3, complement is 1.7\n            result.density = Math.max(0.1, densityPivot * 2 - kp.density);\n        }\n\n        if (chaosInvert && kp.chaos !== undefined) {\n            result.chaos = Math.max(0, 1.0 - kp.chaos);\n        }\n\n        return result;\n    };\n}\n\n/**\n * Harmonic ‚Äî musical harmonic relationships.\n * Density at integer multiples (2x, 3x), hue shifted by golden angle (~137.5¬∞).\n * Speed at fractional ratios. Creates visual \"chords.\"\n *\n * @param {Object} config\n * @param {number} [config.opacity=0.5]\n * @param {number} [config.densityHarmonic=2] - Integer multiple for density\n * @param {number} [config.speedRatio=0.5] - Fractional speed ratio\n * @param {number} [config.hueAngle=137.508] - Golden angle for hue shift\n * @returns {RelationshipFn}\n */\nfunction harmonic(config = {}) {\n    const {\n        opacity = 0.5,\n        densityHarmonic = 2,\n        speedRatio = 0.5,\n        hueAngle = 137.508\n    } = config;\n\n    return (kp, _time) => {\n        const result = { ...kp, layerOpacity: (kp.layerOpacity || 1.0) * opacity };\n\n        if (kp.density !== undefined) {\n            result.density = kp.density * densityHarmonic;\n        }\n\n        if (kp.speed !== undefined) {\n            result.speed = kp.speed * speedRatio;\n        }\n\n        if (kp.hue !== undefined) {\n            result.hue = (kp.hue + hueAngle) % 360;\n        }\n\n        return result;\n    };\n}\n\n/**\n * Reactive ‚Äî amplifies the delta from a baseline.\n * Tracks parameter changes over time and exaggerates them.\n * The more the keystone changes, the more reactive layers diverge.\n *\n * @param {Object} config\n * @param {number} [config.opacity=0.6]\n * @param {number} [config.gain=2.0] - How much to amplify deltas\n * @param {number} [config.decay=0.95] - How fast accumulated delta decays per frame\n * @returns {RelationshipFn}\n */\nfunction reactive(config = {}) {\n    const {\n        opacity = 0.6,\n        gain = 2.0,\n        decay = 0.95\n    } = config;\n\n    let prevParams = null;\n    let accumulatedDelta = {};\n\n    return (kp, _time) => {\n        const result = { ...kp, layerOpacity: (kp.layerOpacity || 1.0) * opacity };\n\n        if (prevParams) {\n            for (const key of Object.keys(kp)) {\n                if (typeof kp[key] !== 'number') continue;\n                const delta = kp[key] - (prevParams[key] || 0);\n                accumulatedDelta[key] = ((accumulatedDelta[key] || 0) + delta * gain) * decay;\n                result[key] = kp[key] + (accumulatedDelta[key] || 0);\n            }\n        }\n\n        prevParams = { ...kp };\n        return result;\n    };\n}\n\n/**\n * Chase ‚Äî follows the keystone with a time delay (lerp toward keystone each frame).\n * Creates a trailing/ghosting effect. Layers feel like they're \"catching up.\"\n *\n * @param {Object} config\n * @param {number} [config.opacity=0.5]\n * @param {number} [config.lerpRate=0.1] - How fast to chase (0 = frozen, 1 = instant)\n * @returns {RelationshipFn}\n */\nfunction chase(config = {}) {\n    const {\n        opacity = 0.5,\n        lerpRate = 0.1\n    } = config;\n\n    let currentParams = null;\n\n    return (kp, _time) => {\n        if (!currentParams) {\n            currentParams = { ...kp };\n        }\n\n        // Lerp each numeric parameter toward keystone\n        for (const key of Object.keys(kp)) {\n            if (typeof kp[key] !== 'number') continue;\n            const current = currentParams[key] !== undefined ? currentParams[key] : kp[key];\n            currentParams[key] = current + (kp[key] - current) * lerpRate;\n        }\n\n        return {\n            ...currentParams,\n            layerOpacity: (kp.layerOpacity || 1.0) * opacity\n        };\n    };\n}\n\n/**\n * Registry of preset relationship factories.\n * Each entry is a function that takes optional config and returns a RelationshipFn.\n */\nconst PRESET_REGISTRY = {\n    echo,\n    mirror,\n    complement,\n    harmonic,\n    reactive,\n    chase\n};\n\n// ============================================================================\n// Default Layer Relationship Profiles\n// ============================================================================\n\n/**\n * Named profiles that configure the full 5-layer graph at once.\n * Each profile sets the keystone and relationships for all layers.\n */\nconst PROFILES = {\n    /** Classic holographic ‚Äî content drives, others echo/complement */\n    holographic: {\n        keystone: 'content',\n        relationships: {\n            background: { preset: 'echo', config: { opacity: 0.2, densityScale: 0.4, speedScale: 0.2, intensityScale: 0.3 } },\n            shadow:     { preset: 'complement', config: { opacity: 0.4, densityPivot: 1.0 } },\n            highlight:  { preset: 'harmonic', config: { opacity: 0.6, densityHarmonic: 1.5, speedRatio: 0.8, hueAngle: 60 } },\n            accent:     { preset: 'reactive', config: { opacity: 0.3, gain: 2.5, decay: 0.92 } }\n        }\n    },\n\n    /** Mirror mode ‚Äî highlight mirrors keystone, accent chases */\n    symmetry: {\n        keystone: 'content',\n        relationships: {\n            background: { preset: 'echo', config: { opacity: 0.15, densityScale: 0.3, speedScale: 0.15 } },\n            shadow:     { preset: 'mirror', config: { opacity: 0.35 } },\n            highlight:  { preset: 'mirror', config: { opacity: 0.5, hueShift: 120 } },\n            accent:     { preset: 'chase', config: { opacity: 0.4, lerpRate: 0.05 } }\n        }\n    },\n\n    /** Harmonic chord ‚Äî layers at musical intervals */\n    chord: {\n        keystone: 'content',\n        relationships: {\n            background: { preset: 'harmonic', config: { opacity: 0.2, densityHarmonic: 0.5, speedRatio: 0.25, hueAngle: 0 } },\n            shadow:     { preset: 'harmonic', config: { opacity: 0.35, densityHarmonic: 1.5, speedRatio: 0.667, hueAngle: 137.508 } },\n            highlight:  { preset: 'harmonic', config: { opacity: 0.55, densityHarmonic: 2, speedRatio: 0.5, hueAngle: 275.016 } },\n            accent:     { preset: 'harmonic', config: { opacity: 0.3, densityHarmonic: 3, speedRatio: 0.333, hueAngle: 52.524 } }\n        }\n    },\n\n    /** Reactive storm ‚Äî all layers react to keystone changes */\n    storm: {\n        keystone: 'content',\n        relationships: {\n            background: { preset: 'reactive', config: { opacity: 0.25, gain: 1.5, decay: 0.98 } },\n            shadow:     { preset: 'reactive', config: { opacity: 0.4, gain: 2.0, decay: 0.95 } },\n            highlight:  { preset: 'reactive', config: { opacity: 0.6, gain: 3.0, decay: 0.90 } },\n            accent:     { preset: 'reactive', config: { opacity: 0.35, gain: 4.0, decay: 0.88 } }\n        }\n    },\n\n    /** Legacy ‚Äî replicates the old static multiplier behavior exactly */\n    legacy: {\n        keystone: 'content',\n        relationships: {\n            background: { preset: 'echo', config: { opacity: 0.2, densityScale: 0.4, speedScale: 0.2, intensityScale: 0.4 } },\n            shadow:     { preset: 'echo', config: { opacity: 0.4, densityScale: 0.8, speedScale: 0.3, intensityScale: 0.6 } },\n            highlight:  { preset: 'echo', config: { opacity: 0.6, densityScale: 1.5, speedScale: 0.8, intensityScale: 0.8 } },\n            accent:     { preset: 'echo', config: { opacity: 0.3, densityScale: 2.5, speedScale: 0.4, intensityScale: 0.5 } }\n        }\n    }\n};\n\n// ============================================================================\n// LayerRelationshipGraph\n// ============================================================================\n\nexport class LayerRelationshipGraph {\n    /**\n     * @param {Object} [config]\n     * @param {string} [config.keystone='content'] - The driver layer\n     * @param {string} [config.profile] - Named profile to load (holographic, symmetry, chord, storm, legacy)\n     */\n    constructor(config = {}) {\n        /** @type {string} The keystone (driver) layer name */\n        this._keystone = config.keystone || 'content';\n\n        /** @type {Map<string, RelationshipFn>} layer name ‚Üí resolved relationship function */\n        this._relationships = new Map();\n\n        /** @type {Map<string, string>} layer name ‚Üí shader program name */\n        this._layerShaders = new Map();\n\n        /** @type {Map<string, {preset: string, config: Object}|null>} serializable config per layer */\n        this._relationshipConfigs = new Map();\n\n        /** @type {string|null} Currently active profile name */\n        this._activeProfile = null;\n\n        // Load profile if specified\n        if (config.profile && PROFILES[config.profile]) {\n            this.loadProfile(config.profile);\n        }\n    }\n\n    // ========================================================================\n    // Configuration\n    // ========================================================================\n\n    /**\n     * Set the keystone (driver) layer.\n     * @param {string} layerName - One of LAYER_ORDER\n     */\n    setKeystone(layerName) {\n        if (!LAYER_ORDER.includes(layerName)) {\n            throw new Error(`Invalid layer name: \"${layerName}\". Must be one of: ${LAYER_ORDER.join(', ')}`);\n        }\n        this._keystone = layerName;\n        this._activeProfile = null;\n    }\n\n    /** @returns {string} Current keystone layer name */\n    get keystone() {\n        return this._keystone;\n    }\n\n    /**\n     * Set the relationship for a dependent layer.\n     *\n     * @param {string} layerName - The dependent layer\n     * @param {string|RelationshipFn|{preset: string, config?: Object}} relationship\n     *   - String: preset name ('echo', 'mirror', 'complement', 'harmonic', 'reactive', 'chase')\n     *   - Function: custom (keystoneParams, time) => layerParams\n     *   - Object: { preset: 'name', config: {...} }\n     */\n    setRelationship(layerName, relationship) {\n        if (!LAYER_ORDER.includes(layerName)) {\n            throw new Error(`Invalid layer name: \"${layerName}\". Must be one of: ${LAYER_ORDER.join(', ')}`);\n        }\n\n        if (layerName === this._keystone) {\n            throw new Error(`Cannot set relationship on keystone layer \"${layerName}\". Change the keystone first.`);\n        }\n\n        if (typeof relationship === 'function') {\n            this._relationships.set(layerName, relationship);\n            this._relationshipConfigs.set(layerName, null); // custom fn, not serializable\n        } else if (typeof relationship === 'string') {\n            const factory = PRESET_REGISTRY[relationship];\n            if (!factory) {\n                throw new Error(`Unknown relationship preset: \"${relationship}\". Available: ${Object.keys(PRESET_REGISTRY).join(', ')}`);\n            }\n            this._relationships.set(layerName, factory());\n            this._relationshipConfigs.set(layerName, { preset: relationship, config: {} });\n        } else if (relationship && typeof relationship === 'object' && relationship.preset) {\n            const factory = PRESET_REGISTRY[relationship.preset];\n            if (!factory) {\n                throw new Error(`Unknown relationship preset: \"${relationship.preset}\". Available: ${Object.keys(PRESET_REGISTRY).join(', ')}`);\n            }\n            this._relationships.set(layerName, factory(relationship.config || {}));\n            this._relationshipConfigs.set(layerName, { preset: relationship.preset, config: relationship.config || {} });\n        } else {\n            throw new Error('Relationship must be a preset name (string), a function, or { preset, config }.');\n        }\n\n        this._activeProfile = null;\n    }\n\n    /**\n     * Set the shader program for a specific layer.\n     * Layers without an explicit shader use the default (same as keystone).\n     *\n     * @param {string} layerName\n     * @param {string} shaderName - Shader program name to use for this layer\n     */\n    setLayerShader(layerName, shaderName) {\n        if (!LAYER_ORDER.includes(layerName)) {\n            throw new Error(`Invalid layer name: \"${layerName}\".`);\n        }\n        this._layerShaders.set(layerName, shaderName);\n    }\n\n    /**\n     * Get the shader name for a layer (null means use default).\n     * @param {string} layerName\n     * @returns {string|null}\n     */\n    getLayerShader(layerName) {\n        return this._layerShaders.get(layerName) || null;\n    }\n\n    /**\n     * Load a named profile, configuring the full graph at once.\n     * @param {string} profileName - One of: holographic, symmetry, chord, storm, legacy\n     */\n    loadProfile(profileName) {\n        const profile = PROFILES[profileName];\n        if (!profile) {\n            throw new Error(`Unknown profile: \"${profileName}\". Available: ${Object.keys(PROFILES).join(', ')}`);\n        }\n\n        this._keystone = profile.keystone || 'content';\n        this._relationships.clear();\n        this._relationshipConfigs.clear();\n\n        for (const [layerName, rel] of Object.entries(profile.relationships)) {\n            const factory = PRESET_REGISTRY[rel.preset];\n            if (factory) {\n                this._relationships.set(layerName, factory(rel.config || {}));\n                this._relationshipConfigs.set(layerName, { preset: rel.preset, config: rel.config || {} });\n            }\n        }\n\n        this._activeProfile = profileName;\n    }\n\n    /** @returns {string|null} Active profile name, or null if custom */\n    get activeProfile() {\n        return this._activeProfile;\n    }\n\n    /** @returns {string[]} Available profile names */\n    static get profileNames() {\n        return Object.keys(PROFILES);\n    }\n\n    /** @returns {string[]} Available preset relationship names */\n    static get presetNames() {\n        return Object.keys(PRESET_REGISTRY);\n    }\n\n    // ========================================================================\n    // Resolution\n    // ========================================================================\n\n    /**\n     * Resolve parameters for a single dependent layer.\n     *\n     * @param {Object} keystoneParams - The keystone layer's parameters\n     * @param {string} layerName - The layer to resolve\n     * @param {number} time - Current time (ms or frame count)\n     * @returns {Object} Resolved parameters for the layer\n     */\n    resolve(keystoneParams, layerName, time) {\n        if (layerName === this._keystone) {\n            return { ...keystoneParams };\n        }\n\n        const fn = this._relationships.get(layerName);\n        if (!fn) {\n            // No relationship defined ‚Äî passthrough keystone params unchanged\n            return { ...keystoneParams };\n        }\n\n        return fn(keystoneParams, time);\n    }\n\n    /**\n     * Resolve parameters for all layers at once.\n     *\n     * @param {Object} keystoneParams - The keystone layer's parameters\n     * @param {number} time - Current time (ms or frame count)\n     * @returns {Object<string, Object>} Map of layerName ‚Üí resolved params\n     */\n    resolveAll(keystoneParams, time) {\n        const resolved = {};\n        for (const layerName of LAYER_ORDER) {\n            resolved[layerName] = this.resolve(keystoneParams, layerName, time);\n        }\n        return resolved;\n    }\n\n    // ========================================================================\n    // Serialization\n    // ========================================================================\n\n    /**\n     * Export the graph configuration for saving (gallery, presets).\n     * Custom functions are exported as null (not serializable).\n     *\n     * @returns {Object} Serializable graph configuration\n     */\n    exportConfig() {\n        const relationships = {};\n        for (const [layerName, config] of this._relationshipConfigs) {\n            relationships[layerName] = config; // null for custom fns\n        }\n\n        const shaders = {};\n        for (const [layerName, shaderName] of this._layerShaders) {\n            shaders[layerName] = shaderName;\n        }\n\n        return {\n            keystone: this._keystone,\n            profile: this._activeProfile,\n            relationships,\n            shaders\n        };\n    }\n\n    /**\n     * Import a graph configuration (from gallery, presets).\n     *\n     * @param {Object} config - Previously exported config\n     */\n    importConfig(config) {\n        if (!config) return;\n\n        if (config.profile && PROFILES[config.profile]) {\n            this.loadProfile(config.profile);\n        } else {\n            this._keystone = config.keystone || 'content';\n            this._relationships.clear();\n            this._relationshipConfigs.clear();\n\n            if (config.relationships) {\n                for (const [layerName, rel] of Object.entries(config.relationships)) {\n                    if (rel && rel.preset) {\n                        this.setRelationship(layerName, rel);\n                    }\n                }\n            }\n        }\n\n        // Restore shader assignments\n        this._layerShaders.clear();\n        if (config.shaders) {\n            for (const [layerName, shaderName] of Object.entries(config.shaders)) {\n                this._layerShaders.set(layerName, shaderName);\n            }\n        }\n    }\n}\n\n// ============================================================================\n// Exports\n// ============================================================================\n\nexport { LAYER_ORDER, PROFILES, PRESET_REGISTRY };\nexport { echo, mirror, complement, harmonic, reactive, chase };\nexport default LayerRelationshipGraph;\n","/**\n * MultiCanvasBridge - Multi-canvas rendering orchestrator for VIB3+\n *\n * The Quantum and Holographic visualization systems use a 5-layer canvas\n * architecture (background, shadow, content, highlight, accent) where each\n * layer has its own WebGL/WebGPU context. This bridge manages multiple\n * UnifiedRenderBridge instances ‚Äî one per canvas ‚Äî and coordinates shader\n * compilation, uniform updates, and rendering across all layers.\n *\n * Layer parameters are derived through a LayerRelationshipGraph, where one\n * layer acts as the keystone (driver) and others derive their state through\n * configurable relationship functions ‚Äî not static multipliers.\n *\n * Usage:\n *   const multi = new MultiCanvasBridge();\n *   await multi.initialize({\n *       canvases: { background, shadow, content, highlight, accent },\n *       preferWebGPU: true,\n *       relationshipProfile: 'holographic' // or 'symmetry', 'chord', 'storm'\n *   });\n *\n *   multi.compileShaderAll('holographic', shaderSources);\n *   multi.setKeystoneUniforms({ u_time: t, u_density: 1.0, u_hue: 320 });\n *   multi.renderAll('holographic');\n */\n\nimport { UnifiedRenderBridge } from './UnifiedRenderBridge.js';\nimport { LayerRelationshipGraph, LAYER_ORDER as GRAPH_LAYER_ORDER } from './LayerRelationshipGraph.js';\n\n/**\n * Default layer configuration ‚Äî used as fallback when no relationship graph\n * is active (legacy mode). Preserved for backward compatibility only.\n * @deprecated Use LayerRelationshipGraph profiles instead.\n */\nconst DEFAULT_LAYER_CONFIG = {\n    background: { layerScale: 1.0, layerOpacity: 0.2, densityMult: 0.4, speedMult: 0.2 },\n    shadow:     { layerScale: 1.0, layerOpacity: 0.4, densityMult: 0.8, speedMult: 0.3 },\n    content:    { layerScale: 1.0, layerOpacity: 0.8, densityMult: 1.0, speedMult: 0.5 },\n    highlight:  { layerScale: 1.0, layerOpacity: 0.6, densityMult: 1.5, speedMult: 0.8 },\n    accent:     { layerScale: 1.0, layerOpacity: 0.3, densityMult: 2.5, speedMult: 0.4 }\n};\n\n/**\n * Standard layer order (back to front).\n */\nconst LAYER_ORDER = GRAPH_LAYER_ORDER;\n\nexport class MultiCanvasBridge {\n    constructor() {\n        /** @type {Map<string, UnifiedRenderBridge>} layer name ‚Üí bridge */\n        this._bridges = new Map();\n\n        /** @type {Map<string, HTMLCanvasElement>} layer name ‚Üí canvas */\n        this._canvases = new Map();\n\n        /** @type {object} Shared uniforms applied to all layers */\n        this._sharedUniforms = {};\n\n        /** @type {Map<string, object>} Per-layer uniform overrides */\n        this._layerUniforms = new Map();\n\n        /** @type {Map<string, object>} Per-layer config (opacity, density, speed) ‚Äî legacy fallback */\n        this._layerConfig = new Map();\n\n        /** @type {boolean} */\n        this._initialized = false;\n\n        /** @type {string|null} Active backend type (set after init) */\n        this._backendType = null;\n\n        /** @type {LayerRelationshipGraph|null} */\n        this._relationshipGraph = null;\n\n        /** @type {number} Frame time counter for relationship resolution */\n        this._frameTime = 0;\n    }\n\n    /**\n     * Initialize bridges for all canvases.\n     *\n     * @param {object} options\n     * @param {object} options.canvases - Map of layer name ‚Üí HTMLCanvasElement\n     * @param {boolean} [options.preferWebGPU=true] - Try WebGPU for each canvas\n     * @param {boolean} [options.debug=false]\n     * @param {object} [options.layerConfig] - Override default layer configuration (legacy)\n     * @param {string} [options.relationshipProfile] - Named relationship profile to load\n     * @param {LayerRelationshipGraph} [options.relationshipGraph] - Pre-configured graph instance\n     * @returns {Promise<void>}\n     */\n    async initialize(options) {\n        const {\n            canvases,\n            preferWebGPU = true,\n            debug = false,\n            layerConfig = {},\n            relationshipProfile,\n            relationshipGraph\n        } = options;\n\n        // Initialize bridges in parallel\n        const entries = Object.entries(canvases);\n        const results = await Promise.allSettled(\n            entries.map(async ([layerName, canvas]) => {\n                const bridge = await UnifiedRenderBridge.create(canvas, { preferWebGPU, debug });\n                return { layerName, canvas, bridge };\n            })\n        );\n\n        for (const result of results) {\n            if (result.status === 'fulfilled') {\n                const { layerName, canvas, bridge } = result.value;\n                this._bridges.set(layerName, bridge);\n                this._canvases.set(layerName, canvas);\n\n                // Apply legacy layer config (user override > default)\n                const config = {\n                    ...(DEFAULT_LAYER_CONFIG[layerName] || {}),\n                    ...(layerConfig[layerName] || {})\n                };\n                this._layerConfig.set(layerName, config);\n                this._layerUniforms.set(layerName, {});\n\n                if (!this._backendType) {\n                    this._backendType = bridge.getBackendType();\n                }\n            } else {\n                console.error(`MultiCanvasBridge: Failed to init layer \"${result.reason}\"`);\n            }\n        }\n\n        // Set up relationship graph\n        if (relationshipGraph instanceof LayerRelationshipGraph) {\n            this._relationshipGraph = relationshipGraph;\n        } else if (relationshipProfile) {\n            this._relationshipGraph = new LayerRelationshipGraph({ profile: relationshipProfile });\n        }\n\n        this._initialized = this._bridges.size > 0;\n        if (debug) {\n            const graphInfo = this._relationshipGraph\n                ? ` [graph: ${this._relationshipGraph.activeProfile || 'custom'}]`\n                : ' [legacy mode]';\n            console.log(`MultiCanvasBridge: ${this._bridges.size}/${entries.length} layers initialized (${this._backendType})${graphInfo}`);\n        }\n    }\n\n    /**\n     * Check if the bridge is initialized.\n     * @returns {boolean}\n     */\n    get initialized() {\n        return this._initialized;\n    }\n\n    /**\n     * Get the active backend type.\n     * @returns {string|null}\n     */\n    get backendType() {\n        return this._backendType;\n    }\n\n    /**\n     * Get layer names in render order.\n     * @returns {string[]}\n     */\n    get layerNames() {\n        return LAYER_ORDER.filter(name => this._bridges.has(name));\n    }\n\n    /**\n     * Get the bridge for a specific layer.\n     * @param {string} layerName\n     * @returns {UnifiedRenderBridge|undefined}\n     */\n    getBridge(layerName) {\n        return this._bridges.get(layerName);\n    }\n\n    // ========================================================================\n    // Layer Relationship Graph\n    // ========================================================================\n\n    /**\n     * Get the active relationship graph. Creates one with 'holographic' profile\n     * if none exists.\n     * @returns {LayerRelationshipGraph}\n     */\n    get relationshipGraph() {\n        if (!this._relationshipGraph) {\n            this._relationshipGraph = new LayerRelationshipGraph({ profile: 'holographic' });\n        }\n        return this._relationshipGraph;\n    }\n\n    /**\n     * Set or replace the relationship graph.\n     * @param {LayerRelationshipGraph} graph\n     */\n    set relationshipGraph(graph) {\n        this._relationshipGraph = graph;\n    }\n\n    /**\n     * Load a named relationship profile.\n     * @param {string} profileName - holographic, symmetry, chord, storm, legacy\n     */\n    loadRelationshipProfile(profileName) {\n        this.relationshipGraph.loadProfile(profileName);\n    }\n\n    /**\n     * Set the keystone (driver) layer.\n     * @param {string} layerName\n     */\n    setKeystone(layerName) {\n        this.relationshipGraph.setKeystone(layerName);\n    }\n\n    /**\n     * Set the relationship for a dependent layer.\n     * @param {string} layerName\n     * @param {string|Function|Object} relationship - Preset name, function, or { preset, config }\n     */\n    setLayerRelationship(layerName, relationship) {\n        this.relationshipGraph.setRelationship(layerName, relationship);\n    }\n\n    // ========================================================================\n    // Shader Compilation\n    // ========================================================================\n\n    /**\n     * Compile shaders on all layer bridges.\n     *\n     * @param {string} shaderName - e.g. 'holographic'\n     * @param {object} sources - { glslVertex, glslFragment, wgslFragment }\n     * @returns {{ succeeded: string[], failed: string[] }}\n     */\n    compileShaderAll(shaderName, sources) {\n        const succeeded = [];\n        const failed = [];\n\n        for (const [layerName, bridge] of this._bridges) {\n            const ok = bridge.compileShader(shaderName, sources);\n            if (ok) {\n                succeeded.push(layerName);\n            } else {\n                failed.push(layerName);\n            }\n        }\n\n        return { succeeded, failed };\n    }\n\n    /**\n     * Compile a shader on a single layer.\n     *\n     * @param {string} layerName\n     * @param {string} shaderName\n     * @param {object} sources\n     * @returns {boolean}\n     */\n    compileShader(layerName, shaderName, sources) {\n        const bridge = this._bridges.get(layerName);\n        if (!bridge) return false;\n        return bridge.compileShader(shaderName, sources);\n    }\n\n    // ========================================================================\n    // Uniform Management\n    // ========================================================================\n\n    /**\n     * Set uniforms shared across all layers (e.g. time, resolution, geometry).\n     * When a relationship graph is active, these are treated as keystone parameters.\n     *\n     * @param {object} uniforms\n     */\n    setSharedUniforms(uniforms) {\n        this._sharedUniforms = uniforms;\n    }\n\n    /**\n     * Alias for setSharedUniforms when using relationship graph mode.\n     * Makes intent clearer ‚Äî these are the keystone's parameters.\n     *\n     * @param {object} uniforms - Keystone parameters to derive other layers from\n     */\n    setKeystoneUniforms(uniforms) {\n        this._sharedUniforms = uniforms;\n    }\n\n    /**\n     * Set per-layer uniform overrides. Applied after relationship resolution.\n     *\n     * @param {string} layerName\n     * @param {object} uniforms\n     */\n    setLayerUniforms(layerName, uniforms) {\n        const existing = this._layerUniforms.get(layerName) || {};\n        this._layerUniforms.set(layerName, { ...existing, ...uniforms });\n    }\n\n    /**\n     * Update the legacy layer configuration.\n     * @deprecated Use setLayerRelationship() instead.\n     *\n     * @param {string} layerName\n     * @param {object} config - Partial config update\n     */\n    setLayerConfig(layerName, config) {\n        const existing = this._layerConfig.get(layerName) || {};\n        this._layerConfig.set(layerName, { ...existing, ...config });\n    }\n\n    /**\n     * Build the merged uniform set for a specific layer.\n     *\n     * When a relationship graph is active:\n     *   1. Shared uniforms are treated as keystone parameters\n     *   2. The graph resolves derived parameters for the layer\n     *   3. Per-layer overrides are applied on top\n     *\n     * Legacy fallback (no graph):\n     *   Priority: shared < layer config < layer overrides\n     *\n     * @param {string} layerName\n     * @returns {object}\n     */\n    _buildLayerUniforms(layerName) {\n        const overrides = this._layerUniforms.get(layerName) || {};\n\n        if (this._relationshipGraph) {\n            // Relationship graph mode: resolve layer params from keystone\n            const resolved = this._relationshipGraph.resolve(\n                this._sharedUniforms,\n                layerName,\n                this._frameTime\n            );\n\n            // Map relationship output to shader uniforms\n            return {\n                ...resolved,\n                u_layerOpacity: resolved.layerOpacity || resolved.u_layerOpacity || 1.0,\n                ...overrides\n            };\n        }\n\n        // Legacy mode: static multipliers\n        const config = this._layerConfig.get(layerName) || {};\n        return {\n            ...this._sharedUniforms,\n            u_layerScale: config.layerScale || 1.0,\n            u_layerOpacity: config.layerOpacity || 1.0,\n            u_densityMult: config.densityMult || 1.0,\n            u_speedMult: config.speedMult || 1.0,\n            ...overrides\n        };\n    }\n\n    // ========================================================================\n    // Rendering\n    // ========================================================================\n\n    /**\n     * Render all layers in order.\n     *\n     * When a relationship graph is active, each layer may use a different shader\n     * as assigned by graph.setLayerShader(). The shaderName parameter serves as\n     * the default for layers without an explicit shader assignment.\n     *\n     * @param {string} shaderName - Default shader program to use\n     * @param {object} [options]\n     * @param {number[]} [options.clearColor] - RGBA clear color\n     * @param {number} [options.time] - Frame time for relationship resolution\n     */\n    renderAll(shaderName, options = {}) {\n        if (options.time !== undefined) {\n            this._frameTime = options.time;\n        } else {\n            this._frameTime += 16; // ~60fps fallback\n        }\n\n        for (const layerName of this.layerNames) {\n            // Per-layer shader from relationship graph, or default\n            const layerShader = (this._relationshipGraph\n                ? this._relationshipGraph.getLayerShader(layerName)\n                : null) || shaderName;\n\n            this.renderLayer(layerName, layerShader, options);\n        }\n    }\n\n    /**\n     * Render a single layer.\n     *\n     * @param {string} layerName\n     * @param {string} shaderName\n     * @param {object} [options]\n     */\n    renderLayer(layerName, shaderName, options = {}) {\n        const bridge = this._bridges.get(layerName);\n        if (!bridge) return;\n\n        const uniforms = this._buildLayerUniforms(layerName);\n        bridge.setUniforms(uniforms);\n        bridge.render(shaderName, {\n            clearColor: options.clearColor || [0, 0, 0, 0],\n            clear: true\n        });\n    }\n\n    // ========================================================================\n    // Canvas Management\n    // ========================================================================\n\n    /**\n     * Resize all canvases.\n     *\n     * @param {number} width - CSS width\n     * @param {number} height - CSS height\n     * @param {number} [pixelRatio=1]\n     */\n    resizeAll(width, height, pixelRatio = 1) {\n        for (const [, bridge] of this._bridges) {\n            bridge.resize(width, height, pixelRatio);\n        }\n    }\n\n    /**\n     * Get the number of active layers.\n     * @returns {number}\n     */\n    get layerCount() {\n        return this._bridges.size;\n    }\n\n    // ========================================================================\n    // Cleanup\n    // ========================================================================\n\n    /**\n     * Dispose all bridges and clear state.\n     */\n    dispose() {\n        for (const [, bridge] of this._bridges) {\n            bridge.dispose();\n        }\n        this._bridges.clear();\n        this._canvases.clear();\n        this._layerUniforms.clear();\n        this._layerConfig.clear();\n        this._sharedUniforms = {};\n        this._initialized = false;\n        this._backendType = null;\n        this._relationshipGraph = null;\n        this._frameTime = 0;\n    }\n}\n\nexport { DEFAULT_LAYER_CONFIG, LAYER_ORDER };\nexport default MultiCanvasBridge;\n","/**\n * ShaderLoader - Fetch, cache, and manage external shader files for VIB3+\n *\n * Loads .glsl and .wgsl shader files from src/shaders/ and provides them\n * to visualization systems via the UnifiedRenderBridge.\n *\n * Features:\n * - Async fetch with in-memory caching\n * - Parallel loading of GLSL + WGSL pairs\n * - Base path configuration for deployment flexibility\n * - Error reporting per shader file\n *\n * Usage:\n *   const loader = new ShaderLoader({ basePath: 'src/shaders' });\n *   const sources = await loader.loadShaderPair('faceted', 'faceted/faceted.frag');\n *   // sources = { glslVertex, glslFragment, wgslFragment }\n *   bridge.compileShader('faceted', sources);\n */\n\n/**\n * Default base path relative to the HTML entry point.\n * Override via constructor options if shaders are served from a different location.\n */\nconst DEFAULT_BASE_PATH = 'src/shaders';\n\n/**\n * Default vertex shader source used when no external vertex file is provided.\n * Simple fullscreen quad via attribute positions.\n */\nconst FALLBACK_VERTEX_GLSL = `\nattribute vec2 a_position;\nvoid main() {\n    gl_Position = vec4(a_position, 0.0, 1.0);\n}\n`;\n\n/**\n * Default WGSL vertex shader - oversized triangle technique (no vertex buffer).\n */\nconst FALLBACK_VERTEX_WGSL = `\nstruct VertexOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv: vec2<f32>,\n};\n\n@vertex\nfn main(@builtin(vertex_index) vertexIndex: u32) -> VertexOutput {\n    var output: VertexOutput;\n    let x = f32(i32(vertexIndex & 1u) * 4 - 1);\n    let y = f32(i32(vertexIndex >> 1u) * 4 - 1);\n    output.position = vec4<f32>(x, y, 0.0, 1.0);\n    output.uv = vec2<f32>((x + 1.0) * 0.5, (1.0 - y) * 0.5);\n    return output;\n}\n`;\n\nexport class ShaderLoader {\n    /**\n     * @param {object} [options]\n     * @param {string} [options.basePath] - Base URL path for shader files\n     */\n    constructor(options = {}) {\n        /** @type {string} */\n        this.basePath = options.basePath || DEFAULT_BASE_PATH;\n\n        /** @type {Map<string, string>} path ‚Üí source text */\n        this._cache = new Map();\n\n        /** @type {Map<string, Promise<string>>} in-flight fetches */\n        this._pending = new Map();\n\n        /** @type {Set<string>} paths that failed to load */\n        this._failed = new Set();\n    }\n\n    /**\n     * Fetch a single shader file by relative path.\n     * Results are cached; subsequent calls return from cache.\n     *\n     * @param {string} relativePath - e.g. 'common/rotation4d.glsl'\n     * @returns {Promise<string|null>} Shader source or null on failure\n     */\n    async load(relativePath) {\n        const key = relativePath;\n\n        // Return from cache\n        if (this._cache.has(key)) {\n            return this._cache.get(key);\n        }\n\n        // Return in-flight promise to avoid duplicate fetches\n        if (this._pending.has(key)) {\n            return this._pending.get(key);\n        }\n\n        // Known failure\n        if (this._failed.has(key)) {\n            return null;\n        }\n\n        const url = `${this.basePath}/${relativePath}`;\n        const fetchPromise = this._fetchShader(url, key);\n        this._pending.set(key, fetchPromise);\n\n        const result = await fetchPromise;\n        this._pending.delete(key);\n        return result;\n    }\n\n    /**\n     * Load a matched pair of GLSL + WGSL fragment shaders for a system,\n     * plus the common vertex shaders.\n     *\n     * @param {string} systemName - e.g. 'faceted', 'quantum', 'holographic'\n     * @param {string} fragmentBasePath - e.g. 'faceted/faceted.frag' (without extension)\n     * @param {object} [options]\n     * @param {string} [options.vertexGlslPath] - Override vertex GLSL path\n     * @param {string} [options.vertexWgslPath] - Override vertex WGSL path\n     * @returns {Promise<{glslVertex: string, glslFragment: string|null, wgslFragment: string|null}>}\n     */\n    async loadShaderPair(systemName, fragmentBasePath, options = {}) {\n        const vertGlslPath = options.vertexGlslPath || 'common/fullscreen.vert.glsl';\n        const vertWgslPath = options.vertexWgslPath || 'common/fullscreen.vert.wgsl';\n        const fragGlslPath = `${fragmentBasePath}.glsl`;\n        const fragWgslPath = `${fragmentBasePath}.wgsl`;\n\n        // Fetch all four in parallel\n        const [vertGlsl, vertWgsl, fragGlsl, fragWgsl] = await Promise.all([\n            this.load(vertGlslPath),\n            this.load(vertWgslPath),\n            this.load(fragGlslPath),\n            this.load(fragWgslPath)\n        ]);\n\n        return {\n            glslVertex: vertGlsl || FALLBACK_VERTEX_GLSL,\n            glslFragment: fragGlsl,\n            wgslVertex: vertWgsl || FALLBACK_VERTEX_WGSL,\n            wgslFragment: fragWgsl\n        };\n    }\n\n    /**\n     * Load all common library shader files.\n     * Returns an object keyed by library name.\n     *\n     * @returns {Promise<object>} { uniforms: { glsl, wgsl }, rotation4d: { glsl, wgsl }, geometry24: { glsl, wgsl } }\n     */\n    async loadCommonLibrary() {\n        const libs = ['uniforms', 'rotation4d', 'geometry24'];\n        const results = {};\n\n        await Promise.all(libs.map(async (name) => {\n            const [glsl, wgsl] = await Promise.all([\n                this.load(`common/${name}.glsl`),\n                this.load(`common/${name}.wgsl`)\n            ]);\n            results[name] = { glsl, wgsl };\n        }));\n\n        return results;\n    }\n\n    /**\n     * Preload all shader files for a given system.\n     *\n     * @param {string} systemName - 'quantum' | 'faceted' | 'holographic'\n     * @returns {Promise<{glslVertex: string, glslFragment: string|null, wgslFragment: string|null}>}\n     */\n    async preloadSystem(systemName) {\n        const fragPaths = {\n            quantum: 'quantum/quantum.frag',\n            faceted: 'faceted/faceted.frag',\n            holographic: 'holographic/holographic.frag'\n        };\n\n        const fragBase = fragPaths[systemName];\n        if (!fragBase) {\n            console.warn(`ShaderLoader: Unknown system \"${systemName}\"`);\n            return { glslVertex: FALLBACK_VERTEX_GLSL, glslFragment: null, wgslFragment: null };\n        }\n\n        return this.loadShaderPair(systemName, fragBase);\n    }\n\n    /**\n     * Preload all three systems' shaders in parallel.\n     *\n     * @returns {Promise<Map<string, object>>} system name ‚Üí shader sources\n     */\n    async preloadAll() {\n        const systems = ['quantum', 'faceted', 'holographic'];\n        const results = new Map();\n\n        await Promise.all(systems.map(async (name) => {\n            results.set(name, await this.preloadSystem(name));\n        }));\n\n        return results;\n    }\n\n    /**\n     * Resolve #include directives in shader source.\n     * GLSL: #include \"common/rotation4d.glsl\"\n     * WGSL: // @include \"common/rotation4d.wgsl\"\n     *\n     * Includes are resolved from the loader's cache (call loadCommonLibrary() first).\n     * Non-recursive ‚Äî only resolves one level of includes.\n     *\n     * @param {string} source - Shader source with include directives\n     * @returns {string} Resolved shader source\n     */\n    resolveIncludes(source) {\n        if (!source) return source;\n\n        // GLSL: #include \"path\"\n        // WGSL: // @include \"path\"\n        const includeRegex = /(?:^|\\n)\\s*(?:#include|\\/\\/\\s*@include)\\s+\"([^\"]+)\"\\s*(?:\\n|$)/g;\n\n        return source.replace(includeRegex, (match, path) => {\n            const cached = this._cache.get(path);\n            if (cached) {\n                return '\\n// --- included from ' + path + ' ---\\n' + cached + '\\n// --- end ' + path + ' ---\\n';\n            }\n            console.warn(`ShaderLoader: Include not found in cache: \"${path}\" ‚Äî load it first via loadCommonLibrary()`);\n            return match; // Leave directive in place if not found\n        });\n    }\n\n    /**\n     * Load a shader file and resolve includes.\n     * @param {string} relativePath\n     * @returns {Promise<string|null>}\n     */\n    async loadAndResolve(relativePath) {\n        const source = await this.load(relativePath);\n        return source ? this.resolveIncludes(source) : null;\n    }\n\n    /**\n     * Clear all cached shaders.\n     */\n    clearCache() {\n        this._cache.clear();\n        this._failed.clear();\n    }\n\n    /**\n     * Get cache statistics.\n     * @returns {{ cached: number, failed: number, pending: number }}\n     */\n    getStats() {\n        return {\n            cached: this._cache.size,\n            failed: this._failed.size,\n            pending: this._pending.size\n        };\n    }\n\n    /**\n     * @private\n     * @param {string} url\n     * @param {string} key\n     * @returns {Promise<string|null>}\n     */\n    async _fetchShader(url, key) {\n        try {\n            const response = await fetch(url);\n            if (!response.ok) {\n                console.warn(`ShaderLoader: Failed to fetch ${url} (${response.status})`);\n                this._failed.add(key);\n                return null;\n            }\n            const text = await response.text();\n            this._cache.set(key, text);\n            return text;\n        } catch (err) {\n            console.warn(`ShaderLoader: Network error fetching ${url}:`, err.message);\n            this._failed.add(key);\n            return null;\n        }\n    }\n}\n\n/**\n * Singleton shader loader instance.\n * Import this for convenient shared access across the app.\n */\nexport const shaderLoader = new ShaderLoader();\n\nexport default ShaderLoader;\n","/**\n * VIB34D Quantum Engine\n * Manages the enhanced quantum system with complex 3D lattice functions\n */\n\nimport { QuantumHolographicVisualizer } from './QuantumVisualizer.js';\nimport { ParameterManager } from '../core/Parameters.js';\nimport { GeometryLibrary } from '../geometry/GeometryLibrary.js';\nimport { MultiCanvasBridge } from '../render/MultiCanvasBridge.js';\nimport { shaderLoader } from '../render/ShaderLoader.js';\n\nexport class QuantumEngine {\n    constructor(options = {}) {\n        console.log('üîÆ Initializing VIB34D Quantum Engine...');\n\n        this.visualizers = [];\n        this.parameters = new ParameterManager();\n        this.isActive = false;\n        this.autoStart = options.autoStart ?? true;\n\n        // Canvas override for single-canvas multi-instance mode\n        /** @type {HTMLCanvasElement|null} */\n        this.canvasOverride = options.canvas || null;\n\n        // Multi-canvas override: { background, shadow, content, highlight, accent }\n        // Enables 5-layer mode without DOM ID lookup (for landing page / multi-instance)\n        /** @type {Object<string, HTMLCanvasElement>|null} */\n        this.canvasSet = options.canvases || null;\n\n        // Bridge rendering state\n        /** @type {MultiCanvasBridge|null} */\n        this._multiCanvasBridge = null;\n        /** @type {'direct'|'bridge'} */\n        this._renderMode = 'direct';\n        /** @type {number} time accumulator for bridge rendering (ms) */\n        this._bridgeTime = 0;\n\n        // Conditional reactivity: Use built-in only if ReactivityManager not active\n        this.useBuiltInReactivity = !window.reactivityManager;\n        \n        // Gesture velocity reactivity system for Quantum\n        this.lastMousePosition = { x: 0.5, y: 0.5 };\n        this.mouseVelocity = { x: 0, y: 0 };\n        this.velocityHistory = [];\n        this.maxVelocityHistory = 10;\n        \n        // Base parameter values for gesture modulation\n        this.baseHue = 280; // Purple-blue for quantum\n        this.baseMorphFactor = 1.0;\n        \n        // Initialize with quantum-enhanced defaults\n        this.parameters.setParameter('hue', this.baseHue);\n        this.parameters.setParameter('intensity', 0.7); // Higher intensity\n        this.parameters.setParameter('saturation', 0.9); // More vivid\n        this.parameters.setParameter('gridDensity', 20); // Denser patterns\n        this.parameters.setParameter('morphFactor', this.baseMorphFactor);\n        \n        this.init();\n    }\n    \n    /**\n     * Initialize the quantum system\n     */\n    init() {\n        this.createVisualizers();\n        this.setupAudioReactivity();\n        this.setupGestureVelocityReactivity(); // Additional gesture system\n        if (this.autoStart) {\n            this.startRenderLoop();\n        }\n        console.log('‚ú® Quantum Engine initialized with audio + gesture velocity reactivity');\n    }\n    \n    /**\n     * Create quantum visualizers for all 5 layers, or a single content-layer\n     * visualizer when canvasOverride is provided.\n     */\n    createVisualizers() {\n        // Single-canvas override mode: lightweight content-only layer\n        if (this.canvasOverride) {\n            try {\n                const visualizer = new QuantumHolographicVisualizer(\n                    this.canvasOverride, 'content', 1.0, 0\n                );\n                if (visualizer.gl) {\n                    this.visualizers.push(visualizer);\n                    console.log('üåå Created quantum single-canvas visualizer (content layer)');\n                } else {\n                    console.warn('‚ö†Ô∏è No WebGL context for quantum canvasOverride');\n                }\n            } catch (error) {\n                console.warn('Failed to create quantum single-canvas visualizer:', error);\n            }\n            return;\n        }\n\n        // Multi-canvas override: 5-layer mode with provided canvas elements\n        // Used by landing page adapters to create multiple independent 5-layer instances\n        if (this.canvasSet) {\n            const layerDefs = [\n                { key: 'background', role: 'background', reactivity: 0.4 },\n                { key: 'shadow',     role: 'shadow',     reactivity: 0.6 },\n                { key: 'content',    role: 'content',    reactivity: 1.0 },\n                { key: 'highlight',  role: 'highlight',  reactivity: 1.3 },\n                { key: 'accent',     role: 'accent',     reactivity: 1.6 },\n            ];\n\n            layerDefs.forEach(layer => {\n                const canvas = this.canvasSet[layer.key];\n                if (!canvas) return;\n                try {\n                    const visualizer = new QuantumHolographicVisualizer(\n                        canvas, layer.role, layer.reactivity, 0\n                    );\n                    if (visualizer.gl) {\n                        this.visualizers.push(visualizer);\n                        console.log(`üåå Created quantum layer (canvasSet): ${layer.role}`);\n                    }\n                } catch (error) {\n                    console.warn(`Failed to create quantum layer ${layer.role}:`, error);\n                }\n            });\n\n            console.log(`‚úÖ Created ${this.visualizers.length} quantum visualizers via canvasSet`);\n            return;\n        }\n\n        const layers = [\n            { id: 'quantum-background-canvas', role: 'background', reactivity: 0.4 },\n            { id: 'quantum-shadow-canvas', role: 'shadow', reactivity: 0.6 },\n            { id: 'quantum-content-canvas', role: 'content', reactivity: 1.0 },\n            { id: 'quantum-highlight-canvas', role: 'highlight', reactivity: 1.3 },\n            { id: 'quantum-accent-canvas', role: 'accent', reactivity: 1.6 }\n        ];\n\n        layers.forEach(layer => {\n            try {\n                // Canvas elements should already exist in HTML\n                const canvas = document.getElementById(layer.id);\n                if (!canvas) {\n                    console.warn(`‚ö†Ô∏è Canvas ${layer.id} not found in DOM - skipping`);\n                    return;\n                }\n\n                const visualizer = new QuantumHolographicVisualizer(layer.id, layer.role, layer.reactivity, 0);\n                if (visualizer.gl) {\n                    this.visualizers.push(visualizer);\n                    console.log(`üåå Created quantum layer: ${layer.role}`);\n                } else {\n                    console.warn(`‚ö†Ô∏è No WebGL context for quantum layer ${layer.id}`);\n                }\n            } catch (error) {\n                console.warn(`Failed to create quantum layer ${layer.id}:`, error);\n            }\n        });\n\n        console.log(`‚úÖ Created ${this.visualizers.length} quantum visualizers with enhanced effects`);\n    }\n\n    /**\n     * Initialize the Quantum system through UnifiedRenderBridge / MultiCanvasBridge.\n     * This wires all 5 layers through the bridge for WebGL/WebGPU abstraction.\n     * Falls back to direct WebGL if bridge initialization fails.\n     *\n     * @param {object} [options]\n     * @param {boolean} [options.preferWebGPU=true] - Try WebGPU first, fall back to WebGL\n     * @param {boolean} [options.debug=false]\n     * @returns {Promise<boolean>} True if bridge mode activated\n     */\n    async initWithBridge(options = {}) {\n        try {\n            const bridge = await this.createMultiCanvasBridge(options);\n            if (bridge && bridge.initialized) {\n                this._renderMode = 'bridge';\n                this._bridgeTime = 0;\n                console.log(`Quantum System initialized via ${bridge.backendType} bridge (${bridge.layerCount} layers)`);\n                return true;\n            }\n            console.warn('Quantum bridge init returned no bridge, staying in direct mode');\n            return false;\n        } catch (e) {\n            console.error('Quantum bridge init failed, staying in direct mode:', e);\n            this._renderMode = 'direct';\n            return false;\n        }\n    }\n\n    /**\n     * Create a MultiCanvasBridge for WebGPU rendering.\n     * Returns a configured bridge with quantum shaders compiled on all layers.\n     *\n     * @param {object} [options]\n     * @param {boolean} [options.preferWebGPU=true]\n     * @returns {Promise<MultiCanvasBridge|null>}\n     */\n    async createMultiCanvasBridge(options = {}) {\n        const canvasMap = {};\n        const layerIds = {\n            background: 'quantum-background-canvas',\n            shadow: 'quantum-shadow-canvas',\n            content: 'quantum-content-canvas',\n            highlight: 'quantum-highlight-canvas',\n            accent: 'quantum-accent-canvas'\n        };\n\n        for (const [role, id] of Object.entries(layerIds)) {\n            const el = document.getElementById(id);\n            if (el) canvasMap[role] = el;\n        }\n\n        if (Object.keys(canvasMap).length === 0) return null;\n\n        const bridge = new MultiCanvasBridge();\n        await bridge.initialize({ canvases: canvasMap, preferWebGPU: options.preferWebGPU !== false });\n\n        // Load external shader files, fall back to inline sources if unavailable\n        let sources = {\n            glslVertex: 'attribute vec2 a_position;\\nvoid main() { gl_Position = vec4(a_position, 0.0, 1.0); }',\n            glslFragment: null,\n            wgslFragment: null\n        };\n\n        try {\n            const external = await shaderLoader.loadShaderPair('quantum', 'quantum/quantum.frag');\n            if (external.glslVertex) sources.glslVertex = external.glslVertex;\n            if (external.glslFragment) sources.glslFragment = external.glslFragment;\n            if (external.wgslFragment) sources.wgslFragment = external.wgslFragment;\n        } catch (loadErr) {\n            console.warn('Quantum external shader load failed, using inline fallback');\n        }\n\n        if (sources.glslFragment || sources.wgslFragment) {\n            const result = bridge.compileShaderAll('quantum', sources);\n            if (result.failed.length > 0) {\n                console.warn(`Quantum shader compilation failed on layers: ${result.failed.join(', ')}`);\n            }\n        }\n\n        this._multiCanvasBridge = bridge;\n        return bridge;\n    }\n\n    /**\n     * Build the VIB3+ standard uniform object from current parameters.\n     * Used by bridge rendering to send uniforms to external shader programs.\n     * @private\n     * @returns {object}\n     */\n    _buildSharedUniforms() {\n        const params = this.parameters.getAllParameters();\n        const audioData = window.audioReactive || { bass: 0, mid: 0, high: 0 };\n\n        return {\n            u_time: this._bridgeTime,\n            u_resolution: null, // Set per-layer by MultiCanvasBridge\n            u_geometry: params.geometry || 0,\n            u_rot4dXY: params.rot4dXY || 0,\n            u_rot4dXZ: params.rot4dXZ || 0,\n            u_rot4dYZ: params.rot4dYZ || 0,\n            u_rot4dXW: params.rot4dXW || 0,\n            u_rot4dYW: params.rot4dYW || 0,\n            u_rot4dZW: params.rot4dZW || 0,\n            u_dimension: params.dimension || 3.5,\n            u_gridDensity: params.gridDensity || 20,\n            u_morphFactor: params.morphFactor || 1.0,\n            u_chaos: params.chaos || 0.2,\n            u_speed: params.speed || 1.0,\n            u_hue: params.hue || 280,\n            u_intensity: params.intensity || 0.7,\n            u_saturation: params.saturation || 0.9,\n            u_mouseIntensity: 0,\n            u_clickIntensity: this.clickFlashIntensity || 0,\n            u_bass: audioData.bass || 0,\n            u_mid: audioData.mid || 0,\n            u_high: audioData.high || 0\n        };\n    }\n\n    /**\n     * Render a single frame via the MultiCanvasBridge.\n     * Sets shared uniforms and renders all 5 layers with the external quantum shader.\n     * @private\n     */\n    _renderBridgeFrame() {\n        if (!this._multiCanvasBridge || !this._multiCanvasBridge.initialized) return;\n\n        this._bridgeTime += 16; // ~60fps increment\n\n        const uniforms = this._buildSharedUniforms();\n\n        // Set canvas resolution per layer before rendering\n        for (const layerName of this._multiCanvasBridge.layerNames) {\n            const bridge = this._multiCanvasBridge.getBridge(layerName);\n            if (bridge && bridge.canvas) {\n                this._multiCanvasBridge.setLayerUniforms(layerName, {\n                    u_resolution: [bridge.canvas.width, bridge.canvas.height]\n                });\n            }\n        }\n\n        this._multiCanvasBridge.setSharedUniforms(uniforms);\n        this._multiCanvasBridge.renderAll('quantum', { clearColor: [0, 0, 0, 0] });\n    }\n\n    /**\n     * Set system active/inactive\n     */\n    setActive(active) {\n        this.isActive = active;\n\n        if (active) {\n            // Show quantum layers (skip in single-canvas override mode)\n            if (!this.canvasOverride) {\n                const quantumLayers = document.getElementById('quantumLayers');\n                if (quantumLayers) {\n                    quantumLayers.style.display = 'block';\n                }\n            }\n\n            // Enable audio if global audio is enabled\n            if (window.audioEnabled && !this.audioEnabled) {\n                this.enableAudio();\n            }\n\n            console.log('üîÆ Quantum System ACTIVATED - Audio frequency reactivity mode');\n        } else {\n            // Hide quantum layers (skip in single-canvas override mode)\n            if (!this.canvasOverride) {\n                const quantumLayers = document.getElementById('quantumLayers');\n                if (quantumLayers) {\n                    quantumLayers.style.display = 'none';\n                }\n            }\n            console.log('üîÆ Quantum System DEACTIVATED');\n        }\n    }\n    \n    // Method to be called when global audio is toggled\n    toggleAudio(enabled) {\n        if (enabled && this.isActive && !this.audioEnabled) {\n            this.enableAudio();\n        } else if (!enabled && this.audioEnabled) {\n            this.audioEnabled = false;\n            // Stop audio stream tracks to release microphone\n            if (this._audioStream) {\n                this._audioStream.getTracks().forEach(track => track.stop());\n                this._audioStream = null;\n            }\n            if (this.audioContext) {\n                this.audioContext.close().catch(() => {});\n                this.audioContext = null;\n            }\n            this.analyser = null;\n            this.frequencyData = null;\n            console.log('Quantum audio reactivity disabled');\n        }\n    }\n    \n    /**\n     * Setup audio frequency reactivity for Quantum system\n     */\n    setupAudioReactivity() {\n        console.log('üåå Setting up Quantum audio frequency reactivity');\n        // Audio setup will be triggered when audio is enabled\n    }\n    \n    /**\n     * Setup enhanced multi-parameter reactivity for Quantum system\n     */\n    setupGestureVelocityReactivity() {\n        if (!this.useBuiltInReactivity) {\n            console.log('üåå Quantum built-in reactivity DISABLED - ReactivityManager active');\n            return;\n        }\n        if (this.canvasOverride) {\n            console.log('üåå Quantum gesture reactivity skipped (single-canvas override mode)');\n            return;\n        }\n\n        console.log('üåå Setting up Quantum: velocity + click + scroll + multi-parameter reactivity');\n\n        // Enhanced state for smooth effects\n        this.clickFlashIntensity = 0;\n        this.scrollMorph = 1.0; // Base morph factor\n        this.velocitySmoothing = 0.8; // Smoother velocity transitions\n\n        // Gather canvases: from canvasSet (landing page) or DOM IDs (main app)\n        const canvasElements = [];\n        if (this.canvasSet) {\n            Object.values(this.canvasSet).forEach(c => { if (c) canvasElements.push(c); });\n        } else {\n            ['quantum-background-canvas', 'quantum-shadow-canvas', 'quantum-content-canvas',\n             'quantum-highlight-canvas', 'quantum-accent-canvas'].forEach(id => {\n                const c = document.getElementById(id);\n                if (c) canvasElements.push(c);\n            });\n        }\n\n        canvasElements.forEach(canvas => {\n            \n            // Mouse movement -> smooth velocity + multiple parameters\n            canvas.addEventListener('mousemove', (e) => {\n                if (!this.isActive) return;\n                \n                const rect = canvas.getBoundingClientRect();\n                const mouseX = (e.clientX - rect.left) / rect.width;\n                const mouseY = (e.clientY - rect.top) / rect.height;\n                \n                this.updateEnhancedQuantumParameters(mouseX, mouseY);\n            });\n            \n            // Touch movement -> same enhanced parameters\n            canvas.addEventListener('touchmove', (e) => {\n                if (!this.isActive) return;\n\n                if (e.touches.length > 0) {\n                    const touch = e.touches[0];\n                    const rect = canvas.getBoundingClientRect();\n                    const touchX = (touch.clientX - rect.left) / rect.width;\n                    const touchY = (touch.clientY - rect.top) / rect.height;\n\n                    this.updateEnhancedQuantumParameters(touchX, touchY);\n                }\n            }, { passive: true });\n            \n            // Click -> quantum flash effect\n            canvas.addEventListener('click', (e) => {\n                if (!this.isActive) return;\n                this.triggerQuantumClick();\n            });\n            \n            // Touch end -> quantum flash effect\n            canvas.addEventListener('touchend', (e) => {\n                if (!this.isActive) return;\n                this.triggerQuantumClick();\n            });\n            \n            // Wheel -> quantum morphing scroll effect\n            canvas.addEventListener('wheel', (e) => {\n                if (!this.isActive) return;\n                this.updateQuantumScroll(e.deltaY);\n            }, { passive: true });\n        });\n        \n        // Start smooth animation loops\n        this.startQuantumEffectLoops();\n    }\n    \n    updateEnhancedQuantumParameters(x, y) {\n        // Calculate velocity from position change (smoother)\n        const deltaX = x - this.lastMousePosition.x;\n        const deltaY = y - this.lastMousePosition.y;\n        const velocity = Math.sqrt(deltaX * deltaX + deltaY * deltaY);\n        \n        // Smooth velocity history (reduced from 10 to 5 for responsiveness)\n        this.velocityHistory.push(velocity);\n        if (this.velocityHistory.length > 5) {\n            this.velocityHistory.shift();\n        }\n        \n        // Calculate smoother average velocity\n        const avgVelocity = this.velocityHistory.reduce((sum, v) => sum + v, 0) / this.velocityHistory.length;\n        \n        // EXPERIMENTAL QUANTUM MOUSE MAPPING: X-axis rotation + hemispheric colors\n        \n        // X-AXIS: Direct rotation mapping (smooth 4D rotation)\n        // Map mouse X (0-1) to rotation angle (-œÄ to œÄ for full rotation range)\n        const rotationAngle = (x - 0.5) * Math.PI * 2; // -2œÄ to 2œÄ range\n        const rot4dXW = rotationAngle * 0.5; // Smooth XW rotation\n        const rot4dYW = rotationAngle * 0.3; // Complementary YW rotation\n        const rot4dZW = rotationAngle * 0.2; // Subtle ZW rotation\n        \n        // Y-AXIS: Maintains current behavior (density/complexity)\n        const gridDensity = 10 + (y * 90); // Y position: 10-100 range (unchanged)\n        \n        // HEMISPHERIC COLOR MAPPING: Distance from center affects color zones\n        const centerX = 0.5;\n        const centerY = 0.5;\n        const distanceFromCenter = Math.sqrt(Math.pow(x - centerX, 2) + Math.pow(y - centerY, 2));\n        const normalizedDistance = Math.min(1.0, distanceFromCenter * Math.sqrt(2)); // 0-1 range\n        \n        // Color hemisphere mapping\n        const leftHemisphere = x < 0.5;\n        const topHemisphere = y < 0.5;\n        \n        let baseHue;\n        if (leftHemisphere && topHemisphere) {\n            baseHue = 240; // Blue quadrant\n        } else if (!leftHemisphere && topHemisphere) {\n            baseHue = 300; // Purple quadrant  \n        } else if (leftHemisphere && !topHemisphere) {\n            baseHue = 180; // Cyan quadrant\n        } else {\n            baseHue = 320; // Magenta quadrant\n        }\n        \n        // Distance affects hue variation (center = pure color, edges = shifted)\n        const hueVariation = normalizedDistance * 60; // 0-60 degree shift\n        const hue = (baseHue + hueVariation) % 360;\n        \n        // Other parameters influenced by movement\n        const chaos = Math.min(1.0, avgVelocity * 30); // Velocity affects chaos\n        const speed = 0.5 + Math.min(2.5, avgVelocity * 15); // Movement speed\n        const intensity = 0.3 + (normalizedDistance * 0.7); // Distance affects brightness\n        \n        // Update all parameters for rich visual feedback\n        if (window.updateParameter) {\n            // Rotation parameters (new experimental mapping)\n            window.updateParameter('rot4dXW', rot4dXW.toFixed(3));\n            window.updateParameter('rot4dYW', rot4dYW.toFixed(3)); \n            window.updateParameter('rot4dZW', rot4dZW.toFixed(3));\n            \n            // Traditional parameters\n            window.updateParameter('chaos', chaos.toFixed(2));\n            window.updateParameter('speed', speed.toFixed(2));\n            window.updateParameter('gridDensity', Math.round(gridDensity));\n            window.updateParameter('intensity', intensity.toFixed(2));\n            window.updateParameter('hue', Math.round(hue));\n        }\n        \n        // Update last position\n        this.lastMousePosition.x = x;\n        this.lastMousePosition.y = y;\n        \n        // Debug logging (throttled to avoid console spam)\n        if (!this._lastLogTime || performance.now() - this._lastLogTime > 2000) {\n            this._lastLogTime = performance.now();\n            console.log(`Quantum: Rot=${rotationAngle.toFixed(2)}, Density=${Math.round(gridDensity)}, Hue=${Math.round(hue)}`);\n        }\n    }\n    \n    triggerQuantumClick() {\n        // DRAMATIC QUANTUM ENERGY BURST (multi-parameter)\n        this.clickFlashIntensity = 1.0;\n        \n        // Additional dramatic quantum effects that decay back\n        this.quantumChaosBlast = 0.7; // Chaos energy burst\n        this.quantumSpeedWave = 2.0; // Speed wave effect  \n        this.quantumHueShift = 60; // Color explosion shift\n        \n        // Quantum energy burst triggered\n    }\n    \n    updateQuantumScroll(deltaY) {\n        // Scroll affects morph factor smoothly\n        const scrollSpeed = 0.02;\n        const scrollDirection = deltaY > 0 ? 1 : -1;\n        \n        this.scrollMorph += scrollDirection * scrollSpeed;\n        this.scrollMorph = Math.max(0.2, Math.min(2.0, this.scrollMorph)); // Clamp 0.2-2.0\n        \n        // Update morph factor\n        if (window.updateParameter) {\n            window.updateParameter('morphFactor', this.scrollMorph.toFixed(2));\n        }\n        \n        // Quantum scroll morph updated\n    }\n    \n    startQuantumEffectLoops() {\n        this._effectsLoopActive = true;\n        const quantumEffects = () => {\n            if (!this._effectsLoopActive) return;\n\n            // QUANTUM FLASH EFFECT (saturation + morph)\n            if (this.clickFlashIntensity > 0.01) {\n                const flashSaturation = 0.9 + (this.clickFlashIntensity * 0.1);\n                const flashMorph = this.scrollMorph + (this.clickFlashIntensity * 0.5);\n\n                if (window.updateParameter) {\n                    window.updateParameter('saturation', flashSaturation.toFixed(2));\n                    window.updateParameter('morphFactor', flashMorph.toFixed(2));\n                }\n                this.clickFlashIntensity *= 0.91;\n            }\n\n            // DRAMATIC CHAOS BLAST EFFECT (fluid decay)\n            if (this.quantumChaosBlast > 0.01) {\n                const baseChaos = 0.3;\n                const currentChaos = baseChaos + this.quantumChaosBlast;\n                if (window.updateParameter) {\n                    window.updateParameter('chaos', Math.min(1.0, currentChaos).toFixed(2));\n                }\n                this.quantumChaosBlast *= 0.88;\n            }\n\n            // DRAMATIC SPEED WAVE EFFECT (fluid decay)\n            if (this.quantumSpeedWave > 0.01) {\n                const baseSpeed = 1.0;\n                const currentSpeed = baseSpeed + this.quantumSpeedWave;\n                if (window.updateParameter) {\n                    window.updateParameter('speed', Math.min(3.0, currentSpeed).toFixed(2));\n                }\n                this.quantumSpeedWave *= 0.89;\n            }\n\n            // QUANTUM HUE EXPLOSION EFFECT (fluid decay)\n            if (this.quantumHueShift > 1) {\n                const baseHue = 280;\n                const currentHue = (baseHue + this.quantumHueShift) % 360;\n                if (window.updateParameter) {\n                    window.updateParameter('hue', Math.round(currentHue));\n                }\n                this.quantumHueShift *= 0.90;\n            }\n\n            this._effectsRafId = requestAnimationFrame(quantumEffects);\n        };\n\n        this._effectsRafId = requestAnimationFrame(quantumEffects);\n    }\n    \n    async enableAudio() {\n        if (this.audioEnabled) return;\n        \n        try {\n            // Request microphone access\n            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n            \n            // Create audio context and analyser\n            this.audioContext = new (window.AudioContext || window.webkitAudioContext)();\n            this.analyser = this.audioContext.createAnalyser();\n            \n            // Configure analyser for frequency analysis\n            this.analyser.fftSize = 256;\n            this.analyser.smoothingTimeConstant = 0.8;\n            this.frequencyData = new Uint8Array(this.analyser.frequencyBinCount);\n            \n            // Store stream reference for cleanup\n            this._audioStream = stream;\n\n            // Connect microphone to analyser\n            const source = this.audioContext.createMediaStreamSource(stream);\n            source.connect(this.analyser);\n\n            this.audioEnabled = true;\n            console.log('Quantum audio reactivity enabled');\n            \n        } catch (error) {\n            console.error('‚ùå Failed to enable Quantum audio:', error);\n            this.audioEnabled = false;\n        }\n    }\n    \n    /**\n     * Update parameter across all quantum visualizers with enhanced integration\n     */\n    updateParameter(param, value) {\n        // Update internal parameter manager\n        this.parameters.setParameter(param, value);\n        \n        // CRITICAL: Apply to all quantum visualizers with immediate render\n        this.visualizers.forEach(visualizer => {\n            if (visualizer.updateParameters) {\n                const params = {};\n                params[param] = value;\n                visualizer.updateParameters(params);\n            } else {\n                // Fallback: direct parameter update with manual render\n                if (visualizer.params) {\n                    visualizer.params[param] = value;\n                    if (visualizer.render) {\n                        visualizer.render();\n                    }\n                }\n            }\n        });\n        \n        console.log(`üîÆ Updated quantum ${param}: ${value}`);\n    }\n    \n    /**\n     * Update multiple parameters\n     */\n    updateParameters(params) {\n        Object.keys(params).forEach(param => {\n            this.updateParameter(param, params[param]);\n        });\n    }\n    \n    /**\n     * Update mouse interaction\n     */\n    updateInteraction(x, y, intensity) {\n        this.visualizers.forEach(visualizer => {\n            if (visualizer.updateInteraction) {\n                visualizer.updateInteraction(x, y, intensity);\n            }\n        });\n    }\n    \n    /**\n     * Get current parameters for saving/export\n     */\n    getParameters() {\n        return this.parameters.getAllParameters();\n    }\n    \n    /**\n     * Set parameters from loaded/imported data\n     */\n    setParameters(params) {\n        Object.keys(params).forEach(param => {\n            this.parameters.setParameter(param, params[param]);\n        });\n        this.updateParameters(params);\n    }\n    \n    /**\n     * Start the render loop\n     */\n    startRenderLoop() {\n        if (window.mobileDebug) {\n            window.mobileDebug.log(`üé¨ Quantum Engine: Starting render loop with ${this.visualizers?.length} visualizers, isActive=${this.isActive}`);\n        }\n\n        this._renderLoopActive = true;\n        const render = () => {\n            if (!this._renderLoopActive) return;\n            this.renderFrame();\n            this._renderRafId = requestAnimationFrame(render);\n        };\n\n        this._renderRafId = requestAnimationFrame(render);\n        console.log('üé¨ Quantum render loop started');\n\n        if (window.mobileDebug) {\n            window.mobileDebug.log(`‚úÖ Quantum Engine: Render loop started, will render when isActive=true`);\n        }\n    }\n\n    /**\n     * Render a single frame.\n     * Dispatches to bridge mode or direct mode based on current _renderMode.\n     */\n    renderFrame() {\n        if (this.isActive) {\n            if (this._renderMode === 'bridge') {\n                this._renderBridgeFrame();\n            } else {\n                this._renderDirectFrame();\n            }\n\n            // Mobile debug: Log render activity periodically\n            if (window.mobileDebug && !this._renderActivityLogged) {\n                window.mobileDebug.log(`üé¨ Quantum Engine: Actively rendering (${this._renderMode} mode)`);\n                this._renderActivityLogged = true;\n            }\n        } else if (window.mobileDebug && !this._inactiveWarningLogged) {\n            window.mobileDebug.log(`‚ö†Ô∏è Quantum Engine: Not rendering because isActive=false`);\n            this._inactiveWarningLogged = true;\n        }\n    }\n\n    /**\n     * Render a single frame using direct WebGL visualizers (original path).\n     * @private\n     */\n    _renderDirectFrame() {\n        const currentParams = this.parameters.getAllParameters();\n\n        this.visualizers.forEach(visualizer => {\n            if (visualizer.updateParameters && visualizer.render) {\n                visualizer.updateParameters(currentParams);\n                visualizer.render();\n            }\n        });\n    }\n    \n    /**\n     * Update audio reactivity (for universal reactivity system)\n     */\n    // Audio reactivity now handled directly in visualizer render loops\n    \n    /**\n     * Update click effects (for universal reactivity system)\n     */\n    updateClick(intensity) {\n        this.visualizers.forEach(visualizer => {\n            if (visualizer.triggerClick) {\n                visualizer.triggerClick(0.5, 0.5, intensity); // Click at center with intensity\n            }\n        });\n    }\n    \n    /**\n     * Update scroll effects (for universal reactivity system)\n     */\n    updateScroll(velocity) {\n        this.visualizers.forEach(visualizer => {\n            if (visualizer.updateScroll) {\n                visualizer.updateScroll(velocity);\n            }\n        });\n    }\n    \n    /**\n     * Clean up resources\n     */\n    destroy() {\n        this.isActive = false;\n\n        // Cancel render loop\n        this._renderLoopActive = false;\n        if (this._renderRafId) {\n            cancelAnimationFrame(this._renderRafId);\n            this._renderRafId = null;\n        }\n\n        // Cancel effects loop\n        this._effectsLoopActive = false;\n        if (this._effectsRafId) {\n            cancelAnimationFrame(this._effectsRafId);\n            this._effectsRafId = null;\n        }\n\n        // Disconnect from universal reactivity\n        if (window.universalReactivity) {\n            window.universalReactivity.disconnectSystem('quantum');\n        }\n\n        // Stop audio stream tracks to release microphone\n        if (this._audioStream) {\n            this._audioStream.getTracks().forEach(track => track.stop());\n            this._audioStream = null;\n        }\n\n        // Close audio context\n        if (this.audioContext) {\n            this.audioContext.close().catch(() => {});\n            this.audioContext = null;\n        }\n        this.audioEnabled = false;\n        this.analyser = null;\n        this.frequencyData = null;\n\n        // Dispose bridge if active\n        if (this._multiCanvasBridge) {\n            this._multiCanvasBridge.dispose();\n            this._multiCanvasBridge = null;\n        }\n        this._renderMode = 'direct';\n\n        // Destroy all visualizers\n        this.visualizers.forEach(visualizer => {\n            if (visualizer.destroy) {\n                visualizer.destroy();\n            }\n        });\n        this.visualizers = [];\n        console.log('Quantum Engine destroyed');\n    }\n\n    // ============================================\n    // RendererContract Compliance Methods\n    // ============================================\n\n    /**\n     * Initialize or re-initialize with optional canvas override (RendererContract.init).\n     * Accepts the same context shape as FacetedSystem for consistency:\n     *   { canvas: HTMLCanvasElement } or { canvasId: 'my-canvas' }\n     *\n     * @param {Object} [context]\n     * @param {HTMLCanvasElement} [context.canvas] - Canvas element override\n     * @param {string} [context.canvasId] - Canvas ID to look up\n     * @param {boolean} [context.preferWebGPU] - Try WebGPU bridge\n     * @returns {Promise<boolean>|boolean} Success status\n     */\n    initWithCanvas(context = {}) {\n        const canvasEl = context.canvas ||\n            (context.canvasId ? document.getElementById(context.canvasId) : null);\n\n        if (canvasEl) {\n            this.canvasOverride = canvasEl;\n        }\n\n        // Tear down any existing visualizers before re-init\n        this.visualizers.forEach(v => v.destroy && v.destroy());\n        this.visualizers = [];\n\n        this.createVisualizers();\n\n        if (!this.autoStart) return this.visualizers.length > 0;\n        this.startRenderLoop();\n        return this.visualizers.length > 0;\n    }\n\n    /**\n     * Handle canvas resize (RendererContract.resize)\n     * @param {number} width - New width in pixels\n     * @param {number} height - New height in pixels\n     * @param {number} [pixelRatio=1] - Device pixel ratio\n     */\n    resize(width, height, pixelRatio = 1) {\n        if (this._renderMode === 'bridge' && this._multiCanvasBridge) {\n            this._multiCanvasBridge.resizeAll(width, height, pixelRatio);\n        } else {\n            this.visualizers.forEach(visualizer => {\n                if (visualizer.canvas && visualizer.gl) {\n                    visualizer.canvas.width = width * pixelRatio;\n                    visualizer.canvas.height = height * pixelRatio;\n                    visualizer.canvas.style.width = `${width}px`;\n                    visualizer.canvas.style.height = `${height}px`;\n                    visualizer.gl.viewport(0, 0, visualizer.canvas.width, visualizer.canvas.height);\n                }\n            });\n        }\n        console.log(`üîÆ Quantum resized to ${width}x${height} @${pixelRatio}x`);\n    }\n\n    /**\n     * Render a single frame (RendererContract.render)\n     * @param {Object} [frameState] - Frame state with time, params, audio\n     */\n    render(frameState = {}) {\n        // Apply frameState parameters if provided\n        if (frameState.params) {\n            this.updateParameters(frameState.params);\n        }\n\n        // Delegate to existing renderFrame\n        this.renderFrame();\n    }\n\n    /**\n     * Get the current rendering backend type.\n     * @returns {'direct-webgl'|string}\n     */\n    getBackendType() {\n        if (this._renderMode === 'bridge' && this._multiCanvasBridge) {\n            return this._multiCanvasBridge.backendType || 'bridge';\n        }\n        return 'direct-webgl';\n    }\n\n    /**\n     * Clean up all resources (RendererContract.dispose)\n     * Alias for destroy() for contract compliance\n     */\n    dispose() {\n        this.destroy();\n    }\n}\n","/**\n * Core Holographic Visualizer - Clean WebGL rendering engine\n * Extracted from working system, no debugging mess\n */\nexport class HolographicVisualizer {\n    constructor(canvasIdOrElement, role = 'content', reactivity = 1.0, variant = 0) {\n        this.canvas = (canvasIdOrElement instanceof HTMLCanvasElement)\n            ? canvasIdOrElement\n            : document.getElementById(canvasIdOrElement);\n        this.role = role;\n        this.reactivity = reactivity;\n        this.variant = variant;\n        \n        // CRITICAL FIX: Define contextOptions as instance property to match SmartCanvasPool\n        this.contextOptions = {\n            alpha: true,\n            depth: true,\n            stencil: false,\n            antialias: false,  // Disable antialiasing on mobile for performance\n            premultipliedAlpha: true,\n            preserveDrawingBuffer: false,\n            powerPreference: 'high-performance',\n            failIfMajorPerformanceCaveat: false  // Don't fail on mobile\n        };\n        \n        // CRITICAL FIX: Check if context already exists from SmartCanvasPool\n        let existingContext = this.canvas.getContext('webgl2') || \n                             this.canvas.getContext('webgl') || \n                             this.canvas.getContext('experimental-webgl');\n        \n        if (existingContext && !existingContext.isContextLost()) {\n            console.log(`üîÑ Reusing existing WebGL context for ${canvasIdOrElement instanceof HTMLCanvasElement ? canvasIdOrElement.id : canvasIdOrElement}`);\n            this.gl = existingContext;\n        } else {\n            // Try WebGL2 first (better mobile support), then WebGL1\n            this.gl = this.canvas.getContext('webgl2', this.contextOptions) || \n                      this.canvas.getContext('webgl', this.contextOptions) ||\n                      this.canvas.getContext('experimental-webgl', this.contextOptions);\n        }\n        \n        if (!this.gl) {\n            console.error(`WebGL not supported for ${canvasIdOrElement}`);\n            this.showWebGLError();\n            throw new Error(`WebGL not supported for ${canvasIdOrElement}`);\n        }\n        \n        this.variantParams = this.generateVariantParams(variant);\n        this.roleParams = this.generateRoleParams(role);\n        \n        // Initialize state\n        this.mouseX = 0.5;\n        this.mouseY = 0.5;\n        this.mouseIntensity = 0.0;\n        this.clickIntensity = 0.0;\n        this.clickDecay = 0.95;\n        \n        // Touch and scroll\n        this.touchX = 0.5;\n        this.touchY = 0.5;\n        this.touchActive = false;\n        this.touchMorph = 0.0;\n        this.touchChaos = 0.0;\n        this.scrollPosition = 0.0;\n        this.scrollVelocity = 0.0;\n        this.scrollDecay = 0.92;\n        this.parallaxDepth = 0.0;\n        this.gridDensityShift = 0.0;\n        this.colorScrollShift = 0.0;\n        \n        // Density system\n        this.densityVariation = 0.0;\n        this.densityTarget = 0.0;\n        \n        // Audio reactivity\n        this.audioData = { bass: 0, mid: 0, high: 0 };\n        this.audioDensityBoost = 0.0;\n        this.audioMorphBoost = 0.0;\n        this.audioSpeedBoost = 0.0;\n        this.audioChaosBoost = 0.0;\n        this.audioColorShift = 0.0;\n        \n        this.startTime = Date.now();\n        this._contextLost = false;\n\n        // WebGL context loss/restore handlers\n        this._onContextLost = (e) => {\n            e.preventDefault();\n            this._contextLost = true;\n            console.warn(`WebGL context lost for ${canvasIdOrElement}`);\n        };\n        this._onContextRestored = () => {\n            console.log(`WebGL context restored for ${canvasIdOrElement}`);\n            this._contextLost = false;\n            try {\n                this.initShaders();\n                this.initBuffers();\n                this.resize();\n            } catch (err) {\n                console.error(`Failed to reinit after context restore for ${canvasIdOrElement}:`, err);\n            }\n        };\n        this.canvas.addEventListener('webglcontextlost', this._onContextLost);\n        this.canvas.addEventListener('webglcontextrestored', this._onContextRestored);\n\n        this.initShaders();\n        this.initBuffers();\n        this.resize();\n    }\n    \n    generateVariantParams(variant) {\n        const vib3Geometries = [\n            'TETRAHEDRON', 'HYPERCUBE', 'SPHERE', 'TORUS', \n            'KLEIN BOTTLE', 'FRACTAL', 'WAVE', 'CRYSTAL'\n        ];\n        \n        const geometryMap = [\n            0, 0, 0, 0,  // 0-3: TETRAHEDRON variations\n            1, 1, 1, 1,  // 4-7: HYPERCUBE variations\n            2, 2, 2, 2,  // 8-11: SPHERE variations\n            3, 3, 3, 3,  // 12-15: TORUS variations\n            4, 4, 4, 4,  // 16-19: KLEIN BOTTLE variations\n            5, 5, 5,     // 20-22: FRACTAL variations\n            6, 6, 6,     // 23-25: WAVE variations\n            7, 7, 7, 7   // 26-29: CRYSTAL variations\n        ];\n        \n        const baseGeometry = geometryMap[variant] || 0;\n        const variationLevel = variant % 4;\n        const geometryName = vib3Geometries[baseGeometry];\n        \n        const suffixes = [' LATTICE', ' FIELD', ' MATRIX', ' RESONANCE'];\n        const finalName = geometryName + suffixes[variationLevel];\n        \n        const geometryConfigs = {\n            0: { gridDensity: 0.8 + variationLevel * 0.2, speed: 0.3 + variationLevel * 0.1, chaos: variationLevel * 0.1, morphFactor: 0.0 + variationLevel * 0.2 },\n            1: { gridDensity: 1.0 + variationLevel * 0.3, speed: 0.5 + variationLevel * 0.1, chaos: variationLevel * 0.15, morphFactor: variationLevel * 0.2 },\n            2: { gridDensity: 1.2 + variationLevel * 0.4, speed: 0.4 + variationLevel * 0.2, chaos: 0.1 + variationLevel * 0.1, morphFactor: 0.3 + variationLevel * 0.2 },\n            3: { gridDensity: 0.9 + variationLevel * 0.3, speed: 0.6 + variationLevel * 0.2, chaos: 0.2 + variationLevel * 0.2, morphFactor: 0.5 + variationLevel * 0.1 },\n            4: { gridDensity: 1.4 + variationLevel * 0.5, speed: 0.7 + variationLevel * 0.1, chaos: 0.3 + variationLevel * 0.2, morphFactor: 0.7 + variationLevel * 0.1 },\n            5: { gridDensity: 1.8 + variationLevel * 0.3, speed: 0.5 + variationLevel * 0.3, chaos: 0.5 + variationLevel * 0.2, morphFactor: 0.8 + variationLevel * 0.05 },\n            6: { gridDensity: 0.6 + variationLevel * 0.4, speed: 0.8 + variationLevel * 0.4, chaos: 0.4 + variationLevel * 0.3, morphFactor: 0.6 + variationLevel * 0.2 },\n            7: { gridDensity: 1.6 + variationLevel * 0.2, speed: 0.2 + variationLevel * 0.1, chaos: 0.1 + variationLevel * 0.1, morphFactor: 0.2 + variationLevel * 0.2 }\n        };\n\n        const config = geometryConfigs[baseGeometry];\n\n        return {\n            geometry: baseGeometry,\n            name: finalName,\n            gridDensity: config.gridDensity,\n            speed: config.speed,\n            hue: (variant * 12.27) % 360,\n            saturation: 0.8 + (variationLevel * 0.05),\n            intensity: 0.5 + (variationLevel * 0.1),\n            chaos: config.chaos,\n            morphFactor: config.morphFactor\n        };\n    }\n    \n    generateRoleParams(role) {\n        const vp = this.variantParams;\n        \n        const roleConfigs = {\n            'background': { \n                densityMult: 0.4, speedMult: 0.2, colorShift: 0.0, intensity: 0.2,\n                mouseReactivity: 0.3, clickReactivity: 0.1 \n            },\n            'shadow': { \n                densityMult: 0.8, speedMult: 0.3, colorShift: 180.0, intensity: 0.4,\n                mouseReactivity: 0.5, clickReactivity: 0.3 \n            },\n            'content': {\n                densityMult: vp.gridDensity, speedMult: vp.speed,\n                colorShift: vp.hue, intensity: vp.intensity,\n                mouseReactivity: 1.0, clickReactivity: 0.8\n            },\n            'highlight': {\n                densityMult: 1.5 + (vp.gridDensity * 0.3), speedMult: 0.8 + (vp.speed * 0.2),\n                colorShift: vp.hue + 60.0, intensity: 0.6 + (vp.intensity * 0.2),\n                mouseReactivity: 1.2, clickReactivity: 1.0\n            },\n            'accent': {\n                densityMult: 2.5 + (vp.gridDensity * 0.5), speedMult: 0.4 + (vp.speed * 0.1),\n                colorShift: vp.hue + 300.0, intensity: 0.3 + (vp.intensity * 0.1),\n                mouseReactivity: 1.5, clickReactivity: 1.2\n            }\n        };\n        \n        return roleConfigs[role] || { \n            densityMult: 1.0, speedMult: 0.5, colorShift: 0.0, intensity: 0.5, \n            mouseReactivity: 1.0, clickReactivity: 0.5 \n        };\n    }\n    \n    initShaders() {\n        const vertexShaderSource = `\n            attribute vec2 a_position;\n            void main() {\n                gl_Position = vec4(a_position, 0.0, 1.0);\n            }\n        `;\n        \n        const fragmentShaderSource = `\n            precision highp float;\n            \n            uniform vec2 u_resolution;\n            uniform float u_time;\n            uniform vec2 u_mouse;\n            uniform float u_geometry;\n            uniform float u_gridDensity;\n            uniform float u_speed;\n            uniform vec3 u_color;\n            uniform float u_intensity;\n            uniform float u_roleDensity;\n            uniform float u_roleSpeed;\n            uniform float u_colorShift;\n            uniform float u_chaosIntensity;\n            uniform float u_mouseIntensity;\n            uniform float u_clickIntensity;\n            uniform float u_densityVariation;\n            uniform float u_chaos;\n            uniform float u_morphFactor;\n            uniform float u_touchMorph;\n            uniform float u_touchChaos;\n            uniform float u_scrollParallax;\n            uniform float u_gridDensityShift;\n            uniform float u_colorScrollShift;\n            uniform float u_audioDensityBoost;\n            uniform float u_audioMorphBoost;\n            uniform float u_audioSpeedBoost;\n            uniform float u_audioChaosBoost;\n            uniform float u_audioColorShift;\n            uniform float u_rot4dXY;\n            uniform float u_rot4dXZ;\n            uniform float u_rot4dYZ;\n            uniform float u_rot4dXW;\n            uniform float u_rot4dYW;\n            uniform float u_rot4dZW;\n\n            // EXHALE FEATURE: Breathing uniform\n            uniform float u_breath;\n\n            // 6D rotation matrices - 3D space rotations (XY, XZ, YZ)\n            mat4 rotateXY(float theta) {\n                float c = cos(theta);\n                float s = sin(theta);\n                return mat4(c, -s, 0, 0, s, c, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);\n            }\n\n            mat4 rotateXZ(float theta) {\n                float c = cos(theta);\n                float s = sin(theta);\n                return mat4(c, 0, s, 0, 0, 1, 0, 0, -s, 0, c, 0, 0, 0, 0, 1);\n            }\n\n            mat4 rotateYZ(float theta) {\n                float c = cos(theta);\n                float s = sin(theta);\n                return mat4(1, 0, 0, 0, 0, c, -s, 0, 0, s, c, 0, 0, 0, 0, 1);\n            }\n\n            // 4D hyperspace rotations (XW, YW, ZW)\n            mat4 rotateXW(float theta) {\n                float c = cos(theta);\n                float s = sin(theta);\n                return mat4(c, 0, 0, -s, 0, 1, 0, 0, 0, 0, 1, 0, s, 0, 0, c);\n            }\n\n            mat4 rotateYW(float theta) {\n                float c = cos(theta);\n                float s = sin(theta);\n                return mat4(1, 0, 0, 0, 0, c, 0, -s, 0, 0, 1, 0, 0, s, 0, c);\n            }\n\n            mat4 rotateZW(float theta) {\n                float c = cos(theta);\n                float s = sin(theta);\n                return mat4(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, c, -s, 0, 0, s, c);\n            }\n            \n            // 4D to 3D projection - BREATHING EFFECT\n            vec3 project4Dto3D(vec4 p) {\n                // Modulate projection distance with breath for \"exhale\" effect (expansion/contraction)\n                float baseDim = 2.5;\n                float dim = baseDim + u_breath * 0.5; // Expands on exhale\n                float w = dim / (dim + p.w);\n                return vec3(p.x * w, p.y * w, p.z * w);\n            }\n\n            // ========================================\n            // POLYTOPE CORE WARP FUNCTIONS (24 Geometries)\n            // ========================================\n            vec3 warpHypersphereCore(vec3 p, int geometryIndex, vec2 mouseDelta) {\n                float radius = length(p);\n                float morphBlend = clamp(u_morphFactor * 0.6 + 0.3, 0.0, 2.0);\n                float w = sin(radius * (1.3 + float(geometryIndex) * 0.12) + u_time * 0.0008 * u_speed);\n                w *= (0.4 + morphBlend * 0.45);\n\n                vec4 p4d = vec4(p * (1.0 + morphBlend * 0.2), w);\n                p4d = rotateXY(u_rot4dXY) * p4d;\n                p4d = rotateXZ(u_rot4dXZ) * p4d;\n                p4d = rotateYZ(u_rot4dYZ) * p4d;\n                p4d = rotateXW(u_rot4dXW) * p4d;\n                p4d = rotateYW(u_rot4dYW) * p4d;\n                p4d = rotateZW(u_rot4dZW) * p4d;\n\n                vec3 projected = project4Dto3D(p4d);\n                return mix(p, projected, clamp(0.45 + morphBlend * 0.35, 0.0, 1.0));\n            }\n\n            vec3 warpHypertetraCore(vec3 p, int geometryIndex, vec2 mouseDelta) {\n                vec3 c1 = normalize(vec3(1.0, 1.0, 1.0));\n                vec3 c2 = normalize(vec3(-1.0, -1.0, 1.0));\n                vec3 c3 = normalize(vec3(-1.0, 1.0, -1.0));\n                vec3 c4 = normalize(vec3(1.0, -1.0, -1.0));\n\n                float morphBlend = clamp(u_morphFactor * 0.8 + 0.2, 0.0, 2.0);\n                float basisMix = dot(p, c1) * 0.14 + dot(p, c2) * 0.1 + dot(p, c3) * 0.08;\n                float w = sin(basisMix * 5.5 + u_time * 0.0009 * u_speed);\n                w *= cos(dot(p, c4) * 4.2 - u_time * 0.0007 * u_speed);\n                w *= (0.5 + morphBlend * 0.4);\n\n                vec3 offset = vec3(dot(p, c1), dot(p, c2), dot(p, c3)) * 0.1 * morphBlend;\n                vec4 p4d = vec4(p + offset, w);\n                p4d = rotateXY(u_rot4dXY) * p4d;\n                p4d = rotateXZ(u_rot4dXZ) * p4d;\n                p4d = rotateYZ(u_rot4dYZ) * p4d;\n                p4d = rotateXW(u_rot4dXW) * p4d;\n                p4d = rotateYW(u_rot4dYW) * p4d;\n                p4d = rotateZW(u_rot4dZW) * p4d;\n\n                vec3 projected = project4Dto3D(p4d);\n\n                float planeInfluence = min(min(abs(dot(p, c1)), abs(dot(p, c2))), min(abs(dot(p, c3)), abs(dot(p, c4))));\n                vec3 blended = mix(p, projected, clamp(0.45 + morphBlend * 0.35, 0.0, 1.0));\n                return mix(blended, blended * (1.0 - planeInfluence * 0.55), 0.2 + morphBlend * 0.2);\n            }\n\n            vec3 applyCoreWarp(vec3 p, float geometryType, vec2 mouseDelta) {\n                float totalBase = 8.0;\n                float coreFloat = floor(geometryType / totalBase);\n                int coreIndex = int(clamp(coreFloat, 0.0, 2.0));\n                float baseGeomFloat = geometryType - floor(geometryType / totalBase) * totalBase;\n                int geometryIndex = int(clamp(floor(baseGeomFloat + 0.5), 0.0, totalBase - 1.0));\n\n                if (coreIndex == 1) {\n                    return warpHypersphereCore(p, geometryIndex, mouseDelta);\n                }\n                if (coreIndex == 2) {\n                    return warpHypertetraCore(p, geometryIndex, mouseDelta);\n                }\n                return p;\n            }\n            // ========================================\n\n            // Enhanced VIB3 Geometry Library - Higher Fidelity\n            float tetrahedronLattice(vec3 p, float gridSize) {\n                vec3 q = fract(p * gridSize) - 0.5;\n                \n                // Enhanced tetrahedron vertices with holographic shimmer\n                float d1 = length(q);\n                float d2 = length(q - vec3(0.35, 0.0, 0.0));\n                float d3 = length(q - vec3(0.0, 0.35, 0.0));\n                float d4 = length(q - vec3(0.0, 0.0, 0.35));\n                float d5 = length(q - vec3(0.2, 0.2, 0.0));\n                float d6 = length(q - vec3(0.2, 0.0, 0.2));\n                float d7 = length(q - vec3(0.0, 0.2, 0.2));\n                \n                float vertices = 1.0 - smoothstep(0.0, 0.03, min(min(min(d1, d2), min(d3, d4)), min(min(d5, d6), d7)));\n                \n                // Enhanced edge network with interference patterns\n                float edges = 0.0;\n                float shimmer = sin(u_time * 0.002) * 0.02;\n                edges = max(edges, 1.0 - smoothstep(0.0, 0.015, abs(length(q.xy) - (0.18 + shimmer))));\n                edges = max(edges, 1.0 - smoothstep(0.0, 0.015, abs(length(q.yz) - (0.18 + shimmer * 0.8))));\n                edges = max(edges, 1.0 - smoothstep(0.0, 0.015, abs(length(q.xz) - (0.18 + shimmer * 1.2))));\n                \n                // Add interference patterns between vertices\n                float interference = sin(d1 * 25.0 + u_time * 0.003) * sin(d2 * 22.0 + u_time * 0.0025) * 0.1;\n                \n                // Volumetric density based on distance field\n                float volume = exp(-length(q) * 3.0) * 0.15;\n                \n                return max(vertices, edges * 0.7) + interference + volume;\n            }\n            \n            float hypercubeLattice(vec3 p, float gridSize) {\n                vec3 grid = fract(p * gridSize);\n                vec3 q = grid - 0.5;\n                \n                // Enhanced hypercube with 4D projection effects\n                vec3 edges = 1.0 - smoothstep(0.0, 0.025, abs(q));\n                float wireframe = max(max(edges.x, edges.y), edges.z);\n                \n                // Add 4D hypercube vertices (8 corners + 8 hypervertices)\n                float vertices = 0.0;\n                for(int i = 0; i < 8; i++) {\n                    // WebGL 1.0 compatible modulus replacement\n                    float iFloat = float(i);\n                    vec3 corner = vec3(\n                        floor(iFloat - floor(iFloat / 2.0) * 2.0) - 0.5,\n                        floor((iFloat / 2.0) - floor((iFloat / 2.0) / 2.0) * 2.0) - 0.5,\n                        float(i / 4) - 0.5\n                    );\n                    float dist = length(q - corner * 0.4);\n                    vertices = max(vertices, 1.0 - smoothstep(0.0, 0.04, dist));\n                }\n                \n                // Holographic interference patterns\n                float interference = sin(length(q) * 20.0 + u_time * 0.002) * 0.08;\n                \n                // Cross-dimensional glow\n                float glow = exp(-length(q) * 2.5) * 0.12;\n                \n                return wireframe * 0.8 + vertices + interference + glow;\n            }\n            \n            float sphereLattice(vec3 p, float gridSize) {\n                vec3 q = fract(p * gridSize) - 0.5;\n                float r = length(q);\n                return 1.0 - smoothstep(0.2, 0.5, r);\n            }\n            \n            float torusLattice(vec3 p, float gridSize) {\n                vec3 q = fract(p * gridSize) - 0.5;\n                float r1 = sqrt(q.x*q.x + q.y*q.y);\n                float r2 = sqrt((r1 - 0.3)*(r1 - 0.3) + q.z*q.z);\n                return 1.0 - smoothstep(0.0, 0.1, r2);\n            }\n            \n            float kleinLattice(vec3 p, float gridSize) {\n                vec3 q = fract(p * gridSize);\n                float u = q.x * 2.0 * 3.14159;\n                float v = q.y * 2.0 * 3.14159;\n                float x = cos(u) * (3.0 + cos(u/2.0) * sin(v) - sin(u/2.0) * sin(2.0*v));\n                float klein = length(vec2(x, q.z)) - 0.1;\n                return 1.0 - smoothstep(0.0, 0.05, abs(klein));\n            }\n            \n            float fractalLattice(vec3 p, float gridSize) {\n                vec3 q = p * gridSize;\n                float scale = 1.0;\n                float fractal = 0.0;\n                for(int i = 0; i < 4; i++) {\n                  q = fract(q) - 0.5;\n                  fractal += abs(length(q)) / scale;\n                  scale *= 2.0;\n                  q *= 2.0;\n                }\n                return 1.0 - smoothstep(0.0, 1.0, fractal);\n            }\n            \n            float waveLattice(vec3 p, float gridSize) {\n                vec3 q = p * gridSize;\n                float wave = sin(q.x * 2.0) * sin(q.y * 2.0) * sin(q.z * 2.0 + u_time);\n                return smoothstep(-0.5, 0.5, wave);\n            }\n            \n            float crystalLattice(vec3 p, float gridSize) {\n                vec3 q = fract(p * gridSize) - 0.5;\n                float d = max(max(abs(q.x), abs(q.y)), abs(q.z));\n                return 1.0 - smoothstep(0.3, 0.5, d);\n            }\n            \n            float getDynamicGeometry(vec3 p, float gridSize, float geometryType) {\n                // Apply polytope core warp transformation (24-geometry system)\n                vec3 warped = applyCoreWarp(p, geometryType, vec2(0.0, 0.0));\n\n                // WebGL 1.0 compatible modulus replacement - decode base geometry\n                float baseGeomFloat = geometryType - floor(geometryType / 8.0) * 8.0;\n                int baseGeom = int(baseGeomFloat);\n                float variation = floor(geometryType / 8.0) / 4.0;\n                float variedGridSize = gridSize * (0.5 + variation * 1.5);\n\n                // Call lattice functions with warped point (enables 24 geometry variants)\n                if (baseGeom == 0) return tetrahedronLattice(warped, variedGridSize);\n                else if (baseGeom == 1) return hypercubeLattice(warped, variedGridSize);\n                else if (baseGeom == 2) return sphereLattice(warped, variedGridSize);\n                else if (baseGeom == 3) return torusLattice(warped, variedGridSize);\n                else if (baseGeom == 4) return kleinLattice(warped, variedGridSize);\n                else if (baseGeom == 5) return fractalLattice(warped, variedGridSize);\n                else if (baseGeom == 6) return waveLattice(warped, variedGridSize);\n                else return crystalLattice(warped, variedGridSize);\n            }\n            \n            vec3 hsv2rgb(vec3 c) {\n                vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n                vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n                return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n            }\n            \n            vec3 rgbGlitch(vec3 color, vec2 uv, float intensity) {\n                vec2 offset = vec2(intensity * 0.005, 0.0);\n                float r = color.r + sin(uv.y * 30.0 + u_time * 0.001) * intensity * 0.06;\n                float g = color.g + sin(uv.y * 28.0 + u_time * 0.0012) * intensity * 0.06;\n                float b = color.b + sin(uv.y * 32.0 + u_time * 0.0008) * intensity * 0.06;\n                return vec3(r, g, b);\n            }\n            \n            float moirePattern(vec2 uv, float intensity) {\n                float freq1 = 12.0 + intensity * 6.0 + u_densityVariation * 3.0;\n                float freq2 = 14.0 + intensity * 8.0 + u_densityVariation * 4.0;\n                float pattern1 = sin(uv.x * freq1) * sin(uv.y * freq1);\n                float pattern2 = sin(uv.x * freq2) * sin(uv.y * freq2);\n                return (pattern1 * pattern2) * intensity * 0.15;\n            }\n            \n            float gridOverlay(vec2 uv, float intensity) {\n                vec2 grid = fract(uv * (8.0 + u_densityVariation * 4.0));\n                float lines = 0.0;\n                lines = max(lines, 1.0 - smoothstep(0.0, 0.02, abs(grid.x - 0.5)));\n                lines = max(lines, 1.0 - smoothstep(0.0, 0.02, abs(grid.y - 0.5)));\n                return lines * intensity * 0.1;\n            }\n            \n            void main() {\n                vec2 uv = gl_FragCoord.xy / u_resolution.xy;\n                float aspectRatio = u_resolution.x / u_resolution.y;\n                uv.x *= aspectRatio;\n                uv -= 0.5;\n                \n                float time = u_time * 0.0004 * u_speed * u_roleSpeed;\n                \n                float mouseInfluence = u_mouseIntensity * 0.25; // FIX: Reduce mouse jarring by 50%\n                vec2 mouseOffset = (u_mouse - 0.5) * mouseInfluence;\n                \n                float parallaxOffset = u_scrollParallax * 0.2;\n                vec2 scrollOffset = vec2(parallaxOffset * 0.1, parallaxOffset * 0.05);\n                \n                float morphOffset = u_touchMorph * 0.3;\n                \n                vec4 p4d = vec4(uv + mouseOffset * 0.1 + scrollOffset, \n                               sin(time * 0.1 + morphOffset) * 0.15, \n                               cos(time * 0.08 + morphOffset * 0.5) * 0.15);\n                \n                float scrollRotation = u_scrollParallax * 0.1;\n                float touchRotation = u_touchMorph * 0.2;\n\n                // Combine manual rotation with automatic/interactive rotation - 6D full rotation\n                p4d = rotateXY(u_rot4dXY + time * 0.1) * p4d;\n                p4d = rotateXZ(u_rot4dXZ + time * 0.12) * p4d;\n                p4d = rotateYZ(u_rot4dYZ + time * 0.08) * p4d;\n                p4d = rotateXW(u_rot4dXW + time * 0.2 + mouseOffset.y * 0.5 + scrollRotation) * p4d;\n                p4d = rotateYW(u_rot4dYW + time * 0.15 + mouseOffset.x * 0.5 + touchRotation) * p4d;\n                p4d = rotateZW(u_rot4dZW + time * 0.25 + u_clickIntensity * 0.3 + u_touchChaos * 0.4) * p4d;\n                \n                vec3 p = project4Dto3D(p4d);\n                \n                float scrollDensityMod = 1.0 + u_gridDensityShift * 0.3;\n                float audioDensityMod = 1.0 + u_audioDensityBoost * 0.5;\n                // Controlled density calculation - breathing modulation added\n                float breathDensityMod = 1.0 + u_breath * 0.1;\n                float baseDensity = u_gridDensity * u_roleDensity * breathDensityMod;\n\n                float densityVariations = (u_densityVariation * 0.3 + (scrollDensityMod - 1.0) * 0.4 + (audioDensityMod - 1.0) * 0.2);\n                float roleDensity = baseDensity + densityVariations;\n                \n                float morphedGeometry = u_geometry + u_morphFactor * 3.0 + u_touchMorph * 2.0 + u_audioMorphBoost * 1.5;\n                float lattice = getDynamicGeometry(p, roleDensity, morphedGeometry);\n                \n                // Enhanced holographic color processing\n                vec3 baseColor = u_color;\n                float latticeIntensity = lattice * u_intensity;\n                \n                // Breathing glow effect\n                latticeIntensity *= (1.0 + u_breath * 0.4);\n\n                // Multi-layer color composition for higher fidelity\n                vec3 color = baseColor * (0.2 + latticeIntensity * 0.8);\n                \n                // Holographic shimmer layers\n                vec3 shimmer1 = baseColor * lattice * 0.5;\n                vec3 shimmer2 = baseColor * sin(lattice * 8.0 + u_time * 0.001) * 0.2;\n                vec3 shimmer3 = baseColor * cos(lattice * 12.0 + u_time * 0.0008) * 0.15;\n                \n                color += shimmer1 + shimmer2 + shimmer3;\n                \n                // Enhanced brightness variations with interference\n                color += vec3(lattice * 0.6) * baseColor;\n                color += vec3(sin(lattice * 15.0) * 0.1) * baseColor;\n                \n                // Depth-based coloring for 3D effect\n                float depth = 1.0 - length(p) * 0.3;\n                color *= (0.7 + depth * 0.3);\n                \n                float enhancedChaos = u_chaos + u_chaosIntensity + u_touchChaos * 0.3 + u_audioChaosBoost * 0.4;\n                color += vec3(moirePattern(uv + scrollOffset, enhancedChaos));\n                color += vec3(gridOverlay(uv, u_mouseIntensity + u_scrollParallax * 0.1));\n                color = rgbGlitch(color, uv, enhancedChaos);\n                \n                // Apply morph distortion to position\n                vec2 morphDistortion = vec2(sin(uv.y * 10.0 + u_time * 0.001) * u_morphFactor * 0.1, \n                                           cos(uv.x * 10.0 + u_time * 0.001) * u_morphFactor * 0.1);\n                color = mix(color, color * (1.0 + length(morphDistortion)), u_morphFactor * 0.5);\n                \n                // Enhanced holographic interaction effects\n                float mouseDist = length(uv - (u_mouse - 0.5) * vec2(aspectRatio, 1.0));\n                \n                // Multi-layer mouse glow with holographic ripples\n                float mouseGlow = exp(-mouseDist * 1.2) * u_mouseIntensity * 0.25;\n                float mouseRipple = sin(mouseDist * 15.0 - u_time * 0.003) * exp(-mouseDist * 2.0) * u_mouseIntensity * 0.1;\n                color += vec3(mouseGlow + mouseRipple) * baseColor * 0.8;\n                \n                // Enhanced click pulse with interference\n                float clickPulse = u_clickIntensity * exp(-mouseDist * 1.8) * 0.4;\n                float clickRing = sin(mouseDist * 20.0 - u_clickIntensity * 5.0) * u_clickIntensity * 0.15;\n                color += vec3(clickPulse + clickRing, (clickPulse + clickRing) * 0.6, (clickPulse + clickRing) * 1.2);\n                \n                // Holographic interference from interactions\n                float interference = sin(mouseDist * 25.0 + u_time * 0.002) * u_mouseIntensity * 0.05;\n                color += vec3(interference) * baseColor;\n                \n                gl_FragColor = vec4(color, 0.95);\n            }\n        `;\n        \n        this.program = this.createProgram(vertexShaderSource, fragmentShaderSource);\n        this.uniforms = {\n            resolution: this.gl.getUniformLocation(this.program, 'u_resolution'),\n            time: this.gl.getUniformLocation(this.program, 'u_time'),\n            mouse: this.gl.getUniformLocation(this.program, 'u_mouse'),\n            geometry: this.gl.getUniformLocation(this.program, 'u_geometry'),\n            gridDensity: this.gl.getUniformLocation(this.program, 'u_gridDensity'),\n            speed: this.gl.getUniformLocation(this.program, 'u_speed'),\n            color: this.gl.getUniformLocation(this.program, 'u_color'),\n            intensity: this.gl.getUniformLocation(this.program, 'u_intensity'),\n            roleDensity: this.gl.getUniformLocation(this.program, 'u_roleDensity'),\n            roleSpeed: this.gl.getUniformLocation(this.program, 'u_roleSpeed'),\n            colorShift: this.gl.getUniformLocation(this.program, 'u_colorShift'),\n            chaosIntensity: this.gl.getUniformLocation(this.program, 'u_chaosIntensity'),\n            mouseIntensity: this.gl.getUniformLocation(this.program, 'u_mouseIntensity'),\n            clickIntensity: this.gl.getUniformLocation(this.program, 'u_clickIntensity'),\n            densityVariation: this.gl.getUniformLocation(this.program, 'u_densityVariation'),\n            chaos: this.gl.getUniformLocation(this.program, 'u_chaos'),\n            morphFactor: this.gl.getUniformLocation(this.program, 'u_morphFactor'),\n            touchMorph: this.gl.getUniformLocation(this.program, 'u_touchMorph'),\n            touchChaos: this.gl.getUniformLocation(this.program, 'u_touchChaos'),\n            scrollParallax: this.gl.getUniformLocation(this.program, 'u_scrollParallax'),\n            gridDensityShift: this.gl.getUniformLocation(this.program, 'u_gridDensityShift'),\n            colorScrollShift: this.gl.getUniformLocation(this.program, 'u_colorScrollShift'),\n            audioDensityBoost: this.gl.getUniformLocation(this.program, 'u_audioDensityBoost'),\n            audioMorphBoost: this.gl.getUniformLocation(this.program, 'u_audioMorphBoost'),\n            audioSpeedBoost: this.gl.getUniformLocation(this.program, 'u_audioSpeedBoost'),\n            audioChaosBoost: this.gl.getUniformLocation(this.program, 'u_audioChaosBoost'),\n            audioColorShift: this.gl.getUniformLocation(this.program, 'u_audioColorShift'),\n            rot4dXY: this.gl.getUniformLocation(this.program, 'u_rot4dXY'),\n            rot4dXZ: this.gl.getUniformLocation(this.program, 'u_rot4dXZ'),\n            rot4dYZ: this.gl.getUniformLocation(this.program, 'u_rot4dYZ'),\n            rot4dXW: this.gl.getUniformLocation(this.program, 'u_rot4dXW'),\n            rot4dYW: this.gl.getUniformLocation(this.program, 'u_rot4dYW'),\n            rot4dZW: this.gl.getUniformLocation(this.program, 'u_rot4dZW'),\n            breath: this.gl.getUniformLocation(this.program, 'u_breath')\n        };\n    }\n    \n    createProgram(vertexSource, fragmentSource) {\n        const vertexShader = this.createShader(this.gl.VERTEX_SHADER, vertexSource);\n        const fragmentShader = this.createShader(this.gl.FRAGMENT_SHADER, fragmentSource);\n        \n        const program = this.gl.createProgram();\n        this.gl.attachShader(program, vertexShader);\n        this.gl.attachShader(program, fragmentShader);\n        this.gl.linkProgram(program);\n        \n        if (!this.gl.getProgramParameter(program, this.gl.LINK_STATUS)) {\n            throw new Error('Program linking failed: ' + this.gl.getProgramInfoLog(program));\n        }\n        \n        return program;\n    }\n    \n    createShader(type, source) {\n        // CRITICAL FIX: Check WebGL context state before shader operations\n        if (!this.gl) {\n            console.error('‚ùå Cannot create shader: WebGL context is null');\n            throw new Error('WebGL context is null');\n        }\n        \n        if (this.gl.isContextLost()) {\n            console.error('‚ùå Cannot create shader: WebGL context is lost');\n            throw new Error('WebGL context is lost');\n        }\n        \n        try {\n            const shader = this.gl.createShader(type);\n            \n            if (!shader) {\n                console.error('‚ùå Failed to create shader object - WebGL context may be invalid');\n                throw new Error('Failed to create shader object - WebGL context may be invalid');\n            }\n            \n            this.gl.shaderSource(shader, source);\n            this.gl.compileShader(shader);\n            \n            if (!this.gl.getShaderParameter(shader, this.gl.COMPILE_STATUS)) {\n                const error = this.gl.getShaderInfoLog(shader);\n                const shaderType = type === this.gl.VERTEX_SHADER ? 'vertex' : 'fragment';\n                \n                // CRITICAL FIX: Show actual error instead of null\n                if (error) {\n                    console.error(`‚ùå ${shaderType} shader compilation failed:`, error);\n                    throw new Error(`${shaderType} shader compilation failed: ${error}`);\n                } else {\n                    console.error(`‚ùå ${shaderType} shader compilation failed: WebGL returned no error info (context may be invalid)`);\n                    throw new Error(`${shaderType} shader compilation failed: WebGL returned no error info (context may be invalid)`);\n                }\n            }\n            \n            return shader;\n        } catch (error) {\n            console.error('‚ùå Exception during shader creation:', error);\n            throw error;\n        }\n    }\n    \n    initBuffers() {\n        const positions = new Float32Array([-1, -1, 1, -1, -1, 1, 1, 1]);\n        \n        this.buffer = this.gl.createBuffer();\n        this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.buffer);\n        this.gl.bufferData(this.gl.ARRAY_BUFFER, positions, this.gl.STATIC_DRAW);\n        \n        const positionLocation = this.gl.getAttribLocation(this.program, 'a_position');\n        this.gl.enableVertexAttribArray(positionLocation);\n        this.gl.vertexAttribPointer(positionLocation, 2, this.gl.FLOAT, false, 0, 0);\n    }\n    \n    resize() {\n        // Mobile-optimized canvas sizing\n        const dpr = Math.min(window.devicePixelRatio || 1, 2); // Cap at 2x for mobile performance\n        const width = this.canvas.clientWidth;\n        const height = this.canvas.clientHeight;\n        \n        // Only resize if dimensions actually changed (mobile optimization)\n        if (this.canvas.width !== width * dpr || this.canvas.height !== height * dpr) {\n            this.canvas.width = width * dpr;\n            this.canvas.height = height * dpr;\n            this.gl.viewport(0, 0, this.canvas.width, this.canvas.height);\n        }\n    }\n    \n    /**\n     * Show user-friendly WebGL error message\n     */\n    showWebGLError() {\n        if (!this.canvas) return;\n        const ctx = this.canvas.getContext('2d');\n        if (ctx) {\n            ctx.fillStyle = '#000';\n            ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n            ctx.fillStyle = '#ff64ff';\n            ctx.font = '16px Orbitron, monospace';\n            ctx.textAlign = 'center';\n            ctx.fillText('WebGL Required', this.canvas.width / 2, this.canvas.height / 2);\n            ctx.fillStyle = '#888';\n            ctx.font = '12px Orbitron, monospace';\n            ctx.fillText('Please enable WebGL in your browser', this.canvas.width / 2, this.canvas.height / 2 + 25);\n        }\n    }\n    \n    updateInteraction(mouseX, mouseY, intensity) {\n        this.mouseX = mouseX;\n        this.mouseY = mouseY;\n        this.mouseIntensity = intensity * this.roleParams.mouseReactivity * this.reactivity;\n    }\n    \n    triggerClick(x, y) {\n        this.clickIntensity = Math.min(1.0, this.clickIntensity + this.roleParams.clickReactivity * this.reactivity);\n    }\n    \n    updateDensity(variation) {\n        this.densityTarget = variation;\n    }\n    \n    updateTouch(touchX, touchY, active) {\n        this.touchX = touchX;\n        this.touchY = touchY;\n        this.touchActive = active;\n        this.touchMorph = (touchX - 0.5) * 2.0;\n        this.touchChaos = Math.abs(touchY - 0.5) * 2.0;\n    }\n    \n    updateScroll(deltaY) {\n        this.scrollVelocity += deltaY * 0.001;\n        this.scrollVelocity = Math.max(-2.0, Math.min(2.0, this.scrollVelocity));\n    }\n    \n    // Audio reactivity now handled directly in render() loop\n    updateAudio_DISABLED() {\n        return; // No longer used - audio handled in render()\n        \n        // Musical visualization approach - responsive but controlled\n        const smoothing = 0.6; // Less smoothing for more reactivity\n        \n        // Initialize if needed\n        if (!this.audioSmooth) {\n            this.audioSmooth = {\n                density: 0, morph: 0, speed: 0, chaos: 0, color: 0, beat: 0\n            };\n        }\n        \n        // Speed: More responsive to rhythm and bass\n        const targetSpeed = audioData.rhythm > 0 ? audioData.rhythm * 0.8 : \n                           audioData.bass > 0.3 ? audioData.bass * 0.6 : 0;\n        this.audioSmooth.speed = this.audioSmooth.speed * smoothing + targetSpeed * (1 - smoothing);\n        this.audioSpeedBoost = this.audioSmooth.speed;\n        \n        // Density: More reactive to energy\n        const targetDensity = audioData.energy * 1.2 + audioData.bass * 0.8;\n        this.audioSmooth.density = this.audioSmooth.density * smoothing + targetDensity * (1 - smoothing);\n        this.audioDensityBoost = this.audioSmooth.density;\n        \n        // Morph: More flowing with melody and mid frequencies\n        const targetMorph = audioData.melody * 1.2 + audioData.mid * 0.8;\n        this.audioSmooth.morph = this.audioSmooth.morph * smoothing + targetMorph * (1 - smoothing);\n        this.audioMorphBoost = this.audioSmooth.morph;\n        \n        // Chaos: More responsive to bass and high frequencies\n        const targetChaos = audioData.bass > 0.4 ? audioData.bass * 0.8 : \n                           audioData.high > 0.6 ? audioData.high * 0.6 : 0;\n        this.audioSmooth.chaos = this.audioSmooth.chaos * smoothing + targetChaos * (1 - smoothing);\n        this.audioChaosBoost = this.audioSmooth.chaos;\n        \n        // Color: More dynamic color shifting\n        const targetColor = (audioData.melody + audioData.high + audioData.mid) * 0.6;\n        this.audioSmooth.color = this.audioSmooth.color * smoothing + targetColor * (1 - smoothing);\n        this.audioColorShift = this.audioSmooth.color * Math.PI;\n        \n        // Beat detection creates sharp visual pulses\n        if (audioData.rhythm > 0.5) { // Lower threshold for beat detection\n            this.clickIntensity = Math.max(this.clickIntensity, 1.0);\n            this.audioSmooth.beat = 1.0;\n        }\n        this.audioSmooth.beat *= 0.8; // Faster beat decay for more responsive pulses\n    }\n    \n    updateScrollPhysics() {\n        this.scrollPosition += this.scrollVelocity;\n        this.scrollVelocity *= this.scrollDecay;\n        this.parallaxDepth = Math.sin(this.scrollPosition * 0.1) * 0.5;\n        this.gridDensityShift = Math.sin(this.scrollPosition * 0.05) * 0.3;\n        this.colorScrollShift = (this.scrollPosition * 0.02) % (Math.PI * 2);\n    }\n    \n    render() {\n        if (!this.program || this._contextLost) return;\n        if (this.gl.isContextLost()) {\n            this._contextLost = true;\n            return;\n        }\n\n        this.resize();\n        this.gl.useProgram(this.program);\n        \n        this.densityVariation += (this.densityTarget - this.densityVariation) * 0.05;\n        this.clickIntensity *= this.clickDecay;\n        this.updateScrollPhysics();\n        \n        const time = Date.now() - this.startTime;\n        \n        // Convert HSL to RGB for color uniform\n        const hue = (this.variantParams.hue || 0) / 360; // Convert to 0-1 range\n        const saturation = this.variantParams.saturation || 0.8;\n        const lightness = Math.max(0.2, Math.min(0.8, this.variantParams.intensity || 0.5)); // Use intensity for lightness\n        \n        // HSL to RGB conversion\n        const hslToRgb = (h, s, l) => {\n            let r, g, b;\n            if (s === 0) {\n                r = g = b = l; // achromatic\n            } else {\n                const hue2rgb = (p, q, t) => {\n                    if (t < 0) t += 1;\n                    if (t > 1) t -= 1;\n                    if (t < 1/6) return p + (q - p) * 6 * t;\n                    if (t < 1/2) return q;\n                    if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;\n                    return p;\n                };\n                const q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n                const p = 2 * l - q;\n                r = hue2rgb(p, q, h + 1/3);\n                g = hue2rgb(p, q, h);\n                b = hue2rgb(p, q, h - 1/3);\n            }\n            return [r, g, b];\n        };\n        \n        const rgbColor = hslToRgb(hue, saturation, lightness);\n        \n        // Set uniforms with proper variant parameters\n        this.gl.uniform2f(this.uniforms.resolution, this.canvas.width, this.canvas.height);\n        this.gl.uniform1f(this.uniforms.time, time);\n        this.gl.uniform2f(this.uniforms.mouse, this.mouseX, this.mouseY);\n        this.gl.uniform1f(this.uniforms.geometry, this.variantParams.geometry !== undefined ? this.variantParams.geometry : this.variant || 0);\n        this.gl.uniform1f(this.uniforms.gridDensity, this.variantParams.gridDensity || 1.0);\n        // Controlled speed calculation - base speed controls main movement, audio provides subtle boost\n        const baseSpeed = (this.variantParams.speed || 0.5) * 0.2;\n        const audioBoost = (this.audioSpeedBoost || 0.0) * 0.1;\n        this.gl.uniform1f(this.uniforms.speed, baseSpeed + audioBoost);\n        this.gl.uniform3fv(this.uniforms.color, new Float32Array(rgbColor));\n        this.gl.uniform1f(this.uniforms.intensity, (this.variantParams.intensity || 0.5) * this.roleParams.intensity);\n        this.gl.uniform1f(this.uniforms.roleDensity, this.roleParams.densityMult);\n        this.gl.uniform1f(this.uniforms.roleSpeed, this.roleParams.speedMult);\n        this.gl.uniform1f(this.uniforms.colorShift, this.roleParams.colorShift + (this.variantParams.hue || 0) / 360);\n        this.gl.uniform1f(this.uniforms.chaosIntensity, this.variantParams.chaos || 0.0);\n        this.gl.uniform1f(this.uniforms.mouseIntensity, this.mouseIntensity);\n        this.gl.uniform1f(this.uniforms.clickIntensity, this.clickIntensity);\n        this.gl.uniform1f(this.uniforms.densityVariation, this.densityVariation);\n        this.gl.uniform1f(this.uniforms.chaos, this.variantParams.chaos || 0.0);\n        this.gl.uniform1f(this.uniforms.morphFactor, this.variantParams.morphFactor || 0.0);\n        \n        // Touch and scroll uniforms\n        this.gl.uniform1f(this.uniforms.touchMorph, this.touchMorph);\n        this.gl.uniform1f(this.uniforms.touchChaos, this.touchChaos);\n        this.gl.uniform1f(this.uniforms.scrollParallax, this.parallaxDepth);\n        this.gl.uniform1f(this.uniforms.gridDensityShift, this.gridDensityShift);\n        this.gl.uniform1f(this.uniforms.colorScrollShift, this.colorScrollShift);\n        \n        // üéµ HOLOGRAPHIC AUDIO REACTIVITY - Direct and beautiful\n        let audioDensity = 0, audioMorph = 0, audioSpeed = 0, audioChaos = 0, audioColor = 0;\n        \n        if (window.audioEnabled && window.audioReactive) {\n            // Holographic audio mapping: Rich volumetric effects\n            audioDensity = window.audioReactive.bass * 1.5;     // Bass creates density in holographic layers\n            audioMorph = window.audioReactive.mid * 1.2;        // Mid frequencies morph the hologram\n            audioSpeed = window.audioReactive.high * 0.8;       // High frequencies speed up animation\n            audioChaos = window.audioReactive.energy * 0.6;     // Energy creates chaotic holographic distortion\n            audioColor = window.audioReactive.bass * 45;        // Bass affects holographic color shifts\n            \n            // Debug logging every 10 seconds to verify holographic audio reactivity\n            if (Date.now() % 10000 < 16) {\n                console.log(`‚ú® Holographic audio reactivity: Density+${audioDensity.toFixed(2)} Morph+${audioMorph.toFixed(2)} Speed+${audioSpeed.toFixed(2)} Chaos+${audioChaos.toFixed(2)} Color+${audioColor.toFixed(1)}`);\n            }\n        }\n        \n        this.gl.uniform1f(this.uniforms.audioDensityBoost, audioDensity);\n        this.gl.uniform1f(this.uniforms.audioMorphBoost, audioMorph);\n        this.gl.uniform1f(this.uniforms.audioSpeedBoost, audioSpeed);\n        this.gl.uniform1f(this.uniforms.audioChaosBoost, audioChaos);\n        this.gl.uniform1f(this.uniforms.audioColorShift, audioColor);\n\n        // 6D rotation uniforms - 3D space + 4D hyperspace\n        this.gl.uniform1f(this.uniforms.rot4dXY, this.variantParams.rot4dXY || 0.0);\n        this.gl.uniform1f(this.uniforms.rot4dXZ, this.variantParams.rot4dXZ || 0.0);\n        this.gl.uniform1f(this.uniforms.rot4dYZ, this.variantParams.rot4dYZ || 0.0);\n        this.gl.uniform1f(this.uniforms.rot4dXW, this.variantParams.rot4dXW || 0.0);\n        this.gl.uniform1f(this.uniforms.rot4dYW, this.variantParams.rot4dYW || 0.0);\n        this.gl.uniform1f(this.uniforms.rot4dZW, this.variantParams.rot4dZW || 0.0);\n\n        // Exhale feature: Use centralized breath from VitalitySystem (0.0 = inhale, 1.0 = exhale)\n        const breathCycle = this.variantParams.breath || 0.0;\n        this.gl.uniform1f(this.uniforms.breath, breathCycle);\n\n        this.gl.drawArrays(this.gl.TRIANGLE_STRIP, 0, 4);\n    }\n    \n    /**\n     * CRITICAL FIX: Reinitialize WebGL context and resources after SmartCanvasPool context recreation\n     */\n    reinitializeContext() {\n        console.log(`üîÑ Reinitializing WebGL context for ${this.canvas?.id}`);\n        \n        // Clear ALL old WebGL references\n        this.program = null;\n        this.buffer = null;\n        this.uniforms = null;\n        this.gl = null;\n        \n        // CRITICAL FIX: Don't create new context - SmartCanvasPool already did this\n        // Just get the existing context that SmartCanvasPool created\n        this.gl = this.canvas.getContext('webgl2') || \n                  this.canvas.getContext('webgl') ||\n                  this.canvas.getContext('experimental-webgl');\n        \n        if (!this.gl) {\n            console.error(`‚ùå No WebGL context available for ${this.canvas?.id} - SmartCanvasPool should have created one`);\n            return false;\n        }\n        \n        if (this.gl.isContextLost()) {\n            console.error(`‚ùå WebGL context is lost for ${this.canvas?.id}`);\n            return false;\n        }\n        \n        // Reinitialize shaders and buffers if context is valid\n        try {\n            this.initShaders();\n            this.initBuffers();\n            this.resize();\n            \n            console.log(`‚úÖ ${this.canvas?.id}: Holographic context reinitialized successfully`);\n            return true;\n        } catch (error) {\n            console.error(`‚ùå Failed to reinitialize holographic WebGL resources for ${this.canvas?.id}:`, error);\n            return false;\n        }\n    }\n\n    /**\n     * Update visualization parameters from SDK global parameter names.\n     * Parameters are written directly to variantParams ‚Äî no name mapping needed\n     * since shader uniforms now use SDK-standard names.\n     */\n    updateParameters(params) {\n        if (!params || typeof params !== 'object') return;\n        if (this.variantParams) {\n            Object.keys(params).forEach(param => {\n                let scaledValue = params[param];\n                // Guard against NaN/Infinity reaching GPU uniforms\n                if (typeof scaledValue !== 'number' || !Number.isFinite(scaledValue)) return;\n\n                // Scale gridDensity (5-100) to holographic density range (0.3-2.5)\n                if (param === 'gridDensity') {\n                    scaledValue = 0.3 + (parseFloat(params[param]) - 5) / 95 * 2.2;\n                }\n\n                this.variantParams[param] = scaledValue;\n\n                // Regenerate role params when geometry changes\n                if (param === 'geometry') {\n                    this.roleParams = this.generateRoleParams(this.role);\n                }\n            });\n        }\n\n        // Don't call render() here - engine will call it to prevent infinite loop\n    }\n\n    /**\n     * Clean up all WebGL resources and event listeners\n     */\n    destroy() {\n        // Remove context loss listeners\n        if (this.canvas) {\n            if (this._onContextLost) {\n                this.canvas.removeEventListener('webglcontextlost', this._onContextLost);\n            }\n            if (this._onContextRestored) {\n                this.canvas.removeEventListener('webglcontextrestored', this._onContextRestored);\n            }\n        }\n\n        // Clean up WebGL resources (guard against lost context)\n        if (this.gl && !this.gl.isContextLost()) {\n            if (this.program) {\n                this.gl.deleteProgram(this.program);\n            }\n            if (this.buffer) {\n                this.gl.deleteBuffer(this.buffer);\n            }\n        }\n\n        this.program = null;\n        this.buffer = null;\n        this.gl = null;\n        this._contextLost = true;\n    }\n}","/**\n * REAL Holographic System - Modified for holo-* canvas IDs\n * Uses the elaborate effects from active-holographic-systems-FIXED\n * Audio reactive only - no mouse/touch/scroll interference\n */\nimport { HolographicVisualizer } from './HolographicVisualizer.js';\nimport { MultiCanvasBridge } from '../render/MultiCanvasBridge.js';\nimport { LayerRelationshipGraph } from '../render/LayerRelationshipGraph.js';\nimport { shaderLoader } from '../render/ShaderLoader.js';\n\nexport class RealHolographicSystem {\n    constructor(options = {}) {\n        this.visualizers = [];\n        this.currentVariant = 0;\n        this.baseVariants = 30; // Original 30 variations\n        this.totalVariants = 30;\n        this.isActive = false;\n\n        // Canvas override for single-canvas multi-instance mode\n        /** @type {HTMLCanvasElement|null} */\n        this.canvasOverride = options.canvas || null;\n\n        // Multi-canvas override: { background, shadow, content, highlight, accent }\n        // Enables 5-layer mode without DOM ID lookup (for landing page / multi-instance)\n        /** @type {Object<string, HTMLCanvasElement>|null} */\n        this.canvasSet = options.canvases || null;\n\n        // Bridge rendering state\n        /** @type {MultiCanvasBridge|null} */\n        this._multiCanvasBridge = null;\n        /** @type {'direct'|'bridge'} */\n        this._renderMode = 'direct';\n        /** @type {number} time accumulator for bridge rendering (ms) */\n        this._bridgeTime = 0;\n\n        // Layer relationship graph ‚Äî keystone-driven inter-layer parameter system\n        /** @type {LayerRelationshipGraph} */\n        this._layerGraph = new LayerRelationshipGraph({\n            profile: options.relationshipProfile || 'holographic'\n        });\n\n        // Conditional reactivity: Use built-in only if ReactivityManager not active\n        this.useBuiltInReactivity = !window.reactivityManager;\n\n        // Audio reactivity system\n        this.audioEnabled = false;\n        this.audioContext = null;\n        this.analyser = null;\n        this.frequencyData = null;\n        this.audioData = { bass: 0, mid: 0, high: 0 };\n        \n        // Variant names for display - SEQUENTIAL ORDER\n        this.variantNames = [\n            // 0-3: TETRAHEDRON variations\n            'TETRAHEDRON LATTICE', 'TETRAHEDRON FIELD', 'TETRAHEDRON MATRIX', 'TETRAHEDRON RESONANCE',\n            // 4-7: HYPERCUBE variations\n            'HYPERCUBE LATTICE', 'HYPERCUBE FIELD', 'HYPERCUBE MATRIX', 'HYPERCUBE QUANTUM',\n            // 8-11: SPHERE variations\n            'SPHERE LATTICE', 'SPHERE FIELD', 'SPHERE MATRIX', 'SPHERE RESONANCE',\n            // 12-15: TORUS variations\n            'TORUS LATTICE', 'TORUS FIELD', 'TORUS MATRIX', 'TORUS QUANTUM',\n            // 16-19: KLEIN BOTTLE variations\n            'KLEIN BOTTLE LATTICE', 'KLEIN BOTTLE FIELD', 'KLEIN BOTTLE MATRIX', 'KLEIN BOTTLE QUANTUM',\n            // 20-22: FRACTAL variations\n            'FRACTAL LATTICE', 'FRACTAL FIELD', 'FRACTAL QUANTUM',\n            // 23-25: WAVE variations\n            'WAVE LATTICE', 'WAVE FIELD', 'WAVE QUANTUM',\n            // 26-29: CRYSTAL variations\n            'CRYSTAL LATTICE', 'CRYSTAL FIELD', 'CRYSTAL MATRIX', 'CRYSTAL QUANTUM'\n        ];\n        \n        this.initialize();\n    }\n    \n    initialize() {\n        console.log('üé® Initializing REAL Holographic System for Active Holograms tab...');\n        this.createVisualizers();\n        this.setupCenterDistanceReactivity(); // NEW: Center-distance grid density changes\n        this.updateVariantDisplay();\n        this.startRenderLoop();\n    }\n    \n    createVisualizers() {\n        // Single-canvas override mode: lightweight content-only layer\n        if (this.canvasOverride) {\n            try {\n                const visualizer = new HolographicVisualizer(\n                    this.canvasOverride, 'content', 1.0, this.currentVariant\n                );\n                if (visualizer.gl) {\n                    this.visualizers.push(visualizer);\n                    console.log('‚úÖ Created holographic single-canvas visualizer (content layer)');\n                } else {\n                    console.warn('‚ö†Ô∏è No WebGL context for holographic canvasOverride');\n                }\n            } catch (error) {\n                console.warn('Failed to create holographic single-canvas visualizer:', error);\n            }\n            return;\n        }\n\n        // Multi-canvas override: 5-layer mode with provided canvas elements\n        // Used by landing page adapters to create multiple independent 5-layer instances\n        if (this.canvasSet) {\n            const layerDefs = [\n                { key: 'background', role: 'background', reactivity: 0.5 },\n                { key: 'shadow',     role: 'shadow',     reactivity: 0.7 },\n                { key: 'content',    role: 'content',    reactivity: 0.9 },\n                { key: 'highlight',  role: 'highlight',  reactivity: 1.1 },\n                { key: 'accent',     role: 'accent',     reactivity: 1.5 },\n            ];\n\n            let successfulLayers = 0;\n            layerDefs.forEach(layer => {\n                const canvas = this.canvasSet[layer.key];\n                if (!canvas) return;\n                try {\n                    const visualizer = new HolographicVisualizer(\n                        canvas, layer.role, layer.reactivity, this.currentVariant\n                    );\n                    if (visualizer.gl) {\n                        this.visualizers.push(visualizer);\n                        successfulLayers++;\n                        console.log(`‚úÖ Created holographic layer (canvasSet): ${layer.role}`);\n                    }\n                } catch (error) {\n                    console.warn(`Failed to create holographic layer ${layer.role}:`, error);\n                }\n            });\n\n            console.log(`‚úÖ Created ${successfulLayers} holographic visualizers via canvasSet`);\n            return;\n        }\n\n        // Create the 5 visualizers using HOLO canvas IDs\n        const layers = [\n            { id: 'holo-background-canvas', role: 'background', reactivity: 0.5 },\n            { id: 'holo-shadow-canvas', role: 'shadow', reactivity: 0.7 },\n            { id: 'holo-content-canvas', role: 'content', reactivity: 0.9 },\n            { id: 'holo-highlight-canvas', role: 'highlight', reactivity: 1.1 },\n            { id: 'holo-accent-canvas', role: 'accent', reactivity: 1.5 }\n        ];\n\n        let successfulLayers = 0;\n        layers.forEach(layer => {\n            try {\n                // Check if canvas element exists\n                const canvas = document.getElementById(layer.id);\n                if (!canvas) {\n                    console.error(`‚ùå Canvas not found: ${layer.id}`);\n                    return;\n                }\n\n                console.log(`üîç Creating holographic visualizer for: ${layer.id}`);\n                const visualizer = new HolographicVisualizer(layer.id, layer.role, layer.reactivity, this.currentVariant);\n\n                if (visualizer.gl) {\n                    this.visualizers.push(visualizer);\n                    successfulLayers++;\n                    console.log(`‚úÖ Created REAL holographic layer: ${layer.role} (${layer.id})`);\n                } else {\n                    console.error(`‚ùå No WebGL context for: ${layer.id}`);\n                }\n            } catch (error) {\n                console.error(`‚ùå Failed to create REAL holographic layer ${layer.id}:`, error);\n            }\n        });\n\n        console.log(`‚úÖ Created ${successfulLayers}/5 REAL holographic layers`);\n\n        if (successfulLayers === 0) {\n            console.error('üö® NO HOLOGRAPHIC VISUALIZERS CREATED! Check canvas elements and WebGL support.');\n        }\n    }\n\n    /**\n     * Initialize the Holographic system through UnifiedRenderBridge / MultiCanvasBridge.\n     * Wires all 5 layers through the bridge for WebGL/WebGPU abstraction.\n     * Falls back to direct WebGL if bridge initialization fails.\n     *\n     * @param {object} [options]\n     * @param {boolean} [options.preferWebGPU=true]\n     * @param {boolean} [options.debug=false]\n     * @returns {Promise<boolean>} True if bridge mode activated\n     */\n    async initWithBridge(options = {}) {\n        try {\n            const bridge = await this.createMultiCanvasBridge(options);\n            if (bridge && bridge.initialized) {\n                this._renderMode = 'bridge';\n                this._bridgeTime = 0;\n                console.log(`Holographic System initialized via ${bridge.backendType} bridge (${bridge.layerCount} layers)`);\n                return true;\n            }\n            console.warn('Holographic bridge init returned no bridge, staying in direct mode');\n            return false;\n        } catch (e) {\n            console.error('Holographic bridge init failed, staying in direct mode:', e);\n            this._renderMode = 'direct';\n            return false;\n        }\n    }\n\n    /**\n     * Create a MultiCanvasBridge for WebGPU rendering.\n     * Returns a configured bridge with holographic shaders compiled on all layers.\n     *\n     * @param {object} [options]\n     * @param {boolean} [options.preferWebGPU=true]\n     * @returns {Promise<MultiCanvasBridge|null>}\n     */\n    async createMultiCanvasBridge(options = {}) {\n        const canvasMap = {};\n        const layerIds = {\n            background: 'holo-background-canvas',\n            shadow: 'holo-shadow-canvas',\n            content: 'holo-content-canvas',\n            highlight: 'holo-highlight-canvas',\n            accent: 'holo-accent-canvas'\n        };\n\n        for (const [role, id] of Object.entries(layerIds)) {\n            const el = document.getElementById(id);\n            if (el) canvasMap[role] = el;\n        }\n\n        if (Object.keys(canvasMap).length === 0) return null;\n\n        const bridge = new MultiCanvasBridge();\n        await bridge.initialize({\n            canvases: canvasMap,\n            preferWebGPU: options.preferWebGPU !== false,\n            relationshipGraph: this._layerGraph\n        });\n\n        // Load external shader files, fall back to inline if unavailable\n        let sources = {\n            glslVertex: 'attribute vec2 a_position;\\nvoid main() { gl_Position = vec4(a_position, 0.0, 1.0); }',\n            glslFragment: null,\n            wgslFragment: null\n        };\n\n        try {\n            const external = await shaderLoader.loadShaderPair('holographic', 'holographic/holographic.frag');\n            if (external.glslVertex) sources.glslVertex = external.glslVertex;\n            if (external.glslFragment) sources.glslFragment = external.glslFragment;\n            if (external.wgslFragment) sources.wgslFragment = external.wgslFragment;\n        } catch (loadErr) {\n            console.warn('Holographic external shader load failed, using inline fallback');\n        }\n\n        if (sources.glslFragment || sources.wgslFragment) {\n            const result = bridge.compileShaderAll('holographic', sources);\n            if (result.failed.length > 0) {\n                console.warn(`Holographic shader compilation failed on layers: ${result.failed.join(', ')}`);\n            }\n        }\n\n        this._multiCanvasBridge = bridge;\n        return bridge;\n    }\n\n    /**\n     * Build the VIB3+ standard uniform object from current parameters and audio data.\n     * Used by bridge rendering to send uniforms to external shader programs.\n     * @private\n     * @returns {object}\n     */\n    _buildSharedUniforms() {\n        const params = this.getParameters();\n        const audio = this.audioData || { bass: 0, mid: 0, high: 0 };\n\n        return {\n            u_time: this._bridgeTime,\n            u_resolution: null, // Set per-layer by MultiCanvasBridge\n            u_geometry: params.geometry || 0,\n            u_rot4dXY: params.rot4dXY || 0,\n            u_rot4dXZ: params.rot4dXZ || 0,\n            u_rot4dYZ: params.rot4dYZ || 0,\n            u_rot4dXW: params.rot4dXW || 0,\n            u_rot4dYW: params.rot4dYW || 0,\n            u_rot4dZW: params.rot4dZW || 0,\n            u_dimension: params.dimension || 3.5,\n            u_gridDensity: params.gridDensity || 15,\n            u_morphFactor: params.morphFactor || 1.0,\n            u_chaos: params.chaos || 0.2,\n            u_speed: params.speed || 1.0,\n            u_hue: params.hue || 320,\n            u_intensity: params.intensity || 0.6,\n            u_saturation: params.saturation || 0.8,\n            u_mouseIntensity: 0,\n            u_clickIntensity: this.colorBurstIntensity || 0,\n            u_bass: audio.bass || 0,\n            u_mid: audio.mid || 0,\n            u_high: audio.high || 0\n        };\n    }\n\n    /**\n     * Render a single frame via the MultiCanvasBridge.\n     * Sets shared uniforms and renders all 5 layers with the external holographic shader.\n     * @private\n     */\n    _renderBridgeFrame() {\n        if (!this._multiCanvasBridge || !this._multiCanvasBridge.initialized) return;\n\n        this._bridgeTime += 16; // ~60fps increment\n\n        const uniforms = this._buildSharedUniforms();\n\n        // Set canvas resolution per layer before rendering\n        for (const layerName of this._multiCanvasBridge.layerNames) {\n            const bridge = this._multiCanvasBridge.getBridge(layerName);\n            if (bridge && bridge.canvas) {\n                this._multiCanvasBridge.setLayerUniforms(layerName, {\n                    u_resolution: [bridge.canvas.width, bridge.canvas.height]\n                });\n            }\n        }\n\n        this._multiCanvasBridge.setSharedUniforms(uniforms);\n        this._multiCanvasBridge.renderAll('holographic', { clearColor: [0, 0, 0, 0] });\n    }\n\n    setActive(active) {\n        this.isActive = active;\n\n        if (active) {\n            // Show holographic layers (skip in single-canvas override mode)\n            if (!this.canvasOverride) {\n                const holoLayers = document.getElementById('holographicLayers');\n                if (holoLayers) {\n                    holoLayers.style.display = 'block';\n                }\n            }\n\n            // Start audio only if globally enabled and not already started\n            if (!this.audioEnabled && window.audioEnabled === true) {\n                this.initAudio();\n            }\n            console.log('üåå REAL Active Holograms ACTIVATED with audio reactivity');\n        } else {\n            // Hide holographic layers (skip in single-canvas override mode)\n            if (!this.canvasOverride) {\n                const holoLayers = document.getElementById('holographicLayers');\n                if (holoLayers) {\n                    holoLayers.style.display = 'none';\n                }\n            }\n            console.log('üåå REAL Active Holograms DEACTIVATED');\n        }\n    }\n    \n    \n    updateVariantDisplay() {\n        // This will be called by the main UI system\n        const variantName = this.variantNames[this.currentVariant];\n        return {\n            variant: this.currentVariant,\n            name: variantName,\n            geometryType: Math.floor(this.currentVariant / 4)\n        };\n    }\n    \n    nextVariant() {\n        this.updateVariant(this.currentVariant + 1);\n    }\n    \n    previousVariant() {\n        this.updateVariant(this.currentVariant - 1);\n    }\n    \n    randomVariant() {\n        const randomIndex = Math.floor(Math.random() * this.totalVariants);\n        this.updateVariant(randomIndex);\n    }\n    \n    setVariant(variant) {\n        this.updateVariant(variant);\n    }\n    \n    updateParameter(param, value) {\n        // Store custom parameter overrides (keystone state)\n        if (!this.customParams) {\n            this.customParams = {};\n        }\n        this.customParams[param] = value;\n\n        // Build keystone params from current state + this update\n        const keystoneParams = { ...this._buildKeystoneParams(), [param]: value };\n\n        // Resolve all layers through the relationship graph\n        const resolved = this._layerGraph.resolveAll(keystoneParams, Date.now());\n\n        // Apply resolved params to each visualizer by role\n        this.visualizers.forEach((visualizer, index) => {\n            const role = visualizer.role || 'content';\n            const layerParams = resolved[role] || keystoneParams;\n\n            try {\n                if (visualizer.updateParameters) {\n                    visualizer.updateParameters(layerParams);\n                } else if (visualizer.variantParams) {\n                    Object.assign(visualizer.variantParams, layerParams);\n                    if (param === 'geometryType' || param === 'geometry') {\n                        visualizer.roleParams = visualizer.generateRoleParams(role);\n                    }\n                }\n            } catch (error) {\n                console.error(`Failed to update holographic layer ${index} (${role}):`, error);\n            }\n        });\n    }\n\n    /**\n     * Update multiple parameters at once (RendererContract / VIB3Engine compatible).\n     * Resolves all layers through the relationship graph in a single pass.\n     * @param {Object} params - Key-value pairs of parameters to update\n     */\n    updateParameters(params) {\n        if (!params || typeof params !== 'object') return;\n\n        // Merge into custom params (keystone state)\n        if (!this.customParams) {\n            this.customParams = {};\n        }\n        Object.assign(this.customParams, params);\n\n        // Build keystone params + resolve all layers in one shot\n        const keystoneParams = { ...this._buildKeystoneParams(), ...params };\n        const resolved = this._layerGraph.resolveAll(keystoneParams, Date.now());\n\n        this.visualizers.forEach((visualizer, index) => {\n            const role = visualizer.role || 'content';\n            const layerParams = resolved[role] || keystoneParams;\n\n            try {\n                if (visualizer.updateParameters) {\n                    visualizer.updateParameters(layerParams);\n                } else if (visualizer.variantParams) {\n                    Object.assign(visualizer.variantParams, layerParams);\n                }\n            } catch (error) {\n                console.error(`Failed to update holographic layer ${index} (${role}):`, error);\n            }\n        });\n    }\n\n    // ========================================================================\n    // Layer Relationship Graph API\n    // ========================================================================\n\n    /**\n     * Build keystone parameters from current state.\n     * These are the driver values that get transformed by the relationship\n     * graph to produce each dependent layer's parameters.\n     * @private\n     * @returns {Object}\n     */\n    _buildKeystoneParams() {\n        const base = {};\n        // Pull from first (content) visualizer's variant params if available\n        const content = this.visualizers.find(v => v.role === 'content');\n        if (content && content.variantParams) {\n            Object.assign(base, content.variantParams);\n        }\n        // Merge custom overrides\n        if (this.customParams) {\n            Object.assign(base, this.customParams);\n        }\n        return base;\n    }\n\n    /**\n     * Get the layer relationship graph for direct configuration.\n     * @returns {LayerRelationshipGraph}\n     */\n    get layerGraph() {\n        return this._layerGraph;\n    }\n\n    /**\n     * Load a relationship profile by name.\n     * @param {string} profileName - holographic, symmetry, chord, storm, legacy\n     */\n    loadRelationshipProfile(profileName) {\n        this._layerGraph.loadProfile(profileName);\n    }\n\n    /**\n     * Set the keystone (driver) layer.\n     * @param {string} layerName - background, shadow, content, highlight, or accent\n     */\n    setKeystone(layerName) {\n        this._layerGraph.setKeystone(layerName);\n    }\n\n    /**\n     * Set the relationship for a dependent layer.\n     * @param {string} layerName\n     * @param {string|Function|Object} relationship - Preset name, function, or { preset, config }\n     */\n    setLayerRelationship(layerName, relationship) {\n        this._layerGraph.setRelationship(layerName, relationship);\n    }\n\n    // Override updateVariant to preserve custom parameters\n    updateVariant(newVariant) {\n        if (newVariant < 0) newVariant = this.totalVariants - 1;\n        if (newVariant >= this.totalVariants) newVariant = 0;\n        \n        this.currentVariant = newVariant;\n        \n        // Update all visualizers with new variant parameters\n        this.visualizers.forEach(visualizer => {\n            visualizer.variant = this.currentVariant;\n            visualizer.variantParams = visualizer.generateVariantParams(this.currentVariant);\n            visualizer.roleParams = visualizer.generateRoleParams(visualizer.role);\n            \n            // Apply any custom parameter overrides\n            if (this.customParams) {\n                Object.keys(this.customParams).forEach(param => {\n                    visualizer.variantParams[param] = this.customParams[param];\n                });\n            }\n        });\n        \n        this.updateVariantDisplay();\n        console.log(`üîÑ REAL Holograms switched to variant ${this.currentVariant + 1}: ${this.variantNames[this.currentVariant]}`);\n    }\n    \n    getCurrentVariantInfo() {\n        return {\n            variant: this.currentVariant,\n            name: this.variantNames[this.currentVariant],\n            geometryType: Math.floor(this.currentVariant / 4)\n        };\n    }\n    \n    /**\n     * Get current parameters for saving/export (CRITICAL for gallery saving)\n     */\n    getParameters() {\n        // Collect parameters from UI sliders - same as other systems\n        const params = {\n            geometry: Math.floor(this.currentVariant / 4), // Extract geometry from variant\n            gridDensity: parseFloat(document.getElementById('gridDensity')?.value || 15),\n            morphFactor: parseFloat(document.getElementById('morphFactor')?.value || 1.0),\n            chaos: parseFloat(document.getElementById('chaos')?.value || 0.2),\n            speed: parseFloat(document.getElementById('speed')?.value || 1.0),\n            hue: parseFloat(document.getElementById('hue')?.value || 320),\n            intensity: parseFloat(document.getElementById('intensity')?.value || 0.6),\n            saturation: parseFloat(document.getElementById('saturation')?.value || 0.8),\n            rot4dXW: parseFloat(document.getElementById('rot4dXW')?.value || 0.0),\n            rot4dYW: parseFloat(document.getElementById('rot4dYW')?.value || 0.0),\n            rot4dZW: parseFloat(document.getElementById('rot4dZW')?.value || 0.0),\n            variant: this.currentVariant\n        };\n        \n        // Apply any custom parameter overrides\n        if (this.customParams) {\n            Object.assign(params, this.customParams);\n        }\n        \n        // Include layer relationship graph config for serialization\n        params.layerRelationship = this._layerGraph.exportConfig();\n\n        return params;\n    }\n    \n    async initAudio() {\n        try {\n            this.audioContext = new (window.AudioContext || window.webkitAudioContext)();\n            \n            if (this.audioContext.state === 'suspended') {\n                await this.audioContext.resume();\n            }\n            \n            this.analyser = this.audioContext.createAnalyser();\n            this.analyser.fftSize = 256;\n            this.frequencyData = new Uint8Array(this.analyser.frequencyBinCount);\n            \n            const constraints = {\n                audio: {\n                    echoCancellation: false,\n                    noiseSuppression: false,\n                    autoGainControl: false,\n                    sampleRate: 44100\n                }\n            };\n            \n            const stream = await navigator.mediaDevices.getUserMedia(constraints);\n            this._audioStream = stream;\n            const source = this.audioContext.createMediaStreamSource(stream);\n            source.connect(this.analyser);\n\n            this.audioEnabled = true;\n            console.log('REAL Holograms audio reactivity enabled');\n        } catch (error) {\n            console.error('REAL Holograms audio initialization failed:', error);\n        }\n    }\n    \n    // NEW: Disable holographic audio (respects global audio toggle)\n    disableAudio() {\n        if (this.audioEnabled) {\n            this.audioEnabled = false;\n            // Stop audio stream tracks to release microphone\n            if (this._audioStream) {\n                this._audioStream.getTracks().forEach(track => track.stop());\n                this._audioStream = null;\n            }\n            if (this.audioContext) {\n                this.audioContext.close().catch(() => {});\n                this.audioContext = null;\n            }\n            this.analyser = null;\n            this.frequencyData = null;\n            this.audioData = { bass: 0, mid: 0, high: 0 };\n            console.log('REAL Holograms audio reactivity disabled');\n        }\n    }\n    \n    updateAudio() {\n        if (!this.audioEnabled || !this.analyser || !this.isActive || window.audioEnabled === false) return;\n        \n        this.analyser.getByteFrequencyData(this.frequencyData);\n        \n        const bassEnd = Math.floor(this.frequencyData.length * 0.1);\n        const midEnd = Math.floor(this.frequencyData.length * 0.4);\n        \n        let bass = 0, mid = 0, high = 0;\n        \n        for (let i = 0; i < bassEnd; i++) {\n            bass += this.frequencyData[i];\n        }\n        bass /= (bassEnd * 255);\n        \n        for (let i = bassEnd; i < midEnd; i++) {\n            mid += this.frequencyData[i];\n        }\n        mid /= ((midEnd - bassEnd) * 255);\n        \n        for (let i = midEnd; i < this.frequencyData.length; i++) {\n            high += this.frequencyData[i];\n        }\n        high /= ((this.frequencyData.length - midEnd) * 255);\n        \n        // Enhanced audio processing for better visual response\n        const smoothedAudio = {\n            bass: this.smoothAudioValue(bass, 'bass'),\n            mid: this.smoothAudioValue(mid, 'mid'), \n            high: this.smoothAudioValue(high, 'high'),\n            energy: (bass + mid + high) / 3,\n            rhythm: this.detectRhythm(bass),\n            melody: this.detectMelody(mid, high)\n        };\n        \n        this.audioData = smoothedAudio;\n        \n        // Apply NEW AUDIO REACTIVITY GRID SETTINGS if available\n        if (window.audioReactivitySettings) {\n            this.applyAudioReactivityGrid(smoothedAudio);\n        }\n        \n        // Apply audio reactivity to all visualizers\n        this.visualizers.forEach(visualizer => {\n            visualizer.updateAudio(this.audioData);\n        });\n    }\n    \n    smoothAudioValue(currentValue, type) {\n        if (!this.audioSmoothing) {\n            this.audioSmoothing = { bass: 0, mid: 0, high: 0 };\n        }\n        \n        const smoothingFactor = 0.4;\n        this.audioSmoothing[type] = this.audioSmoothing[type] * smoothingFactor + currentValue * (1 - smoothingFactor);\n        \n        const threshold = 0.05;\n        return this.audioSmoothing[type] > threshold ? this.audioSmoothing[type] : 0;\n    }\n    \n    detectRhythm(bassLevel) {\n        if (!this.previousBass) this.previousBass = 0;\n        const beatDetected = bassLevel > this.previousBass + 0.2;\n        this.previousBass = bassLevel;\n        return beatDetected ? 1.0 : 0.0;\n    }\n    \n    detectMelody(midLevel, highLevel) {\n        const melodicActivity = (midLevel + highLevel) / 2;\n        return melodicActivity > 0.3 ? melodicActivity : 0.0;\n    }\n    \n    applyAudioReactivityGrid(audioData) {\n        const settings = window.audioReactivitySettings;\n        if (!settings || settings.activeVisualModes.size === 0) return;\n        \n        // Get sensitivity multiplier\n        const sensitivityMultiplier = settings.sensitivity[settings.activeSensitivity];\n        \n        // Apply audio changes to different visual modes\n        settings.activeVisualModes.forEach(modeKey => {\n            const [sensitivity, visualMode] = modeKey.split('-');\n            const paramList = settings.visualModes[visualMode];\n            \n            if (!paramList) return;\n            \n            // Calculate audio intensity with sensitivity\n            const audioIntensity = (audioData.energy * sensitivityMultiplier);\n            const bassIntensity = (audioData.bass * sensitivityMultiplier);\n            const rhythmIntensity = (audioData.rhythm * sensitivityMultiplier);\n            \n            paramList.forEach(param => {\n                let currentValue = 0;\n                \n                switch (param) {\n                    case 'hue':\n                        // Color: Audio-reactive hue cycling\n                        if (!this.audioHueBase) this.audioHueBase = 320;\n                        this.audioHueBase += audioIntensity * 5; // Smooth color shifts\n                        currentValue = this.audioHueBase % 360;\n                        break;\n                        \n                    case 'saturation':\n                        // Color: Beat-responsive saturation\n                        currentValue = Math.min(1.0, 0.6 + (rhythmIntensity * 0.4));\n                        break;\n                        \n                    case 'intensity':\n                        // Color: Energy-responsive brightness\n                        currentValue = Math.min(1.0, 0.4 + (audioIntensity * 0.6));\n                        break;\n                        \n                    case 'morphFactor':\n                        // Geometry: Audio-morphing shapes\n                        currentValue = Math.min(2.0, 1.0 + (bassIntensity * 1.0));\n                        break;\n                        \n                    case 'gridDensity':\n                        // Geometry: Beat-responsive density\n                        currentValue = Math.min(100, 15 + (rhythmIntensity * 50));\n                        break;\n                        \n                    case 'chaos':\n                        // Geometry: Energy-chaos correlation\n                        currentValue = Math.min(1.0, audioIntensity * 0.8);\n                        break;\n                        \n                    case 'speed':\n                        // Movement: Tempo-responsive animation\n                        currentValue = Math.min(3.0, 1.0 + (audioIntensity * 2.0));\n                        break;\n                        \n                    case 'rot4dXW':\n                        // Movement: Bass-driven rotation\n                        if (!this.audioRotationXW) this.audioRotationXW = 0;\n                        this.audioRotationXW += bassIntensity * 0.1;\n                        currentValue = this.audioRotationXW % (Math.PI * 2);\n                        break;\n                        \n                    case 'rot4dYW':\n                        // Movement: Mid-frequency rotation\n                        if (!this.audioRotationYW) this.audioRotationYW = 0;\n                        this.audioRotationYW += audioData.mid * sensitivityMultiplier * 0.08;\n                        currentValue = this.audioRotationYW % (Math.PI * 2);\n                        break;\n                        \n                    case 'rot4dZW':\n                        // Movement: High-frequency rotation  \n                        if (!this.audioRotationZW) this.audioRotationZW = 0;\n                        this.audioRotationZW += audioData.high * sensitivityMultiplier * 0.06;\n                        currentValue = this.audioRotationZW % (Math.PI * 2);\n                        break;\n                }\n                \n                // Apply the parameter change\n                if (window.updateParameter && currentValue !== undefined) {\n                    window.updateParameter(param, currentValue.toFixed(2));\n                }\n            });\n        });\n    }\n    \n    setupCenterDistanceReactivity() {\n        // AUDIO ONLY - No mouse/touch/scroll interference\n        // Holographic system is purely audio-reactive now\n        console.log('‚ú® Holographic system: AUDIO-ONLY mode (no mouse/touch reactivity)');\n\n        if (this.canvasOverride) {\n            console.log('‚ú® Holographic reactivity skipped (single-canvas override mode)');\n            return;\n        }\n\n        // If ReactivityManager is active, it handles all interactivity\n        if (!this.useBuiltInReactivity) {\n            console.log('‚ú® Holographic built-in reactivity DISABLED - ReactivityManager active');\n            return;\n        }\n\n        // NO EVENT LISTENERS - Audio reactivity only\n        console.log('üéµ Holographic system will respond to audio input only');\n    }\n    \n    updateHolographicShimmer(x, y) {\n        // HOLOGRAPHIC TRADING CARD SHIMMER EFFECTS\n        // Calculate position-based shimmer like real holographic cards\n        \n        // Create iridescent shimmer based on viewing angle (mouse position)\n        const angleX = (x - 0.5) * Math.PI; // -œÄ/2 to œÄ/2 \n        const angleY = (y - 0.5) * Math.PI;\n        \n        // Holographic rainbow shimmer - shifts through spectrum based on angle\n        const baseHue = 320; // Start with magenta-pink\n        const shimmerRange = 120; // Cover 120 degrees of spectrum\n        const hueShimmer = Math.sin(angleX * 2) * Math.cos(angleY * 2) * shimmerRange;\n        const shimmerHue = (baseHue + hueShimmer + 360) % 360;\n        \n        // Iridescent intensity - varies with viewing angle like real holograms\n        const shimmerIntensity = 0.4 + (0.5 * Math.abs(Math.sin(angleX) * Math.cos(angleY)));\n        \n        // Holographic saturation pulse - high saturation for vivid colors\n        const saturationPulse = 0.7 + (0.3 * Math.abs(Math.cos(angleX * 1.5) * Math.sin(angleY * 1.5)));\n        \n        // Subtle depth illusion - slight morph based on angle (much more subtle than faceted)\n        const depthMorph = 1.0 + (0.15 * Math.sin(angleX * 0.8) * Math.cos(angleY * 0.8));\n        \n        // Update holographic shimmer parameters\n        if (window.updateParameter) {\n            window.updateParameter('hue', Math.round(shimmerHue));\n            window.updateParameter('intensity', shimmerIntensity.toFixed(2));\n            window.updateParameter('saturation', saturationPulse.toFixed(2));\n            window.updateParameter('morphFactor', depthMorph.toFixed(2));\n        }\n        \n        // Holographic shimmer updated\n    }\n    \n    triggerHolographicColorBurst(x, y) {\n        // DRAMATIC HOLOGRAPHIC COLOR BURST (like Quantum's dramatic click effects)\n        \n        // Calculate energy based on click position \n        const centerX = 0.5;\n        const centerY = 0.5;\n        const distanceFromCenter = Math.sqrt((x - centerX) ** 2 + (y - centerY) ** 2);\n        const normalizedDistance = Math.min(distanceFromCenter / 0.707, 1.0);\n        \n        // QUANTUM-STYLE DRAMATIC EFFECTS\n        this.colorBurstIntensity = 1.0; // Full burst intensity\n        \n        // Multi-parameter dramatic effects that decay back\n        this.burstHueShift = 180; // Dramatic hue shift across spectrum\n        this.burstIntensityBoost = 0.7; // Major intensity boost\n        this.burstSaturationSpike = 0.8; // Vivid color spike\n        this.burstChaosEffect = 0.6; // Chaos/morph burst effect\n        this.burstSpeedBoost = 1.8; // Animation speed burst\n        \n        // Holographic color burst triggered\n    }\n\n    startHolographicColorBurstLoop() {\n        this._burstLoopActive = true;\n        const burstAnimation = () => {\n            if (!this._burstLoopActive) return;\n            // DRAMATIC HOLOGRAPHIC COLOR BURST ANIMATION (like Quantum's multi-parameter effects)\n            let hasActiveEffects = false;\n            \n            if (this.colorBurstIntensity > 0.01) {\n                hasActiveEffects = true;\n                \n                // Phase-based burst animation with color cycling\n                const burstPhase = this.colorBurstIntensity;\n                \n                // HUE BURST: Cycle through rainbow spectrum\n                if (this.burstHueShift > 1) {\n                    const baseHue = 320; // Holographic magenta base\n                    const currentHueShift = this.burstHueShift * Math.sin(burstPhase * Math.PI * 2);\n                    const burstHue = (baseHue + currentHueShift) % 360;\n                    \n                    if (window.updateParameter) {\n                        window.updateParameter('hue', Math.round(burstHue));\n                    }\n                    this.burstHueShift *= 0.93; // Smooth decay\n                }\n                \n                // INTENSITY BURST: Dramatic brightness flash\n                if (this.burstIntensityBoost > 0.01) {\n                    const baseIntensity = 0.5;\n                    const burstIntensity = Math.min(1.0, baseIntensity + this.burstIntensityBoost * burstPhase);\n                    \n                    if (window.updateParameter) {\n                        window.updateParameter('intensity', burstIntensity.toFixed(2));\n                    }\n                    this.burstIntensityBoost *= 0.92;\n                }\n                \n                // SATURATION SPIKE: Vivid color explosion\n                if (this.burstSaturationSpike > 0.01) {\n                    const baseSaturation = 0.8;\n                    const burstSaturation = Math.min(1.0, baseSaturation + this.burstSaturationSpike * burstPhase);\n                    \n                    if (window.updateParameter) {\n                        window.updateParameter('saturation', burstSaturation.toFixed(2));\n                    }\n                    this.burstSaturationSpike *= 0.91;\n                }\n                \n                // CHAOS/MORPH EFFECT: Geometric distortion burst\n                if (this.burstChaosEffect > 0.01) {\n                    const baseChaos = 0.2;\n                    const burstChaos = baseChaos + this.burstChaosEffect * burstPhase;\n                    \n                    if (window.updateParameter) {\n                        window.updateParameter('chaos', burstChaos.toFixed(2));\n                    }\n                    this.burstChaosEffect *= 0.90;\n                }\n                \n                // SPEED BOOST: Animation acceleration\n                if (this.burstSpeedBoost > 0.01) {\n                    const baseSpeed = 1.0;\n                    const burstSpeed = baseSpeed + this.burstSpeedBoost * burstPhase;\n                    \n                    if (window.updateParameter) {\n                        window.updateParameter('speed', burstSpeed.toFixed(2));\n                    }\n                    this.burstSpeedBoost *= 0.89;\n                }\n                \n                // Master intensity decay\n                this.colorBurstIntensity *= 0.94;\n            }\n            \n            this._burstRafId = requestAnimationFrame(burstAnimation);\n        };\n\n        this._burstRafId = requestAnimationFrame(burstAnimation);\n    }\n    \n    startRenderLoop() {\n        this._renderLoopActive = true;\n        const render = () => {\n            if (!this._renderLoopActive) return;\n            if (this.isActive) {\n                // Update audio reactivity\n                this.updateAudio();\n\n                if (this._renderMode === 'bridge') {\n                    this._renderBridgeFrame();\n                } else {\n                    // Direct mode: render all visualizers\n                    this.visualizers.forEach(visualizer => {\n                        visualizer.render();\n                    });\n                }\n            }\n\n            this._renderRafId = requestAnimationFrame(render);\n        };\n\n        this._renderRafId = requestAnimationFrame(render);\n        console.log(`REAL Holographic render loop started (${this._renderMode} mode)`);\n    }\n    \n    getVariantName(variant = this.currentVariant) {\n        return this.variantNames[variant] || 'UNKNOWN';\n    }\n    \n    destroy() {\n        this.isActive = false;\n\n        // Cancel render loop\n        this._renderLoopActive = false;\n        if (this._renderRafId) {\n            cancelAnimationFrame(this._renderRafId);\n            this._renderRafId = null;\n        }\n\n        // Cancel burst effect loop\n        this._burstLoopActive = false;\n        if (this._burstRafId) {\n            cancelAnimationFrame(this._burstRafId);\n            this._burstRafId = null;\n        }\n\n        // Dispose bridge if active\n        if (this._multiCanvasBridge) {\n            this._multiCanvasBridge.dispose();\n            this._multiCanvasBridge = null;\n        }\n        this._renderMode = 'direct';\n\n        this.visualizers.forEach(visualizer => {\n            if (visualizer.destroy) {\n                visualizer.destroy();\n            }\n        });\n        this.visualizers = [];\n\n        if (this.audioContext) {\n            this.audioContext.close();\n        }\n\n        console.log('REAL Holographic System destroyed');\n    }\n\n    // ============================================\n    // RendererContract Compliance Methods\n    // ============================================\n\n    /**\n     * Initialize the renderer (RendererContract.init)\n     * For Holographic, initialization happens in constructor.\n     * This method allows re-initialization with a new context, including\n     * a canvas override for single-canvas multi-instance mode.\n     *\n     * @param {Object} [context] - Optional context\n     * @param {HTMLCanvasElement} [context.canvas] - Canvas element override\n     * @param {string} [context.canvasId] - Canvas ID to look up\n     * @returns {boolean} Success status\n     */\n    init(context = {}) {\n        const canvasEl = context.canvas ||\n            (context.canvasId ? document.getElementById(context.canvasId) : null);\n\n        if (canvasEl) {\n            this.canvasOverride = canvasEl;\n            // Tear down existing visualizers before re-init\n            this.visualizers.forEach(v => v.destroy && v.destroy());\n            this.visualizers = [];\n        }\n\n        // If already initialized (and no new canvas), just return success\n        if (this.visualizers.length > 0) {\n            return true;\n        }\n        // Otherwise initialize\n        this.initialize();\n        return this.visualizers.length > 0;\n    }\n\n    /**\n     * Handle canvas resize (RendererContract.resize)\n     * @param {number} width - New width in pixels\n     * @param {number} height - New height in pixels\n     * @param {number} [pixelRatio=1] - Device pixel ratio\n     */\n    resize(width, height, pixelRatio = 1) {\n        if (this._renderMode === 'bridge' && this._multiCanvasBridge) {\n            this._multiCanvasBridge.resizeAll(width, height, pixelRatio);\n        } else {\n            this.visualizers.forEach(visualizer => {\n                if (visualizer.canvas && visualizer.gl) {\n                    visualizer.canvas.width = width * pixelRatio;\n                    visualizer.canvas.height = height * pixelRatio;\n                    visualizer.canvas.style.width = `${width}px`;\n                    visualizer.canvas.style.height = `${height}px`;\n                    visualizer.gl.viewport(0, 0, visualizer.canvas.width, visualizer.canvas.height);\n                }\n            });\n        }\n        console.log(`üåå Holographic resized to ${width}x${height} @${pixelRatio}x`);\n    }\n\n    /**\n     * Render a single frame (RendererContract.render)\n     * @param {Object} [frameState] - Frame state with time, params, audio\n     */\n    render(frameState = {}) {\n        // Apply frameState parameters if provided\n        if (frameState.params) {\n            Object.keys(frameState.params).forEach(param => {\n                this.updateParameter(param, frameState.params[param]);\n            });\n        }\n\n        // Apply audio data if provided\n        if (frameState.audio) {\n            this.audioData = frameState.audio;\n        }\n\n        if (this._renderMode === 'bridge') {\n            this._renderBridgeFrame();\n        } else {\n            // Render all visualizers in direct mode\n            this.visualizers.forEach(visualizer => {\n                if (visualizer.render) {\n                    visualizer.render();\n                }\n            });\n        }\n    }\n\n    /**\n     * Get the current rendering backend type.\n     * @returns {'direct-webgl'|string}\n     */\n    getBackendType() {\n        if (this._renderMode === 'bridge' && this._multiCanvasBridge) {\n            return this._multiCanvasBridge.backendType || 'bridge';\n        }\n        return 'direct-webgl';\n    }\n\n    /**\n     * Clean up all resources (RendererContract.dispose)\n     * Alias for destroy() for contract compliance\n     */\n    dispose() {\n        // Disable audio first\n        this.disableAudio();\n\n        // Call existing destroy\n        this.destroy();\n    }\n}","/**\n * Faceted System - Clean 2D Geometric Patterns with 4D Rotation\n * Supports 24 geometry variants: 8 base + 8 Hypersphere Core + 8 Hypertetrahedron Core\n * Full 6D rotation mathematics (XY, XZ, YZ, XW, YW, ZW)\n *\n * Supports both WebGL (direct) and WebGPU (via UnifiedRenderBridge).\n */\n\nimport { UnifiedRenderBridge } from '../render/UnifiedRenderBridge.js';\nimport { shaderLoader } from '../render/ShaderLoader.js';\n\n// ============================================================================\n// Shader Sources\n// ============================================================================\n\nconst VERTEX_SHADER_GLSL = `\n    attribute vec2 a_position;\n    void main() {\n        gl_Position = vec4(a_position, 0.0, 1.0);\n    }\n`;\n\nconst FRAGMENT_SHADER_GLSL = `\n    precision highp float;\n\n    uniform float u_time;\n    uniform vec2 u_resolution;\n    uniform vec2 u_mouse;\n    uniform float u_geometry;      // 0-23\n\n    // 6D Rotation uniforms\n    uniform float u_rot4dXY;\n    uniform float u_rot4dXZ;\n    uniform float u_rot4dYZ;\n    uniform float u_rot4dXW;\n    uniform float u_rot4dYW;\n    uniform float u_rot4dZW;\n\n    uniform float u_dimension;\n    uniform float u_gridDensity;\n    uniform float u_morphFactor;\n    uniform float u_chaos;\n    uniform float u_speed;\n    uniform float u_hue;\n    uniform float u_intensity;\n    uniform float u_saturation;\n    uniform float u_mouseIntensity;\n    uniform float u_clickIntensity;\n    uniform float u_roleIntensity;\n    uniform float u_bass;\n    uniform float u_mid;\n    uniform float u_high;\n    uniform float u_breath; // Vitality System Breath (0.0 - 1.0)\n\n    // ‚îÄ‚îÄ 6D Rotation Matrices ‚îÄ‚îÄ\n\n    mat4 rotateXY(float theta) {\n        float c = cos(theta); float s = sin(theta);\n        return mat4(c, -s, 0, 0, s, c, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);\n    }\n    mat4 rotateXZ(float theta) {\n        float c = cos(theta); float s = sin(theta);\n        return mat4(c, 0, s, 0, 0, 1, 0, 0, -s, 0, c, 0, 0, 0, 0, 1);\n    }\n    mat4 rotateYZ(float theta) {\n        float c = cos(theta); float s = sin(theta);\n        return mat4(1, 0, 0, 0, 0, c, -s, 0, 0, s, c, 0, 0, 0, 0, 1);\n    }\n    mat4 rotateXW(float theta) {\n        float c = cos(theta); float s = sin(theta);\n        return mat4(c, 0, 0, -s, 0, 1, 0, 0, 0, 0, 1, 0, s, 0, 0, c);\n    }\n    mat4 rotateYW(float theta) {\n        float c = cos(theta); float s = sin(theta);\n        return mat4(1, 0, 0, 0, 0, c, 0, -s, 0, 0, 1, 0, 0, s, 0, c);\n    }\n    mat4 rotateZW(float theta) {\n        float c = cos(theta); float s = sin(theta);\n        return mat4(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, c, -s, 0, 0, s, c);\n    }\n\n    // ‚îÄ‚îÄ 4D ‚Üí 3D Projection ‚îÄ‚îÄ\n\n    vec3 project4Dto3D(vec4 p) {\n        float w = 2.5 / (2.5 + p.w);\n        return vec3(p.x * w, p.y * w, p.z * w);\n    }\n\n    // ‚îÄ‚îÄ Polytope Core Warp Functions (24 Geometries) ‚îÄ‚îÄ\n\n    vec3 warpHypersphereCore(vec3 p, int geometryIndex, vec2 mouseDelta) {\n        float radius = length(p);\n        float morphBlend = clamp(u_morphFactor * 0.6 + (u_dimension - 3.0) * 0.25, 0.0, 2.0);\n        float w = sin(radius * (1.3 + float(geometryIndex) * 0.12) + u_time * 0.0008 * u_speed);\n        w *= (0.4 + morphBlend * 0.45);\n\n        vec4 p4d = vec4(p * (1.0 + morphBlend * 0.2), w);\n        p4d = rotateXY(u_rot4dXY) * p4d;\n        p4d = rotateXZ(u_rot4dXZ) * p4d;\n        p4d = rotateYZ(u_rot4dYZ) * p4d;\n        p4d = rotateXW(u_rot4dXW) * p4d;\n        p4d = rotateYW(u_rot4dYW) * p4d;\n        p4d = rotateZW(u_rot4dZW) * p4d;\n\n        vec3 projected = project4Dto3D(p4d);\n        return mix(p, projected, clamp(0.45 + morphBlend * 0.35, 0.0, 1.0));\n    }\n\n    vec3 warpHypertetraCore(vec3 p, int geometryIndex, vec2 mouseDelta) {\n        vec3 c1 = normalize(vec3(1.0, 1.0, 1.0));\n        vec3 c2 = normalize(vec3(-1.0, -1.0, 1.0));\n        vec3 c3 = normalize(vec3(-1.0, 1.0, -1.0));\n        vec3 c4 = normalize(vec3(1.0, -1.0, -1.0));\n\n        float morphBlend = clamp(u_morphFactor * 0.8 + (u_dimension - 3.0) * 0.2, 0.0, 2.0);\n        float basisMix = dot(p, c1) * 0.14 + dot(p, c2) * 0.1 + dot(p, c3) * 0.08;\n        float w = sin(basisMix * 5.5 + u_time * 0.0009 * u_speed);\n        w *= cos(dot(p, c4) * 4.2 - u_time * 0.0007 * u_speed);\n        w *= (0.5 + morphBlend * 0.4);\n\n        vec3 offset = vec3(dot(p, c1), dot(p, c2), dot(p, c3)) * 0.1 * morphBlend;\n        vec4 p4d = vec4(p + offset, w);\n        p4d = rotateXY(u_rot4dXY) * p4d;\n        p4d = rotateXZ(u_rot4dXZ) * p4d;\n        p4d = rotateYZ(u_rot4dYZ) * p4d;\n        p4d = rotateXW(u_rot4dXW) * p4d;\n        p4d = rotateYW(u_rot4dYW) * p4d;\n        p4d = rotateZW(u_rot4dZW) * p4d;\n\n        vec3 projected = project4Dto3D(p4d);\n        float planeInfluence = min(min(abs(dot(p, c1)), abs(dot(p, c2))),\n                                   min(abs(dot(p, c3)), abs(dot(p, c4))));\n        vec3 blended = mix(p, projected, clamp(0.45 + morphBlend * 0.35, 0.0, 1.0));\n        return mix(blended, blended * (1.0 - planeInfluence * 0.55), 0.2 + morphBlend * 0.2);\n    }\n\n    vec3 applyCoreWarp(vec3 p, float geometryType, vec2 mouseDelta) {\n        float totalBase = 8.0;\n        float coreFloat = floor(geometryType / totalBase);\n        int coreIndex = int(clamp(coreFloat, 0.0, 2.0));\n        // WebGL 1.0 compatible modulus\n        float baseGeomFloat = geometryType - floor(geometryType / totalBase) * totalBase;\n        int geometryIndex = int(clamp(floor(baseGeomFloat + 0.5), 0.0, totalBase - 1.0));\n\n        if (coreIndex == 1) {\n            return warpHypersphereCore(p, geometryIndex, mouseDelta);\n        }\n        if (coreIndex == 2) {\n            return warpHypertetraCore(p, geometryIndex, mouseDelta);\n        }\n        return p;\n    }\n\n    // ‚îÄ‚îÄ 8 Lattice Geometry Functions ‚îÄ‚îÄ\n\n    float geometryFunction(vec4 p) {\n        float totalBase = 8.0;\n        // WebGL 1.0 compatible modulus\n        float baseGeomFloat = u_geometry - floor(u_geometry / totalBase) * totalBase;\n        int geomType = int(clamp(floor(baseGeomFloat + 0.5), 0.0, totalBase - 1.0));\n\n        if (geomType == 0) {\n            // Tetrahedron lattice ‚Äî tetrahedral symmetry planes\n            float d = u_gridDensity * 0.08;\n            vec3 c1 = normalize(vec3(1.0, 1.0, 1.0));\n            vec3 c2 = normalize(vec3(-1.0, -1.0, 1.0));\n            vec3 c3 = normalize(vec3(-1.0, 1.0, -1.0));\n            vec3 c4 = normalize(vec3(1.0, -1.0, -1.0));\n            vec3 q = fract(p.xyz * d + 0.5) - 0.5;\n            float minPlane = min(min(abs(dot(q, c1)), abs(dot(q, c2))),\n                                 min(abs(dot(q, c3)), abs(dot(q, c4))));\n            return (1.0 - smoothstep(0.0, 0.05, minPlane)) * u_morphFactor;\n        }\n        else if (geomType == 1) {\n            // Hypercube lattice\n            vec4 pos = fract(p * u_gridDensity * 0.08);\n            vec4 dist = min(pos, 1.0 - pos);\n            float minDist = min(min(dist.x, dist.y), min(dist.z, dist.w));\n            return minDist * u_morphFactor;\n        }\n        else if (geomType == 2) {\n            // Sphere lattice\n            float r = length(p);\n            float density = u_gridDensity * 0.08;\n            float spheres = abs(fract(r * density) - 0.5) * 2.0;\n            float theta = atan(p.y, p.x);\n            float harmonics = sin(theta * 3.0) * 0.2;\n            return (spheres + harmonics) * u_morphFactor;\n        }\n        else if (geomType == 3) {\n            // Torus lattice\n            float r1 = length(p.xy) - 2.0;\n            float torus = length(vec2(r1, p.z)) - 0.8;\n            float lattice = sin(p.x * u_gridDensity * 0.08) * sin(p.y * u_gridDensity * 0.08);\n            return (torus + lattice * 0.3) * u_morphFactor;\n        }\n        else if (geomType == 4) {\n            // Klein bottle lattice\n            float u_ang = atan(p.y, p.x);\n            float v_ang = atan(p.w, p.z);\n            float dist = length(p) - 2.0;\n            float lattice = sin(u_ang * u_gridDensity * 0.08) * sin(v_ang * u_gridDensity * 0.08);\n            return (dist + lattice * 0.4) * u_morphFactor;\n        }\n        else if (geomType == 5) {\n            // Fractal lattice\n            vec4 pos = fract(p * u_gridDensity * 0.08);\n            pos = abs(pos * 2.0 - 1.0);\n            float dist = length(max(abs(pos) - 1.0, 0.0));\n            return dist * u_morphFactor;\n        }\n        else if (geomType == 6) {\n            // Wave lattice\n            float freq = u_gridDensity * 0.08;\n            float time = u_time * 0.001 * u_speed;\n            float wave1 = sin(p.x * freq + time);\n            float wave2 = sin(p.y * freq + time * 1.3);\n            float wave3 = sin(p.z * freq * 0.8 + time * 0.7);\n            float interference = wave1 * wave2 * wave3;\n            return interference * u_morphFactor;\n        }\n        else if (geomType == 7) {\n            // Crystal lattice\n            vec4 pos = fract(p * u_gridDensity * 0.08) - 0.5;\n            float cube = max(max(abs(pos.x), abs(pos.y)), max(abs(pos.z), abs(pos.w)));\n            return cube * u_morphFactor;\n        }\n        else {\n            // Default hypercube\n            vec4 pos = fract(p * u_gridDensity * 0.08);\n            vec4 dist = min(pos, 1.0 - pos);\n            return min(min(dist.x, dist.y), min(dist.z, dist.w)) * u_morphFactor;\n        }\n    }\n\n    // ‚îÄ‚îÄ Main ‚îÄ‚îÄ\n\n    void main() {\n        vec2 uv = (gl_FragCoord.xy - u_resolution.xy * 0.5) / min(u_resolution.x, u_resolution.y);\n        float timeSpeed = u_time * 0.0001 * u_speed;\n\n        // Create 4D point\n        vec4 pos = vec4(uv * 3.0, sin(timeSpeed * 3.0), cos(timeSpeed * 2.0));\n\n        // Mouse influence\n        pos.xy += (u_mouse - 0.5) * u_mouseIntensity * 2.0;\n\n        // Audio-reactive density and morph\n        float audioDensityMod = 1.0 + u_bass * 0.3;\n        float audioMorphMod = 1.0 + u_mid * 0.2;\n\n        // Apply full 6D rotation\n        pos = rotateXY(u_rot4dXY) * pos;\n        pos = rotateXZ(u_rot4dXZ) * pos;\n        pos = rotateYZ(u_rot4dYZ) * pos;\n        pos = rotateXW(u_rot4dXW) * pos;\n        pos = rotateYW(u_rot4dYW) * pos;\n        pos = rotateZW(u_rot4dZW) * pos;\n\n        // 4D ‚Üí 3D projection\n        vec3 basePoint = project4Dto3D(pos);\n\n        // Apply polytope core warp (types 8-23)\n        vec3 warpedPoint = applyCoreWarp(basePoint, u_geometry, u_mouse - 0.5);\n\n        // Evaluate lattice geometry\n        vec4 warpedPos = vec4(warpedPoint, pos.w);\n        float value = geometryFunction(warpedPos);\n\n        // Chaos noise\n        float noise = sin(pos.x * 7.0) * cos(pos.y * 11.0) * sin(pos.z * 13.0);\n        value += noise * u_chaos;\n\n        // Intensity from lattice\n        float geometryIntensity = 1.0 - clamp(abs(value), 0.0, 1.0);\n        geometryIntensity += u_clickIntensity * 0.3;\n\n        // Exhale: Vitality Breath Modulation\n        float breathMod = 1.0 + (u_breath * 0.3); // +30% intensity at full breath\n\n        float finalIntensity = geometryIntensity * u_intensity * breathMod;\n\n        // Audio-reactive hue shift\n        float hue = u_hue / 360.0 + value * 0.1 + u_high * 0.08;\n\n        // Color via sin-wave HSL\n        vec3 baseColor = vec3(\n            sin(hue * 6.28318 + 0.0) * 0.5 + 0.5,\n            sin(hue * 6.28318 + 2.0943) * 0.5 + 0.5,\n            sin(hue * 6.28318 + 4.1887) * 0.5 + 0.5\n        );\n\n        // Saturation control (mix to gray)\n        float gray = (baseColor.r + baseColor.g + baseColor.b) / 3.0;\n        vec3 color = mix(vec3(gray), baseColor, u_saturation) * finalIntensity;\n\n        gl_FragColor = vec4(color, finalIntensity);\n    }\n`;\n\n// WGSL version of the faceted fragment shader for WebGPU\nconst FRAGMENT_SHADER_WGSL = `\nstruct VIB3Uniforms {\n    time: f32,\n    _pad0: f32,\n    resolution: vec2<f32>,\n    geometry: f32,\n    rot4dXY: f32,\n    rot4dXZ: f32,\n    rot4dYZ: f32,\n    rot4dXW: f32,\n    rot4dYW: f32,\n    rot4dZW: f32,\n    dimension: f32,\n    gridDensity: f32,\n    morphFactor: f32,\n    chaos: f32,\n    speed: f32,\n    hue: f32,\n    intensity: f32,\n    saturation: f32,\n    mouseIntensity: f32,\n    clickIntensity: f32,\n    bass: f32,\n    mid: f32,\n    high: f32,\n    layerScale: f32,\n    layerOpacity: f32,\n    _pad1: f32,\n    layerColorR: f32,\n    layerColorG: f32,\n    layerColorB: f32,\n    densityMult: f32,\n    speedMult: f32,\n    breath: f32, // Index 32\n};\n\n@group(0) @binding(0) var<uniform> u: VIB3Uniforms;\n\nfn rotateXY_w(theta: f32) -> mat4x4<f32> {\n    let c = cos(theta); let s = sin(theta);\n    return mat4x4<f32>(\n        vec4<f32>(c, -s, 0.0, 0.0), vec4<f32>(s, c, 0.0, 0.0),\n        vec4<f32>(0.0, 0.0, 1.0, 0.0), vec4<f32>(0.0, 0.0, 0.0, 1.0));\n}\nfn rotateXZ_w(theta: f32) -> mat4x4<f32> {\n    let c = cos(theta); let s = sin(theta);\n    return mat4x4<f32>(\n        vec4<f32>(c, 0.0, s, 0.0), vec4<f32>(0.0, 1.0, 0.0, 0.0),\n        vec4<f32>(-s, 0.0, c, 0.0), vec4<f32>(0.0, 0.0, 0.0, 1.0));\n}\nfn rotateYZ_w(theta: f32) -> mat4x4<f32> {\n    let c = cos(theta); let s = sin(theta);\n    return mat4x4<f32>(\n        vec4<f32>(1.0, 0.0, 0.0, 0.0), vec4<f32>(0.0, c, -s, 0.0),\n        vec4<f32>(0.0, s, c, 0.0), vec4<f32>(0.0, 0.0, 0.0, 1.0));\n}\nfn rotateXW_w(theta: f32) -> mat4x4<f32> {\n    let c = cos(theta); let s = sin(theta);\n    return mat4x4<f32>(\n        vec4<f32>(c, 0.0, 0.0, -s), vec4<f32>(0.0, 1.0, 0.0, 0.0),\n        vec4<f32>(0.0, 0.0, 1.0, 0.0), vec4<f32>(s, 0.0, 0.0, c));\n}\nfn rotateYW_w(theta: f32) -> mat4x4<f32> {\n    let c = cos(theta); let s = sin(theta);\n    return mat4x4<f32>(\n        vec4<f32>(1.0, 0.0, 0.0, 0.0), vec4<f32>(0.0, c, 0.0, -s),\n        vec4<f32>(0.0, 0.0, 1.0, 0.0), vec4<f32>(0.0, s, 0.0, c));\n}\nfn rotateZW_w(theta: f32) -> mat4x4<f32> {\n    let c = cos(theta); let s = sin(theta);\n    return mat4x4<f32>(\n        vec4<f32>(1.0, 0.0, 0.0, 0.0), vec4<f32>(0.0, 1.0, 0.0, 0.0),\n        vec4<f32>(0.0, 0.0, c, -s), vec4<f32>(0.0, 0.0, s, c));\n}\n\nfn project4Dto3D_w(p: vec4<f32>) -> vec3<f32> {\n    let w = 2.5 / (2.5 + p.w);\n    return vec3<f32>(p.x * w, p.y * w, p.z * w);\n}\n\nfn warpHypersphereCore_w(p: vec3<f32>, geomIdx: i32) -> vec3<f32> {\n    let radius = length(p);\n    let morphBlend = clamp(u.morphFactor * 0.6 + (u.dimension - 3.0) * 0.25, 0.0, 2.0);\n    let w = sin(radius * (1.3 + f32(geomIdx) * 0.12) + u.time * 0.0008 * u.speed)\n          * (0.4 + morphBlend * 0.45);\n    var p4d = vec4<f32>(p * (1.0 + morphBlend * 0.2), w);\n    p4d = rotateXY_w(u.rot4dXY) * p4d;\n    p4d = rotateXZ_w(u.rot4dXZ) * p4d;\n    p4d = rotateYZ_w(u.rot4dYZ) * p4d;\n    p4d = rotateXW_w(u.rot4dXW) * p4d;\n    p4d = rotateYW_w(u.rot4dYW) * p4d;\n    p4d = rotateZW_w(u.rot4dZW) * p4d;\n    let proj = project4Dto3D_w(p4d);\n    return mix(p, proj, clamp(0.45 + morphBlend * 0.35, 0.0, 1.0));\n}\n\nfn warpHypertetraCore_w(p: vec3<f32>, geomIdx: i32) -> vec3<f32> {\n    let c1 = normalize(vec3<f32>(1.0, 1.0, 1.0));\n    let c2 = normalize(vec3<f32>(-1.0, -1.0, 1.0));\n    let c3 = normalize(vec3<f32>(-1.0, 1.0, -1.0));\n    let c4 = normalize(vec3<f32>(1.0, -1.0, -1.0));\n    let morphBlend = clamp(u.morphFactor * 0.8 + (u.dimension - 3.0) * 0.2, 0.0, 2.0);\n    let basisMix = dot(p, c1) * 0.14 + dot(p, c2) * 0.1 + dot(p, c3) * 0.08;\n    let w = sin(basisMix * 5.5 + u.time * 0.0009 * u.speed)\n          * cos(dot(p, c4) * 4.2 - u.time * 0.0007 * u.speed)\n          * (0.5 + morphBlend * 0.4);\n    let offset = vec3<f32>(dot(p, c1), dot(p, c2), dot(p, c3)) * 0.1 * morphBlend;\n    var p4d = vec4<f32>(p + offset, w);\n    p4d = rotateXY_w(u.rot4dXY) * p4d;\n    p4d = rotateXZ_w(u.rot4dXZ) * p4d;\n    p4d = rotateYZ_w(u.rot4dYZ) * p4d;\n    p4d = rotateXW_w(u.rot4dXW) * p4d;\n    p4d = rotateYW_w(u.rot4dYW) * p4d;\n    p4d = rotateZW_w(u.rot4dZW) * p4d;\n    let proj = project4Dto3D_w(p4d);\n    let planeInf = min(min(abs(dot(p, c1)), abs(dot(p, c2))),\n                       min(abs(dot(p, c3)), abs(dot(p, c4))));\n    let blended = mix(p, proj, clamp(0.45 + morphBlend * 0.35, 0.0, 1.0));\n    return mix(blended, blended * (1.0 - planeInf * 0.55), 0.2 + morphBlend * 0.2);\n}\n\nfn applyCoreWarp_w(p: vec3<f32>, geomType: f32, mouseDelta: vec2<f32>) -> vec3<f32> {\n    let coreFloat = floor(geomType / 8.0);\n    let coreIndex = i32(clamp(coreFloat, 0.0, 2.0));\n    let baseFloat = geomType - floor(geomType / 8.0) * 8.0;\n    let geomIdx = i32(clamp(floor(baseFloat + 0.5), 0.0, 7.0));\n    if (coreIndex == 1) { return warpHypersphereCore_w(p, geomIdx); }\n    if (coreIndex == 2) { return warpHypertetraCore_w(p, geomIdx); }\n    return p;\n}\n\nfn geometryFunction_w(p: vec4<f32>) -> f32 {\n    let baseFloat = u.geometry - floor(u.geometry / 8.0) * 8.0;\n    let gt = i32(clamp(floor(baseFloat + 0.5), 0.0, 7.0));\n    let d = u.gridDensity * 0.08;\n    if (gt == 0) {\n        // Tetrahedron ‚Äî tetrahedral symmetry planes\n        let c1 = normalize(vec3<f32>(1.0, 1.0, 1.0));\n        let c2 = normalize(vec3<f32>(-1.0, -1.0, 1.0));\n        let c3 = normalize(vec3<f32>(-1.0, 1.0, -1.0));\n        let c4 = normalize(vec3<f32>(1.0, -1.0, -1.0));\n        let q = fract(p.xyz * d + 0.5) - 0.5;\n        let minPlane = min(min(abs(dot(q, c1)), abs(dot(q, c2))),\n                           min(abs(dot(q, c3)), abs(dot(q, c4))));\n        return (1.0 - smoothstep(0.0, 0.05, minPlane)) * u.morphFactor;\n    } else if (gt == 1) {\n        let pos = fract(p * d); let dist = min(pos, 1.0 - pos);\n        return min(min(dist.x, dist.y), min(dist.z, dist.w)) * u.morphFactor;\n    } else if (gt == 2) {\n        let r = length(p); let sph = abs(fract(r * d) - 0.5) * 2.0;\n        let harm = sin(atan2(p.y, p.x) * 3.0) * 0.2;\n        return (sph + harm) * u.morphFactor;\n    } else if (gt == 3) {\n        let r1 = length(p.xy) - 2.0; let tor = length(vec2<f32>(r1, p.z)) - 0.8;\n        let lat = sin(p.x * d) * sin(p.y * d);\n        return (tor + lat * 0.3) * u.morphFactor;\n    } else if (gt == 4) {\n        let ua = atan2(p.y, p.x); let va = atan2(p.w, p.z);\n        let dist = length(p) - 2.0; let lat = sin(ua * d) * sin(va * d);\n        return (dist + lat * 0.4) * u.morphFactor;\n    } else if (gt == 5) {\n        var pos = fract(p * d); pos = abs(pos * 2.0 - 1.0);\n        return length(max(abs(pos) - 1.0, vec4<f32>(0.0))) * u.morphFactor;\n    } else if (gt == 6) {\n        let t = u.time * 0.001 * u.speed;\n        return sin(p.x * d + t) * sin(p.y * d + t * 1.3) * sin(p.z * d * 0.8 + t * 0.7) * u.morphFactor;\n    } else {\n        let pos = fract(p * d) - 0.5;\n        return max(max(abs(pos.x), abs(pos.y)), max(abs(pos.z), abs(pos.w))) * u.morphFactor;\n    }\n}\n\nstruct VertexOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv: vec2<f32>,\n};\n\n@fragment\nfn main(input: VertexOutput) -> @location(0) vec4<f32> {\n    let fragCoord = input.position.xy;\n    let uv2 = (fragCoord - u.resolution * 0.5) / min(u.resolution.x, u.resolution.y);\n    let timeSpeed = u.time * 0.0001 * u.speed;\n\n    var pos = vec4<f32>(uv2 * 3.0, sin(timeSpeed * 3.0), cos(timeSpeed * 2.0));\n    pos = vec4<f32>(pos.xy + (vec2<f32>(0.5, 0.5) - 0.5) * u.mouseIntensity * 2.0, pos.z, pos.w);\n\n    pos = rotateXY_w(u.rot4dXY) * pos;\n    pos = rotateXZ_w(u.rot4dXZ) * pos;\n    pos = rotateYZ_w(u.rot4dYZ) * pos;\n    pos = rotateXW_w(u.rot4dXW) * pos;\n    pos = rotateYW_w(u.rot4dYW) * pos;\n    pos = rotateZW_w(u.rot4dZW) * pos;\n\n    let basePoint = project4Dto3D_w(pos);\n    let warpedPoint = applyCoreWarp_w(basePoint, u.geometry, vec2<f32>(0.0, 0.0));\n    let warpedPos = vec4<f32>(warpedPoint, pos.w);\n    var value = geometryFunction_w(warpedPos);\n\n    let noise = sin(pos.x * 7.0) * cos(pos.y * 11.0) * sin(pos.z * 13.0);\n    value += noise * u.chaos;\n\n    var geomIntensity = 1.0 - clamp(abs(value), 0.0, 1.0);\n    geomIntensity += u.clickIntensity * 0.3;\n\n    // Vitality (Breath) modulation\n    let breathMod = 1.0 + (u.breath * 0.3);\n    let finalIntensity = geomIntensity * u.intensity * breathMod;\n\n    let hueVal = u.hue / 360.0 + value * 0.1 + u.high * 0.08;\n    let baseColor = vec3<f32>(\n        sin(hueVal * 6.28318 + 0.0) * 0.5 + 0.5,\n        sin(hueVal * 6.28318 + 2.0943) * 0.5 + 0.5,\n        sin(hueVal * 6.28318 + 4.1887) * 0.5 + 0.5);\n    let gray = (baseColor.r + baseColor.g + baseColor.b) / 3.0;\n    let color = mix(vec3<f32>(gray), baseColor, u.saturation) * finalIntensity;\n\n    return vec4<f32>(color, finalIntensity);\n}\n`;\n\n// ============================================================================\n// FacetedSystem Class\n// ============================================================================\n\nexport class FacetedSystem {\n    constructor() {\n        this.bridge = null;\n        this.canvas = null;\n        this.gl = null;\n        this.program = null;\n        this.params = {};\n        this.initialized = false;\n        this.contextLost = false;\n        this._animFrame = null;\n        this._time = 0;\n        this._running = false;\n        this._quadBuffer = null;\n        this._uniformLocations = {};\n        this._useDirectGL = false;\n    }\n\n    // ‚îÄ‚îÄ‚îÄ Synchronous Direct WebGL Init (matches Quantum/Holographic pattern) ‚îÄ‚îÄ‚îÄ\n\n    /**\n     * Initialize directly with WebGL on a given canvas.\n     * Synchronous ‚Äî no async bridge, no WebGPU.\n     * This is the preferred path for the landing page and adapters.\n     */\n    initDirect(canvas) {\n        this.canvas = canvas;\n        try {\n            this.gl = canvas.getContext('webgl2') || canvas.getContext('webgl');\n        } catch (e) {\n            console.warn('FacetedSystem: WebGL context creation failed', e);\n            return false;\n        }\n        if (!this.gl) {\n            console.warn('FacetedSystem: WebGL not available');\n            return false;\n        }\n\n        // Compile shader program\n        this.program = this._compileProgram(this.gl, VERTEX_SHADER_GLSL, FRAGMENT_SHADER_GLSL);\n        if (!this.program) {\n            console.error('FacetedSystem: Shader compilation failed');\n            return false;\n        }\n\n        // Create fullscreen quad buffer\n        const vertices = new Float32Array([-1,-1, 1,-1, -1,1, -1,1, 1,-1, 1,1]);\n        this._quadBuffer = this.gl.createBuffer();\n        this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this._quadBuffer);\n        this.gl.bufferData(this.gl.ARRAY_BUFFER, vertices, this.gl.STATIC_DRAW);\n\n        // Cache uniform locations\n        const gl = this.gl;\n        const numUniforms = gl.getProgramParameter(this.program, gl.ACTIVE_UNIFORMS);\n        for (let i = 0; i < numUniforms; i++) {\n            const info = gl.getActiveUniform(this.program, i);\n            if (info) {\n                this._uniformLocations[info.name] = gl.getUniformLocation(this.program, info.name);\n            }\n        }\n\n        this._useDirectGL = true;\n        this.initialized = true;\n        this.start();\n        return true;\n    }\n\n    _compileProgram(gl, vertexSrc, fragmentSrc) {\n        const vs = this._compileShader(gl, gl.VERTEX_SHADER, vertexSrc);\n        const fs = this._compileShader(gl, gl.FRAGMENT_SHADER, fragmentSrc);\n        if (!vs || !fs) return null;\n\n        const program = gl.createProgram();\n        gl.attachShader(program, vs);\n        gl.attachShader(program, fs);\n        gl.linkProgram(program);\n\n        if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n            console.error('FacetedSystem link error:', gl.getProgramInfoLog(program));\n            return null;\n        }\n\n        gl.deleteShader(vs);\n        gl.deleteShader(fs);\n        return program;\n    }\n\n    _compileShader(gl, type, source) {\n        const shader = gl.createShader(type);\n        gl.shaderSource(shader, source);\n        gl.compileShader(shader);\n        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n            console.error('FacetedSystem shader error:', gl.getShaderInfoLog(shader));\n            gl.deleteShader(shader);\n            return null;\n        }\n        return shader;\n    }\n\n    // ‚îÄ‚îÄ‚îÄ Async Bridge Init (for SDK/WebGPU usage) ‚îÄ‚îÄ‚îÄ\n\n    async initWithBridge(canvas, options) {\n        this.canvas = canvas;\n        try {\n            this.bridge = await UnifiedRenderBridge.create(canvas, options);\n            if (this.bridge) {\n                const success = this.bridge.compileShader('faceted', {\n                    glslVertex: VERTEX_SHADER_GLSL,\n                    glslFragment: FRAGMENT_SHADER_GLSL,\n                    wgslFragment: FRAGMENT_SHADER_WGSL\n                });\n                if (!success) {\n                    console.error(\"Faceted shader compilation failed\");\n                    return false;\n                }\n                this.initialized = true;\n                this.start();\n                return true;\n            }\n        } catch (e) {\n            console.error(\"Faceted initWithBridge failed:\", e);\n        }\n        return false;\n    }\n\n    async initialize(options = {}) {\n        if (this.initialized) return true;\n        const canvas = options.canvas ||\n                      document.getElementById('faceted-content-canvas') ||\n                      document.getElementById('content-canvas');\n        if (!canvas) {\n            console.warn(\"FacetedSystem: No canvas found for initialize()\");\n            return false;\n        }\n        return this.initWithBridge(canvas, {\n            preferWebGPU: options.preferWebGPU !== undefined ? options.preferWebGPU : true,\n            debug: options.debug || false\n        });\n    }\n\n    // ‚îÄ‚îÄ‚îÄ Parameters ‚îÄ‚îÄ‚îÄ\n\n    updateParameters(params) {\n        if (!params) return;\n        this.params = { ...this.params, ...params };\n    }\n\n    /**\n     * Build the uniform object with proper u_ prefixed names for the shader.\n     */\n    _buildUniforms() {\n        const p = this.params;\n        return {\n            u_time: this._time,\n            u_resolution: [this.canvas?.width || 800, this.canvas?.height || 600],\n            u_geometry: p.geometry ?? 0,\n            u_rot4dXY: p.rot4dXY ?? 0,\n            u_rot4dXZ: p.rot4dXZ ?? 0,\n            u_rot4dYZ: p.rot4dYZ ?? 0,\n            u_rot4dXW: p.rot4dXW ?? 0,\n            u_rot4dYW: p.rot4dYW ?? 0,\n            u_rot4dZW: p.rot4dZW ?? 0,\n            u_dimension: p.dimension ?? 3.5,\n            u_gridDensity: p.gridDensity ?? 15,\n            u_morphFactor: p.morphFactor ?? 1.0,\n            u_chaos: p.chaos ?? 0.2,\n            u_speed: p.speed ?? 1.0,\n            u_hue: p.hue ?? 200,\n            u_intensity: p.intensity ?? 0.7,\n            u_saturation: p.saturation ?? 0.8,\n            u_mouseIntensity: p.mouseIntensity ?? 0,\n            u_clickIntensity: p.clickIntensity ?? 0,\n            u_bass: p.bass ?? 0,\n            u_mid: p.mid ?? 0,\n            u_high: p.high ?? 0,\n            u_breath: p.breath ?? 0,\n            u_mouse: p.mouse ?? [0.5, 0.5],\n        };\n    }\n\n    // ‚îÄ‚îÄ‚îÄ Render Loop ‚îÄ‚îÄ‚îÄ\n\n    start() {\n        if (this._running) return;\n        this._running = true;\n        this._renderLoop();\n    }\n\n    stop() {\n        this._running = false;\n        if (this._animFrame) {\n            cancelAnimationFrame(this._animFrame);\n            this._animFrame = null;\n        }\n    }\n\n    _renderLoop() {\n        if (!this._running) return;\n\n        this._time += 16.0 * (this.params.speed ?? 1.0);\n\n        if (this._useDirectGL) {\n            this._renderDirectGL();\n        } else if (this.bridge) {\n            this.bridge.setUniforms(this._buildUniforms());\n            this.bridge.render('faceted', { clear: true, clearColor: [0, 0, 0, 1] });\n        }\n\n        this._animFrame = requestAnimationFrame(() => this._renderLoop());\n    }\n\n    /**\n     * Direct WebGL rendering ‚Äî no bridge, just raw GL calls.\n     * Matches the original working FacetedSystem pattern.\n     */\n    _renderDirectGL() {\n        const gl = this.gl;\n        if (!gl || !this.program) return;\n\n        gl.useProgram(this.program);\n        gl.enable(gl.BLEND);\n        gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n        gl.clearColor(0, 0, 0, 1);\n        gl.clear(gl.COLOR_BUFFER_BIT);\n\n        // Set uniforms\n        const uniforms = this._buildUniforms();\n        for (const [name, value] of Object.entries(uniforms)) {\n            const loc = this._uniformLocations[name];\n            if (loc === null || loc === undefined) continue;\n            if (Array.isArray(value)) {\n                if (value.length === 2) gl.uniform2fv(loc, value);\n                else if (value.length === 3) gl.uniform3fv(loc, value);\n                else if (value.length === 4) gl.uniform4fv(loc, value);\n            } else {\n                gl.uniform1f(loc, value);\n            }\n        }\n\n        // Draw fullscreen quad\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._quadBuffer);\n        const posLoc = gl.getAttribLocation(this.program, 'a_position');\n        if (posLoc >= 0) {\n            gl.enableVertexAttribArray(posLoc);\n            gl.vertexAttribPointer(posLoc, 2, gl.FLOAT, false, 0, 0);\n        }\n        gl.drawArrays(gl.TRIANGLES, 0, 6);\n    }\n\n    render() {\n        if (this._useDirectGL) {\n            this._renderDirectGL();\n        } else if (this.bridge) {\n            this.bridge.setUniforms(this._buildUniforms());\n            this.bridge.render('faceted', { clear: true, clearColor: [0, 0, 0, 1] });\n        }\n    }\n\n    getBackendType() {\n        if (this._useDirectGL) return 'webgl';\n        return this.bridge ? this.bridge.getBackendType() : 'none';\n    }\n\n    setActive(active) {\n        if (active) this.start();\n        else this.stop();\n        const layer = document.getElementById('faceted-layer');\n        if (layer) layer.style.display = active ? 'block' : 'none';\n    }\n\n    init(context = {}) { return this.initialize(context); }\n\n    resize(width, height, pixelRatio = 1) {\n        const w = Math.floor(width * pixelRatio);\n        const h = Math.floor(height * pixelRatio);\n        if (this.canvas) {\n            this.canvas.width = w;\n            this.canvas.height = h;\n        }\n        if (this._useDirectGL && this.gl) {\n            this.gl.viewport(0, 0, w, h);\n        } else if (this.bridge && this.bridge.resize) {\n            this.bridge.resize(width, height, pixelRatio);\n        }\n    }\n\n    dispose() { this.destroy(); }\n\n    destroy() {\n        this.stop();\n        if (this._useDirectGL && this.gl) {\n            if (this.program) this.gl.deleteProgram(this.program);\n            if (this._quadBuffer) this.gl.deleteBuffer(this._quadBuffer);\n            this.gl = null;\n            this.program = null;\n            this._quadBuffer = null;\n        }\n        if (this.bridge) {\n            this.bridge.dispose();\n            this.bridge = null;\n        }\n        this.initialized = false;\n        this._useDirectGL = false;\n    }\n}\n"],"names":["ROLE_INTENSITIES","QuantumHolographicVisualizer","canvasIdOrElement","role","reactivity","variant","version","e","err","rect","devicePixelRatio","resolve","viewWidth","viewHeight","existingContext","error","vertexShaderSource","fragmentShaderSource","vertexSource","fragmentSource","vertexShader","fragmentShader","program","_b","_a","type","source","shader","_c","shaderType","_e","errorMsg","_d","sourceLines","_f","positions","positionLocation","dpr","width","height","ctx","params","key","value","x","y","intensity","time","gridDensity","morphFactor","hue","chaos","ParameterManager","name","def","paramObj","geometryType","id","element","paramName","text","variationDisplay","geometryNames","geometryLevel","geometryName","btn","config","variationIndex","level","variationParams","hsv","h","s","v","c","m","r","g","b","ResourceEvent","action","bytes","label","RenderResourceRegistry","options","enabled","handle","disposer","entry","bucket","count","current","peak","stats","history","ageThreshold","now","potentialLeaks","age","d","lines","data","DEFAULT_VERTEX_SHADER","DEFAULT_FRAGMENT_SHADER","FULLSCREEN_VERTEX_SHADER","WebGPUFeatures","WebGPUBackend","canvas","device","context","format","adapter","feature","size","visibility","vis","alignedSize","buffer","layout","bindGroup","uniforms","model","view","proj","fov","aspect","near","far","f","rangeInv","code","module","fragmentCode","vertexCode","vertexModule","fragmentModule","bindGroupLayouts","pipelineLayout","blend","useDepth","pipeline","desc","texture","sampler","clampedWidth","clampedHeight","pipelineName","bindGroups","clearColor","clear","encoder","colorView","pass","i","depthAttachment","vertexBuffer","indexBuffer","vertexCount","indexCount","isWebGPUSupported","createWebGPUBackend","availableFeatures","requestedFeatures","requiredFeatures","optionalFeatures","info","event","packVIB3Uniforms","UnifiedRenderBridge","backendType","backend","preferWebGPU","debug","gpuBackend","bridge","gl","sources","vertexSrc","fragmentSrc","uniformLocations","numUniforms","old","wgslFragmentSrc","gpu","bufferName","uniformEntry","cc","uName","loc","posLoc","packed","pixelRatio","w","loseContext","vertices","LAYER_ORDER","echo","opacity","densityScale","speedScale","intensityScale","kp","_time","mirror","invertRotation","hueShift","result","complement","densityPivot","chaosInvert","harmonic","densityHarmonic","speedRatio","hueAngle","reactive","gain","decay","prevParams","accumulatedDelta","delta","chase","lerpRate","currentParams","PRESET_REGISTRY","PROFILES","LayerRelationshipGraph","layerName","relationship","factory","shaderName","profileName","profile","rel","keystoneParams","fn","resolved","relationships","shaders","DEFAULT_LAYER_CONFIG","GRAPH_LAYER_ORDER","MultiCanvasBridge","canvases","layerConfig","relationshipProfile","relationshipGraph","entries","results","graphInfo","graph","succeeded","failed","existing","overrides","layerShader","DEFAULT_BASE_PATH","FALLBACK_VERTEX_GLSL","FALLBACK_VERTEX_WGSL","ShaderLoader","relativePath","url","fetchPromise","systemName","fragmentBasePath","vertGlslPath","vertWgslPath","fragGlslPath","fragWgslPath","vertGlsl","vertWgsl","fragGlsl","fragWgsl","libs","glsl","wgsl","fragBase","systems","includeRegex","match","path","cached","response","shaderLoader","QuantumEngine","visualizer","layer","canvasMap","layerIds","el","external","audioData","active","quantumLayers","track","canvasElements","mouseX","mouseY","touch","touchX","touchY","deltaX","deltaY","velocity","avgVelocity","sum","rotationAngle","rot4dXW","rot4dYW","rot4dZW","distanceFromCenter","normalizedDistance","leftHemisphere","topHemisphere","baseHue","hueVariation","speed","scrollDirection","quantumEffects","flashSaturation","flashMorph","currentChaos","currentSpeed","currentHue","stream","param","render","canvasEl","frameState","HolographicVisualizer","vib3Geometries","baseGeometry","variationLevel","finalName","vp","variation","saturation","lightness","rgbColor","l","hue2rgb","p","q","t","baseSpeed","audioBoost","audioDensity","audioMorph","audioSpeed","audioChaos","audioColor","breathCycle","scaledValue","RealHolographicSystem","layerDefs","successfulLayers","layers","audio","holoLayers","variantName","randomIndex","index","layerParams","base","content","newVariant","_g","_h","_i","_j","constraints","bassEnd","midEnd","bass","mid","high","smoothedAudio","currentValue","smoothingFactor","bassLevel","beatDetected","midLevel","highLevel","melodicActivity","settings","sensitivityMultiplier","modeKey","sensitivity","visualMode","paramList","audioIntensity","bassIntensity","rhythmIntensity","angleX","angleY","hueShimmer","shimmerHue","shimmerIntensity","saturationPulse","depthMorph","burstAnimation","burstPhase","burstHue","burstIntensity","burstSaturation","burstChaos","burstSpeed","VERTEX_SHADER_GLSL","FRAGMENT_SHADER_GLSL","FRAGMENT_SHADER_WGSL","FacetedSystem","vs","fs"],"mappings":"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ACX,CACJ,CAKA,aAAc,CACV,MAAMC,EAAqB;AAAA;AAAA;AAAA,GASrBC,EAAuB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;A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AA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAuRvBC,GAAuB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA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"}