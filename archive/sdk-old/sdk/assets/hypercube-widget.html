<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4D Hypercube Widget - VIB3+ SDK Asset</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #0a0a12;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            font-family: system-ui, sans-serif;
        }
        .widget {
            background: linear-gradient(135deg, #1a1a2e 0%, #0f0f1a 100%);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 16px;
            padding: 20px;
            width: 400px;
        }
        .widget-header {
            color: #0ff;
            font-size: 14px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .badge {
            background: rgba(0, 255, 136, 0.2);
            color: #0f8;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 10px;
        }
        canvas {
            width: 100%;
            height: 300px;
            background: #000;
            border-radius: 8px;
        }
        .controls {
            margin-top: 15px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .control {
            background: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: 8px;
        }
        .control label {
            display: block;
            color: #888;
            font-size: 10px;
            margin-bottom: 5px;
        }
        .control input {
            width: 100%;
        }
        .control .value {
            color: #0ff;
            font-size: 11px;
            text-align: right;
        }
    </style>
</head>
<body>
    <div class="widget">
        <div class="widget-header">
            <span>4D HYPERCUBE</span>
            <span class="badge">VIB3+ SDK</span>
        </div>
        <canvas id="canvas"></canvas>
        <div class="controls">
            <div class="control">
                <label>XW Rotation (4D)</label>
                <input type="range" id="xw" min="-2" max="2" step="0.01" value="0">
                <div class="value" id="xwVal">0.00</div>
            </div>
            <div class="control">
                <label>ZW Rotation (4D)</label>
                <input type="range" id="zw" min="-2" max="2" step="0.01" value="0">
                <div class="value" id="zwVal">0.00</div>
            </div>
        </div>
    </div>

    <script type="module">
        // Import actual SDK from docs/src/
        import { Rotor4D } from '../src/math/Rotor4D.js';
        import { Vec4 } from '../src/math/Vec4.js';

        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // High DPI
        const dpr = window.devicePixelRatio || 1;
        canvas.width = 400 * dpr;
        canvas.height = 300 * dpr;
        ctx.scale(dpr, dpr);

        // Hypercube vertices (16 vertices at Â±1 in each dimension)
        const vertices = [];
        for (let i = 0; i < 16; i++) {
            vertices.push(new Vec4(
                (i & 1) ? 1 : -1,
                (i & 2) ? 1 : -1,
                (i & 4) ? 1 : -1,
                (i & 8) ? 1 : -1
            ));
        }

        // Edges (connect vertices that differ in exactly one coordinate)
        const edges = [];
        for (let i = 0; i < 16; i++) {
            for (let j = i + 1; j < 16; j++) {
                const diff = i ^ j;
                if (diff && !(diff & (diff - 1))) {
                    edges.push([i, j]);
                }
            }
        }

        let rotXW = 0, rotZW = 0;
        let autoRotate = true;

        function project(v, rotor) {
            const rotated = rotor.rotate(v);
            const wDist = 3;
            const scale4D = 1 / (wDist - rotated.w * 0.5);
            const x3 = rotated.x * scale4D;
            const y3 = rotated.y * scale4D;
            const z3 = rotated.z * scale4D;
            const zDist = 4;
            const scale3D = 1 / (zDist - z3 * 0.5);
            return {
                x: 200 + x3 * scale3D * 80,
                y: 150 - y3 * scale3D * 80,
                depth: rotated.w + z3
            };
        }

        function render() {
            const r1 = Rotor4D.fromPlaneAngle('XW', rotXW);
            const r2 = Rotor4D.fromPlaneAngle('ZW', rotZW);
            const r3 = Rotor4D.fromPlaneAngle('XY', performance.now() * 0.0003);
            const rotor = r1.multiply(r2).multiply(r3);

            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, 400, 300);

            const projected = vertices.map(v => project(v, rotor));

            // Draw edges
            edges.forEach(([i, j]) => {
                const p1 = projected[i];
                const p2 = projected[j];
                const avgDepth = (p1.depth + p2.depth) / 2;
                const opacity = Math.max(0.2, Math.min(1, 0.5 + avgDepth * 0.2));
                const hue = 180 + avgDepth * 20;

                ctx.beginPath();
                ctx.moveTo(p1.x, p1.y);
                ctx.lineTo(p2.x, p2.y);
                ctx.strokeStyle = `hsla(${hue}, 80%, 60%, ${opacity})`;
                ctx.lineWidth = Math.max(0.5, 2 - avgDepth * 0.3);
                ctx.stroke();
            });

            // Draw vertices
            projected.forEach(p => {
                const size = Math.max(2, 4 - p.depth * 0.5);
                ctx.beginPath();
                ctx.arc(p.x, p.y, size, 0, Math.PI * 2);
                ctx.fillStyle = `hsla(60, 100%, 70%, ${0.5 + p.depth * 0.2})`;
                ctx.fill();
            });

            requestAnimationFrame(render);
        }

        // Slider handlers
        document.getElementById('xw').addEventListener('input', e => {
            rotXW = parseFloat(e.target.value);
            document.getElementById('xwVal').textContent = rotXW.toFixed(2);
        });
        document.getElementById('zw').addEventListener('input', e => {
            rotZW = parseFloat(e.target.value);
            document.getElementById('zwVal').textContent = rotZW.toFixed(2);
        });

        render();
        console.log('VIB3+ SDK Hypercube Widget loaded');
        console.log('Using: Rotor4D, Vec4 from docs/src/math/');
        console.log('Vertices:', vertices.length, 'Edges:', edges.length);
    </script>
</body>
</html>
